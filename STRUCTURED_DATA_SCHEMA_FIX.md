# Structured Data Schema Fix

## Problem
TypeScript error: `Property 'structured_data' does not exist on type 'ReportSection'`

The code was trying to access `section.structured_data` but this property wasn't defined in the `ReportSectionSchema`.

## Root Cause
The `ReportSectionSchema` in `src/lib/schemas/report.ts` was missing the `structured_data` field that's needed to store structured data generated by AI for sections with schemas (like assessment results, validity statements, etc.).

## Solution
Added the `structured_data` field to the `ReportSectionSchema`:

```typescript
// Schema for report sections
export const ReportSectionSchema = z.object({
  // ... existing fields ...
  
  // Structured data for sections with schemas (assessment results, validity statements, etc.)
  structured_data: z.record(z.any()).optional(),
  
  // ... rest of fields ...
});
```

## Field Definition
- **Type**: `z.record(z.any()).optional()`
- **Purpose**: Store structured data for sections that have schemas
- **Optional**: Yes - not all sections will have structured data
- **Structure**: Key-value pairs where keys are field names and values can be any type

## Usage Examples

### Assessment Results Section
```json
{
  "structured_data": {
    "standardized_tests": [
      {
        "test_title": "PLS-5",
        "scores": {
          "standard_score": 80,
          "percentile": 9,
          "qualitative_description": "Below Average"
        }
      }
    ],
    "articulation": {
      "error_patterns": "Final consonant deletion, cluster reduction",
      "stimulability": "Good for /s/ in isolation",
      "intelligibility": "75% in connected speech"
    }
  }
}
```

### Assessment Tools Section
```json
{
  "structured_data": {
    "formal_assessments": [
      {
        "tool_name": "Preschool Language Scales - Fifth Edition",
        "acronym": "PLS-5",
        "authors": "Zimmerman, Steiner, & Pond",
        "year_published": 2011,
        "target_population": "Birth through 7 years, 11 months",
        "purpose": "Assesses developmental language skills"
      }
    ],
    "informal_assessments": [
      {
        "tool_name": "Language Sample Analysis",
        "tool_description": "Spontaneous language sample during play",
        "typical_use": "Analyzing natural language production",
        "specific_use_case": "50-utterance sample during structured play"
      }
    ]
  }
}
```

### Validity Statement Section
```json
{
  "structured_data": {
    "is_valid": true,
    "student_cooperation": {
      "cooperative": true,
      "understanding": "Student understood all task directions",
      "custom_notes": "Engaged throughout assessment"
    },
    "validity_factors": {
      "attention_issues": false,
      "motivation_problems": false,
      "cultural_considerations": true,
      "other": "Bilingual considerations noted"
    }
  }
}
```

## Benefits
1. **Type Safety**: Proper TypeScript support for structured data
2. **AI Integration**: Allows AI to populate structured fields
3. **UI Rendering**: Enables specialized components like `StandardizedTestEditor` and `AssessmentToolsEditor`
4. **Data Integrity**: Maintains structured data alongside rich text content
5. **Backward Compatibility**: Optional field doesn't break existing reports

## Impact
- ✅ Fixes TypeScript compilation error
- ✅ Enables proper structured data storage
- ✅ Supports AI-generated structured content
- ✅ Maintains backward compatibility with existing reports
- ✅ Allows for rich UI components for structured data editing

The fix ensures that sections can store both rich text content (in the `content` field) and structured data (in the `structured_data` field), providing flexibility for different section types and AI processing capabilities.