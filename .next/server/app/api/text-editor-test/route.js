/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/text-editor-test/route";
exports.ids = ["app/api/text-editor-test/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_brandonbrewer_Documents_Linguosity_Linguosity_src_app_api_text_editor_test_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/text-editor-test/route.ts */ \"(rsc)/./src/app/api/text-editor-test/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/text-editor-test/route\",\n        pathname: \"/api/text-editor-test\",\n        filename: \"route\",\n        bundlePath: \"app/api/text-editor-test/route\"\n    },\n    resolvedPagePath: \"/Users/brandonbrewer/Documents/Linguosity/Linguosity/src/app/api/text-editor-test/route.ts\",\n    nextConfigOutput,\n    userland: _Users_brandonbrewer_Documents_Linguosity_Linguosity_src_app_api_text_editor_test_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZ0ZXh0LWVkaXRvci10ZXN0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZ0ZXh0LWVkaXRvci10ZXN0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdGV4dC1lZGl0b3ItdGVzdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmJyYW5kb25icmV3ZXIlMkZEb2N1bWVudHMlMkZMaW5ndW9zaXR5JTJGTGluZ3Vvc2l0eSUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZicmFuZG9uYnJld2VyJTJGRG9jdW1lbnRzJTJGTGluZ3Vvc2l0eSUyRkxpbmd1b3NpdHkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUMwQztBQUN2SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2JyYW5kb25icmV3ZXIvRG9jdW1lbnRzL0xpbmd1b3NpdHkvTGluZ3Vvc2l0eS9zcmMvYXBwL2FwaS90ZXh0LWVkaXRvci10ZXN0L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvdGV4dC1lZGl0b3ItdGVzdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RleHQtZWRpdG9yLXRlc3RcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3RleHQtZWRpdG9yLXRlc3Qvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYnJhbmRvbmJyZXdlci9Eb2N1bWVudHMvTGluZ3Vvc2l0eS9MaW5ndW9zaXR5L3NyYy9hcHAvYXBpL3RleHQtZWRpdG9yLXRlc3Qvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/text-editor-test/route.ts":
/*!***********************************************!*\
  !*** ./src/app/api/text-editor-test/route.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/reportUtils */ \"(rsc)/./src/lib/reportUtils.ts\");\n\n\n/**\n * API endpoint to test Claude's text editor tool with JSON report updates\n */ async function POST(request) {\n    const requestId = `req_${Date.now().toString(36)}_${Math.random().toString(36).substring(2, 7)}`;\n    console.log(`[${requestId}] üöÄ REQUEST STARTED: Text Editor API called`);\n    try {\n        // Extract request parameters\n        const { input, report: existingReport, updateSection, pdfData } = await request.json();\n        // Determine if this is a PDF upload or text input\n        const isPdfUpload = !!pdfData;\n        const inputData = isPdfUpload ? {\n            pdfData\n        } : input;\n        console.log(`[${requestId}] üì• Received request payload:`, {\n            inputType: isPdfUpload ? 'PDF' : 'text',\n            inputSize: isPdfUpload ? `${pdfData.length} chars (base64)` : typeof input === 'string' ? `${input.substring(0, 50)}${input.length > 50 ? '...' : ''}` : input,\n            reportProvided: !!existingReport,\n            updateSection: updateSection || 'auto-detect'\n        });\n        // Validate request parameters\n        if (!inputData && !isPdfUpload) {\n            console.log(`[${requestId}] ‚ùå Validation failed: Missing input data`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Input data is required'\n            }, {\n                status: 400\n            });\n        }\n        // Create or use existing report\n        const report = existingReport || (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.createReportSkeleton)();\n        console.log(`[${requestId}] üìã Using ${existingReport ? 'provided' : 'default'} report structure with ${Object.keys(report.assessmentResults.domains).length} domains`);\n        // Get API key from environment variables\n        const apiKey = process.env.ANTHROPIC_API_KEY;\n        // Check if API key is available\n        if (!apiKey) {\n            console.log(`[${requestId}] ‚ùå Missing API key: ANTHROPIC_API_KEY not set`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'ANTHROPIC_API_KEY is not set in environment variables'\n            }, {\n                status: 500\n            });\n        }\n        try {\n            // Normalize input data (handles text, PDF, etc.)\n            console.log(`[${requestId}] üîÑ Normalizing input data...`);\n            const normalizedInput = await (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.normalizeInput)(inputData);\n            console.log(`[${requestId}] ‚úÖ Input normalized, length: ${normalizedInput.length} chars`);\n            // Log if this is a PDF upload\n            if (isPdfUpload) {\n                console.log(`[${requestId}] üìÑ Processing PDF data...`);\n            }\n            // Determine which section(s) to update\n            const sectionToUpdate = updateSection || 'auto-detect';\n            console.log(`[${requestId}] üéØ Target section(s): ${sectionToUpdate}`);\n            // Prepare the report section that Claude will view and edit\n            let viewContent;\n            let targetPath;\n            console.log(`[${requestId}] üìë Preparing view content for Claude...`);\n            // Helper function to get a nested value from an object using a path string\n            const getNestedValue = (obj, path)=>{\n                return path.split('.').reduce((o, key)=>o?.[key], obj);\n            };\n            // Extract the main section (header, background, assessmentResults, conclusion)\n            const getMainSection = (path)=>{\n                if (path.startsWith('header.')) return 'header';\n                if (path.startsWith('background.')) return 'background';\n                if (path.startsWith('assessmentResults.')) return 'assessmentResults';\n                if (path.startsWith('conclusion.')) return 'conclusion';\n                return null;\n            };\n            // NEW LOGIC: Always send the full serialized report if \"auto-detect\" or if multiple sections are specified.\n            if (sectionToUpdate === 'auto-detect') {\n                // Send the full report JSON when no sections are specified\n                viewContent = JSON.stringify(report, null, 2);\n                targetPath = '';\n                console.log(`[${requestId}] Tag mode: Sending full report structure without specific section tags.`);\n            } else if (sectionToUpdate.includes(',')) {\n                // If the user specifies multiple sections (comma-separated), send the full report and tag those sections\n                viewContent = JSON.stringify(report, null, 2);\n                targetPath = sectionToUpdate; // targetPath now holds a comma-separated list of sections\n                console.log(`[${requestId}] Tag mode: User-specified sections: ${sectionToUpdate}`);\n            } else {\n                // For a single specified section, handle as before\n                const mainSection = getMainSection(sectionToUpdate);\n                if (mainSection) {\n                    viewContent = JSON.stringify(report[mainSection], null, 2);\n                    targetPath = sectionToUpdate;\n                    console.log(`[${requestId}] Section update: ${mainSection} -> ${sectionToUpdate}`);\n                } else {\n                    const nestedValue = getNestedValue(report, sectionToUpdate);\n                    viewContent = nestedValue ? JSON.stringify(nestedValue, null, 2) : JSON.stringify(report, null, 2);\n                    targetPath = sectionToUpdate;\n                    console.log(`[${requestId}] Other section update: ${sectionToUpdate}`);\n                }\n            }\n            // Call the Anthropic API directly\n            console.log(`[${requestId}] üîå Making first API call to Claude...`);\n            // Create appropriate system prompt based on input type\n            const systemPrompt = `You are an expert educational speech-language pathologist that specializes in writing detailed assessment reports. \nYour task is to update a JSON report structure based on ${isPdfUpload ? 'the contents of the uploaded PDF document' : 'user input'}.\n\nREPORT STRUCTURE:\nThe report is organized into four main sections:\n1. header - Student information and referral reason\n2. background - Health history, family info, and parent concerns\n3. assessmentResults - Observations, assessment tools, and domain evaluations\n4. conclusion - Eligibility determination, summary, and recommendations\n\nUser-specified sections: ${sectionToUpdate === 'auto-detect' ? 'None specified' : sectionToUpdate}\n\nINSTRUCTIONS:\n1. DO NOT use the text editor tool's str_replace command for these updates\n2. INSTEAD, analyze ALL sections of the report that need updating based on the input\n3. Return MULTIPLE update_key JSON commands - one for each section that needs updating\n\nIMPORTANT: Your response should include separate JSON commands for:\n- Student information (name, DOB, demographics)\n- Background information (educational, family, medical, developmental history)\n- Each language domain with relevant findings (receptive, expressive, fluency, etc.)\n- Assessment tools mentioned in the input\n\nJSON PATH COMMAND FORMAT:\n\\`\\`\\`json\n{\n  \"command\": \"update_key\",\n  \"path\": \"assessmentResults.domains.pragmatic.strengths\",\n  \"action\": \"append\",\n  \"value\": [\"Your observation here\"]\n}\n\\`\\`\\`\n\nWhere:\n- path: The exact JSON path to update (using the new structure paths, e.g., \"assessmentResults.domains.pragmatic.strengths\")\n- action: Use \"append\" for arrays, \"replace\" for fields, or \"merge\" for objects\n- value: The new value to insert, properly formatted as JSON\n\nFor domain sections, maintain these guidelines:\n- topicSentence: A clear statement summarizing the domain findings\n- strengths: Array of specific skills and abilities the student demonstrates\n- needs: Array of specific difficulties the student exhibits\n- impactStatement: How challenges affect educational performance\n- assessmentTools: Array of assessment tools used to evaluate this specific domain (full names, not IDs)\n\nIMPORTANT: When processing standardized tests, add the assessment tool name directly to the domain.assessmentTools array. For example:\n\"assessmentTools\": [\"Goldman-Fristoe Test of Articulation-3 (GFTA-3)\"]\n\nFORMAT YOUR RESPONSE AS MULTIPLE JSON COMMANDS, EACH IN ITS OWN CODE BLOCK.`;\n            // Prepare the user message based on input type\n            let userContent = [];\n            if (isPdfUpload) {\n                // Construct message for PDF content\n                userContent = [\n                    {\n                        type: \"text\",\n                        text: `I need to update the speech-language report based on the content in this PDF document. ${sectionToUpdate !== 'auto-detect' ? `Please focus on updating the ${sectionToUpdate} section.` : 'Please analyze the PDF and determine which section of the report to update.'}\\n\\nHere is the current report structure:\\n\\`\\`\\`json\\n${viewContent}\\n\\`\\`\\`\\n\\nFor standardized tests like GFTA, CELF, etc., identify key scores and findings, and update the appropriate domain section. Extract any relevant phonological processes, error patterns, or specific strengths/needs.\\n\\nIMPORTANT: When extracting data from standardized tests, be sure to add the test\\'s full name to the domain.assessmentTools array using the update_key command. For example, if analyzing GFTA-3 results for articulation, include \"assessmentTools\": [\"Goldman-Fristoe Test of Articulation, Third Edition (GFTA-3)\"] in your update. This helps track which tools were used for each domain.\\n\\nRespond with an update_key JSON command as described in the system prompt.`\n                    },\n                    {\n                        type: \"document\",\n                        source: {\n                            type: \"base64\",\n                            media_type: \"application/pdf\",\n                            data: normalizedInput\n                        }\n                    }\n                ];\n            } else {\n                // Construct message for text content\n                userContent = [\n                    {\n                        type: \"text\",\n                        text: `I need to update the speech-language report based on this new information:\n\"${normalizedInput}\"\n\nHere is the current report structure:\n\\`\\`\\`json\n${viewContent}\n\\`\\`\\`\n\n${sectionToUpdate === 'auto-detect' ? 'Please analyze the input and determine which section of the report to update.' : `Please update the ${sectionToUpdate} section.`}\n\nDO NOT use the text editor tool. Instead, respond with an update_key JSON command.\n\nFor example, if updating pragmatic domain strengths and adding assessment tools, respond with:\n\\`\\`\\`json\n{\n  \"command\": \"update_key\",\n  \"path\": \"assessmentResults.domains.pragmatic\",\n  \"action\": \"merge\",\n  \"value\": {\n    \"strengths\": [\"Student maintains eye contact during conversations\"],\n    \"assessmentTools\": [\"Clinical Evaluation of Language Fundamentals-5 (CELF-5)\"]\n  }\n}\n\\`\\`\\`\n\nGuidelines:\n- For strengths/needs arrays: use \"append\" and array values\n- For topic sentences: use \"replace\" and string value\n- Empty/missing fields need to be created with appropriate value types\n- Analyze which domain fits best: receptive, expressive, pragmatic, articulation, voice, fluency\n- The domains are found at the path \"assessmentResults.domains.[domainName]\"\n\nIMPORTANT: Format your entire response as a text message containing only the JSON command. DO NOT use the text editor tool.`\n                    }\n                ];\n            }\n            const firstApiPayload = {\n                model: 'claude-3-7-sonnet-20250219',\n                max_tokens: 1024,\n                system: systemPrompt,\n                tools: [\n                    {\n                        type: 'text_editor_20250124',\n                        name: 'str_replace_editor'\n                    }\n                ],\n                messages: [\n                    {\n                        role: 'user',\n                        content: userContent\n                    }\n                ]\n            };\n            console.log(`[${requestId}] üì§ First API payload prepared, user message length: ${normalizedInput.length}`);\n            const response = await fetch('https://api.anthropic.com/v1/messages', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-api-key': apiKey,\n                    'anthropic-version': '2023-06-01'\n                },\n                body: JSON.stringify(firstApiPayload)\n            });\n            if (!response.ok) {\n                const errorData = await response.json();\n                console.log(`[${requestId}] ‚ùå First API call failed:`, errorData);\n                throw new Error(errorData.error?.message || `API error: ${response.status}`);\n            }\n            let claudeResponse = await response.json();\n            console.log(`[${requestId}] ‚úÖ First Claude response received, content blocks:`, claudeResponse.content.map((block)=>({\n                    type: block.type,\n                    ...block.type === 'tool_use' ? {\n                        command: block.input?.command\n                    } : {}\n                })));\n            // Handle the two-way conversation flow with Claude for the text editor tool\n            let finalCommand = null;\n            // Check if Claude is using a tool\n            const toolUseBlock = claudeResponse.content.find((block)=>block.type === 'tool_use' && block.name === 'str_replace_editor');\n            // Log the tool use block\n            if (toolUseBlock) {\n                console.log(`[${requestId}] üõ†Ô∏è Claude is using tool: ${toolUseBlock.name}, command: ${toolUseBlock.input?.command}`);\n            } else {\n                console.log(`[${requestId}] ‚ö†Ô∏è No tool use block found in Claude's response`);\n            }\n            // If Claude is using the \"view\" command first (common with text editor)\n            if (toolUseBlock && toolUseBlock.input && toolUseBlock.input.command === 'view') {\n                console.log(`[${requestId}] üëÅÔ∏è Claude is requesting to view content first. Sending content...`);\n                // Send back the content that Claude requested to view\n                console.log(`[${requestId}] üîå Making second API call to Claude with view result...`);\n                // Create a second API payload that's consistent with the first\n                let secondUserContent = [];\n                if (isPdfUpload) {\n                    // Construct message for PDF content with previous view result\n                    secondUserContent = [\n                        {\n                            type: \"text\",\n                            text: `I need to update the speech-language report based on the content in this PDF document. ${sectionToUpdate !== 'auto-detect' ? `Please focus on updating the ${sectionToUpdate} section.` : 'Please analyze the PDF and determine which section of the report to update.'}\\n\\nRespond with an update_key JSON command as described in the system prompt.`\n                        },\n                        {\n                            type: \"document\",\n                            source: {\n                                type: \"base64\",\n                                media_type: \"application/pdf\",\n                                data: normalizedInput\n                            }\n                        }\n                    ];\n                } else {\n                    // Construct message for text content with previous view result\n                    secondUserContent = [\n                        {\n                            type: \"text\",\n                            text: `I need to update the speech-language report based on this new information:\n\"${normalizedInput}\"\n\n${sectionToUpdate === 'auto-detect' ? 'Please analyze the input and determine which section of the report to update.' : `Please update the ${sectionToUpdate} section.`}\n\nDO NOT use the text editor tool. Instead, respond with an update_key JSON command.\n\nGuidelines:\n- For strengths/needs arrays: use \"append\" and array values\n- For topic sentences: use \"replace\" and string value\n- Empty/missing fields need to be created with appropriate value types\n- Analyze which domain fits best: receptive, expressive, pragmatic, articulation, voice, fluency\n- The domains are found at the path \"assessmentResults.domains.[domainName]\"\n\nIMPORTANT: Format your entire response as a text message containing only the JSON command. DO NOT use the text editor tool.`\n                        }\n                    ];\n                }\n                const secondApiPayload = {\n                    model: 'claude-3-7-sonnet-20250219',\n                    max_tokens: 1024,\n                    system: systemPrompt,\n                    tools: [\n                        {\n                            type: 'text_editor_20250124',\n                            name: 'str_replace_editor'\n                        }\n                    ],\n                    messages: [\n                        {\n                            role: 'user',\n                            content: secondUserContent\n                        },\n                        {\n                            role: 'assistant',\n                            content: [\n                                {\n                                    type: 'text',\n                                    text: 'I\\'ll help you update the report using the text editor tool.'\n                                },\n                                {\n                                    type: 'tool_use',\n                                    id: toolUseBlock.id,\n                                    name: 'str_replace_editor',\n                                    input: toolUseBlock.input\n                                }\n                            ]\n                        },\n                        {\n                            role: 'user',\n                            content: [\n                                {\n                                    type: 'tool_result',\n                                    tool_use_id: toolUseBlock.id,\n                                    content: viewContent\n                                }\n                            ]\n                        }\n                    ]\n                };\n                const secondResponse = await fetch('https://api.anthropic.com/v1/messages', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-api-key': apiKey,\n                        'anthropic-version': '2023-06-01'\n                    },\n                    body: JSON.stringify(secondApiPayload)\n                });\n                if (!secondResponse.ok) {\n                    const errorData = await secondResponse.json();\n                    console.log(`[${requestId}] ‚ùå Second API call failed:`, errorData);\n                    throw new Error(errorData.error?.message || `API error in second request: ${secondResponse.status}`);\n                }\n                // Get Claude's response with the actual edit\n                claudeResponse = await secondResponse.json();\n                console.log(`[${requestId}] ‚úÖ Second Claude response received, content blocks:`, claudeResponse.content.map((block)=>({\n                        type: block.type,\n                        ...block.type === 'tool_use' ? {\n                            command: block.input?.command\n                        } : {}\n                    })));\n                // Now check for the str_replace command\n                const secondToolUseBlock = claudeResponse.content.find((block)=>block.type === 'tool_use' && block.name === 'str_replace_editor');\n                if (secondToolUseBlock) {\n                    console.log(`[${requestId}] üõ†Ô∏è Second response tool use: ${secondToolUseBlock.name}, command: ${secondToolUseBlock.input?.command}`);\n                    if (secondToolUseBlock.input && (secondToolUseBlock.input.command === 'str_replace' || secondToolUseBlock.input.command === 'insert')) {\n                        finalCommand = secondToolUseBlock.input;\n                        console.log(`[${requestId}] ‚úÖ Got final command:`, {\n                            command: finalCommand.command,\n                            old_str: finalCommand.old_str ? `${finalCommand.old_str.substring(0, 50)}...` : undefined,\n                            new_str: finalCommand.new_str ? `${finalCommand.new_str.substring(0, 50)}...` : undefined,\n                            text: finalCommand.text ? `${finalCommand.text.substring(0, 50)}...` : undefined,\n                            position: finalCommand.position\n                        });\n                    } else {\n                        console.log(`[${requestId}] ‚ö†Ô∏è Second tool use block doesn't contain str_replace or insert command:`, secondToolUseBlock.input);\n                    }\n                } else {\n                    console.log(`[${requestId}] ‚ö†Ô∏è No tool use block found in Claude's second response`);\n                }\n            } else if (toolUseBlock && toolUseBlock.input && (toolUseBlock.input.command === 'str_replace' || toolUseBlock.input.command === 'insert')) {\n                // Claude directly used str_replace or insert (unusual but possible)\n                finalCommand = toolUseBlock.input;\n                console.log(`[${requestId}] ‚úÖ Got final command directly from first response:`, {\n                    command: finalCommand.command,\n                    old_str: finalCommand.old_str ? `${finalCommand.old_str.substring(0, 50)}...` : undefined,\n                    new_str: finalCommand.new_str ? `${finalCommand.new_str.substring(0, 50)}...` : undefined,\n                    text: finalCommand.text ? `${finalCommand.text.substring(0, 50)}...` : undefined,\n                    position: finalCommand.position\n                });\n            } else {\n                console.log(`[${requestId}] ‚ö†Ô∏è No usable command found in Claude's responses`);\n            }\n            // Check if there's a JSON path update command in Claude's response text\n            let updateKeyCommand = null;\n            const textBlocks = claudeResponse.content.filter((block)=>block.type === 'text');\n            for (const block of textBlocks){\n                // Look for JSON objects in the text that might contain our command\n                const jsonMatches = block.text.match(/```json\\s*({[\\s\\S]*?})\\s*```|({[\\s\\S]*\"command\"[\\s\\S]*})/g);\n                if (jsonMatches) {\n                    for (const match of jsonMatches){\n                        try {\n                            // Extract the JSON object from markdown code blocks or plain text\n                            const jsonStr = match.replace(/```json\\s*|\\s*```/g, '').trim();\n                            // Parse as full JSON object to preserve structure\n                            const jsonObj = JSON.parse(jsonStr);\n                            // Check if this is an update_key command\n                            if (jsonObj.command === 'update_key' && jsonObj.path && jsonObj.action && jsonObj.value !== undefined) {\n                                updateKeyCommand = jsonObj; // Use the object directly, not stringified then reparsed\n                                console.log(`[${requestId}] üîë Found update_key command in text`);\n                                // Log the full structure to help with debugging\n                                console.log(`[${requestId}] üìä Update command structure:`, JSON.stringify(updateKeyCommand));\n                                break;\n                            }\n                        } catch (e) {\n                            console.warn(`[${requestId}] ‚ö†Ô∏è Failed to parse potential JSON command:`, e);\n                        }\n                    }\n                }\n                if (updateKeyCommand) break;\n            }\n            // Process the command if we have one (either update_key or text editor command)\n            if (updateKeyCommand) {\n                console.log(`[${requestId}] üîÑ Processing update_key command...`);\n                console.log(`[${requestId}] üìä Update details: path=${updateKeyCommand.path}, action=${updateKeyCommand.action}`);\n                let updatedReport = {\n                    ...report\n                };\n                let affectedDomain = '';\n                // Extract domain if path starts with domains.X\n                if (updateKeyCommand.path.includes('domains.')) {\n                    const pathParts = updateKeyCommand.path.split('.');\n                    const domainIndex = pathParts.findIndex((part)=>part === 'domains');\n                    if (domainIndex !== -1 && pathParts.length > domainIndex + 1) {\n                        affectedDomain = pathParts[domainIndex + 1];\n                        console.log(`[${requestId}] üéØ Affected domain from path: ${affectedDomain}`);\n                    }\n                }\n                try {\n                    // Apply the update based on the path and action\n                    const pathParts = updateKeyCommand.path.split('.');\n                    let current = updatedReport;\n                    // Navigate to the parent object of the target property\n                    for(let i = 0; i < pathParts.length - 1; i++){\n                        const part = pathParts[i];\n                        // Create missing objects in the path\n                        if (!current[part]) {\n                            // Check if the next path segment is a number (array index)\n                            const nextPart = pathParts[i + 1];\n                            const isNextPartArrayIndex = !isNaN(parseInt(nextPart));\n                            // Create appropriate container type (array or object)\n                            current[part] = isNextPartArrayIndex ? [] : {};\n                            console.log(`[${requestId}] üèóÔ∏è Created missing ${isNextPartArrayIndex ? 'array' : 'object'} at ${pathParts.slice(0, i + 1).join('.')}`);\n                        }\n                        current = current[part];\n                    }\n                    // Get the target property name\n                    const targetProp = pathParts[pathParts.length - 1];\n                    // Apply the action\n                    switch(updateKeyCommand.action){\n                        case 'append':\n                            // For arrays, append the new values\n                            if (!current[targetProp]) {\n                                current[targetProp] = [];\n                            } else if (!Array.isArray(current[targetProp])) {\n                                // Convert to array if not already\n                                current[targetProp] = [\n                                    current[targetProp]\n                                ];\n                            }\n                            // Handle both single value and array of values\n                            if (Array.isArray(updateKeyCommand.value)) {\n                                current[targetProp] = [\n                                    ...current[targetProp],\n                                    ...updateKeyCommand.value\n                                ];\n                            } else {\n                                current[targetProp].push(updateKeyCommand.value);\n                            }\n                            console.log(`[${requestId}] ‚úÖ Appended to ${updateKeyCommand.path}, new length: ${current[targetProp].length}`);\n                            break;\n                        case 'replace':\n                            // Replace the value entirely\n                            current[targetProp] = updateKeyCommand.value;\n                            console.log(`[${requestId}] ‚úÖ Replaced ${updateKeyCommand.path}`);\n                            break;\n                        case 'merge':\n                            // For objects, deep merge properties\n                            if (!current[targetProp] || typeof current[targetProp] !== 'object') {\n                                current[targetProp] = {};\n                            }\n                            current[targetProp] = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.deepMerge)(current[targetProp], updateKeyCommand.value);\n                            console.log(`[${requestId}] ‚úÖ Merged into ${updateKeyCommand.path}`);\n                            // Log the structure after merge\n                            console.log(`[${requestId}] üìä Structure after merge:`, JSON.stringify(current[targetProp]));\n                            break;\n                        default:\n                            console.warn(`[${requestId}] ‚ö†Ô∏è Unknown action: ${updateKeyCommand.action}`);\n                    }\n                    // Update metadata\n                    updatedReport.metadata.lastUpdated = new Date().toISOString();\n                    updatedReport.metadata.version = (updatedReport.metadata.version || 0) + 1;\n                    console.log(`[${requestId}] ‚úÖ Successfully applied update_key command`);\n                    // Log the final affected section\n                    const sectionPath = updateKeyCommand.path.split('.')[0]; // Get top-level section\n                    const updatedSection = updatedReport[sectionPath];\n                    console.log(`[${requestId}] üìä Updated section structure:`, JSON.stringify(updatedSection).substring(0, 200) + '...');\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        report: updatedReport,\n                        command: updateKeyCommand,\n                        affectedDomain\n                    });\n                } catch (error) {\n                    console.error(`[${requestId}] ‚ùå Error applying update_key command:`, error);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: 'Failed to apply update_key command',\n                        details: error instanceof Error ? error.message : 'Unknown error',\n                        command: updateKeyCommand\n                    }, {\n                        status: 400\n                    });\n                }\n            } else if (finalCommand) {\n                console.log(`[${requestId}] üîÑ Processing ${finalCommand.command} command...`);\n                // Get Claude's analysis of which domain/section to update\n                let affectedDomain = '';\n                let updatedReport = {\n                    ...report\n                };\n                if (sectionToUpdate === 'auto-detect') {\n                    // Extract domain from Claude's response text\n                    const textContent = claudeResponse.content.filter((block)=>block.type === 'text').map((block)=>block.text).join('\\n');\n                    // Extract domain from text - look for specific patterns like \"pragmatic domain\" or \"update the pragmatic\"\n                    console.log(`[${requestId}] üîç Analyzing text for domain keywords...`);\n                    // List of domain keywords to search for\n                    const domainKeywords = [\n                        'receptive',\n                        'expressive',\n                        'pragmatic',\n                        'articulation',\n                        'voice',\n                        'fluency'\n                    ];\n                    let foundDomain = '';\n                    // First look for the path pattern in JSON commands\n                    const pathRegex = /\"path\":\\s*\"assessmentResults\\.domains\\.([^.\"]+)\"/;\n                    const pathMatch = textContent.match(pathRegex);\n                    if (pathMatch && pathMatch[1]) {\n                        foundDomain = pathMatch[1];\n                        console.log(`[${requestId}] üîç Found domain in JSON path: \"${foundDomain}\"`);\n                    } else {\n                        // Check for domain keywords in the text\n                        for (const domain of domainKeywords){\n                            const pattern = new RegExp(`\\\\b${domain}\\\\b`, 'i');\n                            if (pattern.test(textContent)) {\n                                console.log(`[${requestId}] üîç Found domain keyword in text: \"${domain}\"`);\n                                foundDomain = domain;\n                                break;\n                            }\n                        }\n                    }\n                    affectedDomain = foundDomain;\n                    console.log(`[${requestId}] üîç Auto-detected domain: ${affectedDomain || 'none detected'}`);\n                    console.log(`[${requestId}] üìù Text content for domain detection:`, textContent);\n                } else if (sectionToUpdate.startsWith('assessmentResults.domains.')) {\n                    affectedDomain = sectionToUpdate.split('.')[2];\n                    console.log(`[${requestId}] üéØ Using specified domain: ${affectedDomain}`);\n                }\n                if (finalCommand.command === 'str_replace') {\n                    console.log(`[${requestId}] üîÑ Processing str_replace command...`);\n                    console.log(`[${requestId}] ‚ö†Ô∏è Note: str_replace is being used instead of the recommended update_key command`);\n                    let updatedContent = '';\n                    try {\n                        // First, check if the str_replace command is targeting a specific domain\n                        // We need to detect this by seeing if the old_str contains specific domain JSON\n                        const strContainsDomainPattern = Object.keys(report.assessmentResults.domains).some((domain)=>{\n                            const pattern = `\"${domain}\":\\\\s*{`;\n                            const regex = new RegExp(pattern, 'i');\n                            return regex.test(finalCommand.old_str || '');\n                        });\n                        console.log(`[${requestId}] üîç Command contains domain pattern in old_str: ${strContainsDomainPattern}`);\n                        // If we've auto-detected a domain and it exists in the report\n                        if (affectedDomain && report.assessmentResults.domains[affectedDomain]) {\n                            console.log(`[${requestId}] üîÑ Updating specific domain: ${affectedDomain}`);\n                            // Check if Claude's str_replace is directly targeting this domain section\n                            if (finalCommand.old_str && finalCommand.old_str.includes(`\"${affectedDomain}\"`)) {\n                                console.log(`[${requestId}] üéØ Direct match: Claude's command targets ${affectedDomain} domain`);\n                                // Implement a more careful search and replace for the specific domain\n                                // Start with the full report JSON\n                                const fullReportJson = JSON.stringify(report, null, 2);\n                                // Find the domain section in the JSON\n                                const domainPattern = new RegExp(`(\\\\s*\"${affectedDomain}\"\\\\s*:\\\\s*{[^}]*})`, 's');\n                                const domainMatch = fullReportJson.match(domainPattern);\n                                if (domainMatch) {\n                                    console.log(`[${requestId}] ‚úÖ Found domain section in JSON`);\n                                    // Replace just the domain section\n                                    updatedContent = fullReportJson.replace(domainMatch[0], finalCommand.new_str.trim());\n                                    try {\n                                        // Parse the complete updated report\n                                        updatedReport = JSON.parse(updatedContent);\n                                        console.log(`[${requestId}] ‚úÖ Successfully replaced domain section in full report`);\n                                    } catch (parseError) {\n                                        console.error(`[${requestId}] ‚ùå JSON parse error after domain replacement:`, parseError);\n                                        // Fallback to updating just the domain section\n                                        const domainSection = JSON.parse(JSON.stringify(report.assessmentResults.domains[affectedDomain]));\n                                        const domainJson = JSON.stringify(domainSection, null, 2);\n                                        try {\n                                            // Try to extract just the domain object from Claude's new_str\n                                            const domainObjectMatch = finalCommand.new_str.match(/{\\s*\"topicSentence\".*}/s);\n                                            if (domainObjectMatch) {\n                                                const newDomainSection = JSON.parse(domainObjectMatch[0]);\n                                                updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, newDomainSection);\n                                                console.log(`[${requestId}] ‚úÖ Fallback: Updated domain section via extraction`);\n                                            } else {\n                                                throw new Error('Could not extract domain object from new_str');\n                                            }\n                                        } catch (extractError) {\n                                            console.error(`[${requestId}] ‚ùå Failed to extract domain object:`, extractError);\n                                            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                                                error: 'Failed to update report - invalid JSON format',\n                                                details: {\n                                                    originalError: parseError.message,\n                                                    extractError: extractError.message\n                                                }\n                                            }, {\n                                                status: 400\n                                            });\n                                        }\n                                    }\n                                } else {\n                                    console.error(`[${requestId}] ‚ùå Could not find domain section in JSON`);\n                                    // Fallback to updating via domain object\n                                    const domainSection = JSON.parse(JSON.stringify(report.assessmentResults.domains[affectedDomain]));\n                                    console.log(`[${requestId}] üìä Original domain section:`, domainSection);\n                                    // Manually construct an updated domain section based on the content\n                                    const extractedContent = {};\n                                    // Try to extract topic sentence\n                                    const tsMatch = finalCommand.new_str.match(/\"topicSentence\":\\s*\"([^\"]*)\"/);\n                                    if (tsMatch) extractedContent['topicSentence'] = tsMatch[1];\n                                    // Try to extract strengths/evidence (simplified)\n                                    const strengthsMatch = finalCommand.new_str.match(/\"strengths\":\\s*\\[(.*?)\\]/s);\n                                    if (strengthsMatch) {\n                                        try {\n                                            extractedContent['strengths'] = JSON.parse(`[${strengthsMatch[1]}]`);\n                                        } catch (e) {\n                                            console.warn(`[${requestId}] ‚ö†Ô∏è Could not parse strengths`, e);\n                                        }\n                                    }\n                                    // Try to extract needs/challenges (simplified)\n                                    const needsMatch = finalCommand.new_str.match(/\"needs\":\\s*\\[(.*?)\\]/s);\n                                    if (needsMatch) {\n                                        try {\n                                            extractedContent['needs'] = JSON.parse(`[${needsMatch[1]}]`);\n                                        } catch (e) {\n                                            console.warn(`[${requestId}] ‚ö†Ô∏è Could not parse needs`, e);\n                                        }\n                                    }\n                                    // Update the domain with the extracted content\n                                    updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, extractedContent);\n                                    console.log(`[${requestId}] ‚úÖ Used extraction to update domain section`);\n                                }\n                            } else {\n                                // Standard domain section update\n                                const domainSection = JSON.parse(JSON.stringify(report.assessmentResults.domains[affectedDomain]));\n                                console.log(`[${requestId}] üìä Original domain section:`, domainSection);\n                                console.log(`[${requestId}] üîÑ Applying str_replace:`, {\n                                    old_str_length: finalCommand.old_str?.length || 0,\n                                    new_str_length: finalCommand.new_str?.length || 0\n                                });\n                                // Instead of a general replace, we'll try to improve the domain directly\n                                if (finalCommand.new_str && finalCommand.new_str.includes('\"topicSentence\"')) {\n                                    // Try to extract JSON structure from the new string\n                                    const jsonMatch = finalCommand.new_str.match(/({[\\s\\S]*})/);\n                                    if (jsonMatch) {\n                                        try {\n                                            // Parse the JSON from the new string\n                                            const updatedDomainSection = JSON.parse(jsonMatch[1]);\n                                            // Update the specific domain in the report\n                                            updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, updatedDomainSection);\n                                            console.log(`[${requestId}] ‚úÖ Successfully extracted and updated domain JSON`);\n                                        } catch (jsonError) {\n                                            console.error(`[${requestId}] ‚ùå Error parsing extracted JSON:`, jsonError);\n                                            // Fallback to standard replacement\n                                            updatedContent = JSON.stringify(domainSection).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                            const updatedDomainSection = JSON.parse(updatedContent);\n                                            updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, updatedDomainSection);\n                                        }\n                                    } else {\n                                        // No JSON structure found, use standard replacement\n                                        updatedContent = JSON.stringify(domainSection).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                        const updatedDomainSection = JSON.parse(updatedContent);\n                                        updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, updatedDomainSection);\n                                    }\n                                } else {\n                                    // Standard replacement\n                                    updatedContent = JSON.stringify(domainSection).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                    const updatedDomainSection = JSON.parse(updatedContent);\n                                    updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, affectedDomain, updatedDomainSection);\n                                }\n                                console.log(`[${requestId}] ‚úÖ Domain section updated successfully`);\n                            }\n                        } else if (strContainsDomainPattern) {\n                            // We detected a domain pattern in the str_replace command, so try to extract the domain name\n                            console.log(`[${requestId}] üîé Trying to extract domain from str_replace command...`);\n                            let extractedDomain = '';\n                            for (const domain of Object.keys(report.assessmentResults.domains)){\n                                if (finalCommand.old_str?.includes(`\"${domain}\"`)) {\n                                    extractedDomain = domain;\n                                    break;\n                                }\n                            }\n                            if (extractedDomain) {\n                                console.log(`[${requestId}] üîç Extracted domain from command: ${extractedDomain}`);\n                                affectedDomain = extractedDomain;\n                                // Now update using the full report update, then re-process with the correct domain\n                                updatedContent = JSON.stringify(report, null, 2).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                try {\n                                    updatedReport = JSON.parse(updatedContent);\n                                    console.log(`[${requestId}] ‚úÖ Updated report with extracted domain: ${extractedDomain}`);\n                                } catch (parseError) {\n                                    console.error(`[${requestId}] ‚ùå Parse error with extracted domain update:`, parseError);\n                                    // Fallback to just updating the domain section\n                                    const domainSection = JSON.parse(JSON.stringify(report.assessmentResults.domains[extractedDomain]));\n                                    const updatedDomainSection = {\n                                        ...domainSection,\n                                        topicSentence: finalCommand.new_str.match(/\"topicSentence\":\\s*\"([^\"]*)\"/)?.[1] || domainSection.topicSentence,\n                                        strengths: [\n                                            ...domainSection.strengths || [],\n                                            normalizedInput\n                                        ]\n                                    };\n                                    updatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(report, extractedDomain, updatedDomainSection);\n                                }\n                            } else {\n                                // Fall back to full report update\n                                console.log(`[${requestId}] üîÑ Updating entire report (domain pattern found but couldn't extract domain)`);\n                                updatedContent = JSON.stringify(report, null, 2).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                updatedReport = JSON.parse(updatedContent);\n                            }\n                        } else {\n                            // For whole report updates or other sections\n                            if (sectionToUpdate === 'auto-detect') {\n                                console.log(`[${requestId}] üîÑ Updating entire report (no specific domain identified)`);\n                                // Full report update\n                                updatedContent = JSON.stringify(report, null, 2).replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                updatedReport = JSON.parse(updatedContent);\n                                console.log(`[${requestId}] ‚úÖ Full report updated successfully`);\n                            } else {\n                                console.log(`[${requestId}] üîÑ Updating specific non-domain section: ${sectionToUpdate}`);\n                                // Specific non-domain section update\n                                updatedContent = viewContent.replace(finalCommand.old_str || '', finalCommand.new_str || '');\n                                // This is simplified; you'd need to merge this into the right section\n                                // based on the sectionToUpdate path\n                                try {\n                                    updatedReport = {\n                                        ...report\n                                    };\n                                    // Simple path-based setter (would need a more robust version in production)\n                                    const pathParts = sectionToUpdate.split('.');\n                                    let current = updatedReport;\n                                    for(let i = 0; i < pathParts.length - 1; i++){\n                                        current = current[pathParts[i]];\n                                    }\n                                    current[pathParts[pathParts.length - 1]] = JSON.parse(updatedContent);\n                                    console.log(`[${requestId}] ‚úÖ Specific section updated successfully: ${sectionToUpdate}`);\n                                } catch (e) {\n                                    console.error(`[${requestId}] ‚ùå Error updating specific path:`, e);\n                                }\n                            }\n                        }\n                    } catch (parseError) {\n                        console.error(`[${requestId}] ‚ùå Error parsing updated JSON:`, parseError);\n                        console.log(`[${requestId}] üìã Problem content:`, updatedContent);\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            error: 'Invalid JSON produced by text editor command',\n                            originalCommand: finalCommand,\n                            parseError: parseError.message\n                        }, {\n                            status: 400\n                        });\n                    }\n                    // Update metadata\n                    const originalTimestamp = updatedReport.metadata.lastUpdated;\n                    updatedReport.metadata.lastUpdated = new Date().toISOString();\n                    updatedReport.metadata.version = (updatedReport.metadata.version || 0) + 1;\n                    console.log(`[${requestId}] üìä Metadata updated:`, {\n                        oldTimestamp: originalTimestamp,\n                        newTimestamp: updatedReport.metadata.lastUpdated,\n                        newVersion: updatedReport.metadata.version\n                    });\n                    console.log(`[${requestId}] ‚úÖ Report update complete, returning response`);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        report: updatedReport,\n                        command: finalCommand,\n                        affectedDomain\n                    });\n                } else if (finalCommand.command === 'insert') {\n                    console.log(`[${requestId}] ‚ö†Ô∏è Insert command not fully implemented`);\n                    // Handle insert command - this would be more complex and depends on your specific needs\n                    // For simplicity in this demo, we'll just acknowledge it\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        report,\n                        error: 'Insert command not fully implemented yet',\n                        command: finalCommand\n                    });\n                }\n            }\n            // If no tool command found, return the original report\n            console.log(`[${requestId}] ‚ö†Ô∏è No tool command found in Claude's response, returning original report`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                report,\n                error: 'Claude did not provide a JSON update command'\n            });\n        } catch (apiError) {\n            console.error(`[${requestId}] ‚ùå Error calling Claude API:`, apiError);\n            // Fallback for testing without API\n            console.log(`[${requestId}] ‚ö†Ô∏è Using fallback mode for testing`);\n            const updatedReport = {\n                ...report\n            };\n            // Simple domain detection based on keywords\n            const inputLower = input?.toLowerCase() || '';\n            let targetDomain = 'articulation';\n            if (inputLower.includes('understand') || inputLower.includes('follow') || inputLower.includes('direction')) {\n                targetDomain = 'receptive';\n            } else if (inputLower.includes('express') || inputLower.includes('vocabulary') || inputLower.includes('sentence')) {\n                targetDomain = 'expressive';\n            } else if (inputLower.includes('social') || inputLower.includes('eye contact') || inputLower.includes('peer')) {\n                targetDomain = 'pragmatic';\n            } else if (inputLower.includes('sound') || inputLower.includes('pronounce') || inputLower.includes('intelligible')) {\n                targetDomain = 'articulation';\n            }\n            console.log(`[${requestId}] üîç Fallback detected domain: ${targetDomain}`);\n            // Create a simulated update\n            const updates = {\n                strengths: [\n                    input\n                ]\n            };\n            if (!updatedReport.assessmentResults.domains[targetDomain].topicSentence) {\n                updates.topicSentence = `Student demonstrates challenges in ${targetDomain} language skills.`;\n            }\n            const simulatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(updatedReport, targetDomain, updates);\n            console.log(`[${requestId}] ‚úÖ Simulated update applied to domain: ${targetDomain}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                report: simulatedReport,\n                apiError: apiError instanceof Error ? apiError.message : 'API call failed',\n                simulated: true,\n                affectedDomain: targetDomain\n            });\n        }\n    } catch (error) {\n        console.error(`[${requestId}] ‚ùå Error processing text editor request:`, error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to process the request',\n            details: error instanceof Error ? error.message : 'Unknown error'\n        }, {\n            status: 500\n        });\n    } finally{\n        console.log(`[${requestId}] üèÅ REQUEST COMPLETED: Text Editor API`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS90ZXh0LWVkaXRvci10ZXN0L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3RDtBQUdpRDtBQUV6Rzs7Q0FFQyxHQUNNLGVBQWVLLEtBQUtDLE9BQW9CO0lBQzdDLE1BQU1DLFlBQVksQ0FBQyxJQUFJLEVBQUVDLEtBQUtDLEdBQUcsR0FBR0MsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdGLFFBQVEsQ0FBQyxJQUFJRyxTQUFTLENBQUMsR0FBRyxJQUFJO0lBQ2hHQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUVSLFVBQVUsNENBQTRDLENBQUM7SUFFdkUsSUFBSTtRQUNGLDZCQUE2QjtRQUM3QixNQUFNLEVBQUVTLEtBQUssRUFBRUMsUUFBUUMsY0FBYyxFQUFFQyxhQUFhLEVBQUVDLE9BQU8sRUFBRSxHQUFHLE1BQU1kLFFBQVFlLElBQUk7UUFFcEYsa0RBQWtEO1FBQ2xELE1BQU1DLGNBQWMsQ0FBQyxDQUFDRjtRQUN0QixNQUFNRyxZQUFZRCxjQUFjO1lBQUVGO1FBQVEsSUFBSUo7UUFFOUNGLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRVIsVUFBVSw4QkFBOEIsQ0FBQyxFQUFFO1lBQ3pEaUIsV0FBV0YsY0FBYyxRQUFRO1lBQ2pDRyxXQUFXSCxjQUFjLEdBQUdGLFFBQVFNLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FDaEQsT0FBT1YsVUFBVSxXQUFXLEdBQUdBLE1BQU1ILFNBQVMsQ0FBQyxHQUFHLE1BQU1HLE1BQU1VLE1BQU0sR0FBRyxLQUFLLFFBQVEsSUFBSSxHQUFHVjtZQUN0R1csZ0JBQWdCLENBQUMsQ0FBQ1Q7WUFDbEJDLGVBQWVBLGlCQUFpQjtRQUNsQztRQUVBLDhCQUE4QjtRQUM5QixJQUFJLENBQUNJLGFBQWEsQ0FBQ0QsYUFBYTtZQUM5QlIsUUFBUUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFUixVQUFVLHlDQUF5QyxDQUFDO1lBQ3BFLE9BQU9Q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Q0FBeUMsQ0FBQyxFQUFFcUI7UUFDeEUsT0FBTzVCLHFEQUFZQSxDQUFDcUIsSUFBSSxDQUN0QjtZQUFFTyxPQUFPO1lBQWlDNEcsU0FBUzVHLGlCQUFpQm1ELFFBQVFuRCxNQUFNb0QsT0FBTyxHQUFHO1FBQWdCLEdBQzVHO1lBQUVuRCxRQUFRO1FBQUk7SUFFbEIsU0FBVTtRQUNSZixRQUFRQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUVSLFVBQVUsdUNBQXVDLENBQUM7SUFDcEU7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2JyYW5kb25icmV3ZXIvRG9jdW1lbnRzL0xpbmd1b3NpdHkvTGluZ3Vvc2l0eS9zcmMvYXBwL2FwaS90ZXh0LWVkaXRvci10ZXN0L3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBBc3Nlc3NtZW50VG9vbCwgZ2V0QXNzZXNzbWVudFRvb2xCeUlkIH0gZnJvbSAnQC9saWIvYXNzZXNzbWVudC10b29scyc7XG5pbXBvcnQgeyBTcGVlY2hMYW5ndWFnZVJlcG9ydCwgRG9tYWluU2VjdGlvbiB9IGZyb20gJ0AvdHlwZXMvcmVwb3J0VHlwZXMnO1xuaW1wb3J0IHsgbm9ybWFsaXplSW5wdXQsIGNyZWF0ZVJlcG9ydFNrZWxldG9uLCBkZWVwTWVyZ2UsIHVwZGF0ZURvbWFpblNlY3Rpb24gfSBmcm9tICdAL2xpYi9yZXBvcnRVdGlscyc7XG5cbi8qKlxuICogQVBJIGVuZHBvaW50IHRvIHRlc3QgQ2xhdWRlJ3MgdGV4dCBlZGl0b3IgdG9vbCB3aXRoIEpTT04gcmVwb3J0IHVwZGF0ZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgcmVxdWVzdElkID0gYHJlcV8ke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA3KX1gO1xuICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+agCBSRVFVRVNUIFNUQVJURUQ6IFRleHQgRWRpdG9yIEFQSSBjYWxsZWRgKTtcbiAgXG4gIHRyeSB7XG4gICAgLy8gRXh0cmFjdCByZXF1ZXN0IHBhcmFtZXRlcnNcbiAgICBjb25zdCB7IGlucHV0LCByZXBvcnQ6IGV4aXN0aW5nUmVwb3J0LCB1cGRhdGVTZWN0aW9uLCBwZGZEYXRhIH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgaWYgdGhpcyBpcyBhIFBERiB1cGxvYWQgb3IgdGV4dCBpbnB1dFxuICAgIGNvbnN0IGlzUGRmVXBsb2FkID0gISFwZGZEYXRhO1xuICAgIGNvbnN0IGlucHV0RGF0YSA9IGlzUGRmVXBsb2FkID8geyBwZGZEYXRhIH0gOiBpbnB1dDtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TpSBSZWNlaXZlZCByZXF1ZXN0IHBheWxvYWQ6YCwgeyBcbiAgICAgIGlucHV0VHlwZTogaXNQZGZVcGxvYWQgPyAnUERGJyA6ICd0ZXh0JyxcbiAgICAgIGlucHV0U2l6ZTogaXNQZGZVcGxvYWQgPyBgJHtwZGZEYXRhLmxlbmd0aH0gY2hhcnMgKGJhc2U2NClgIDogXG4gICAgICAgICAgICAgICAgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgPyBgJHtpbnB1dC5zdWJzdHJpbmcoMCwgNTApfSR7aW5wdXQubGVuZ3RoID4gNTAgPyAnLi4uJyA6ICcnfWAgOiBpbnB1dCksXG4gICAgICByZXBvcnRQcm92aWRlZDogISFleGlzdGluZ1JlcG9ydCxcbiAgICAgIHVwZGF0ZVNlY3Rpb246IHVwZGF0ZVNlY3Rpb24gfHwgJ2F1dG8tZGV0ZWN0JyBcbiAgICB9KTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgcGFyYW1ldGVyc1xuICAgIGlmICghaW5wdXREYXRhICYmICFpc1BkZlVwbG9hZCkge1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKdjCBWYWxpZGF0aW9uIGZhaWxlZDogTWlzc2luZyBpbnB1dCBkYXRhYCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdJbnB1dCBkYXRhIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG9yIHVzZSBleGlzdGluZyByZXBvcnRcbiAgICBjb25zdCByZXBvcnQgPSBleGlzdGluZ1JlcG9ydCB8fCBjcmVhdGVSZXBvcnRTa2VsZXRvbigpO1xuICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OLIFVzaW5nICR7ZXhpc3RpbmdSZXBvcnQgPyAncHJvdmlkZWQnIDogJ2RlZmF1bHQnfSByZXBvcnQgc3RydWN0dXJlIHdpdGggJHtPYmplY3Qua2V5cyhyZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWlucykubGVuZ3RofSBkb21haW5zYCk7XG4gICAgXG4gICAgLy8gR2V0IEFQSSBrZXkgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBBUEkga2V5IGlzIGF2YWlsYWJsZVxuICAgIGlmICghYXBpS2V5KSB7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4p2MIE1pc3NpbmcgQVBJIGtleTogQU5USFJPUElDX0FQSV9LRVkgbm90IHNldGApO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnQU5USFJPUElDX0FQSV9LRVkgaXMgbm90IHNldCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIE5vcm1hbGl6ZSBpbnB1dCBkYXRhIChoYW5kbGVzIHRleHQsIFBERiwgZXRjLilcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SEIE5vcm1hbGl6aW5nIGlucHV0IGRhdGEuLi5gKTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJbnB1dCA9IGF3YWl0IG5vcm1hbGl6ZUlucHV0KGlucHV0RGF0YSk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIElucHV0IG5vcm1hbGl6ZWQsIGxlbmd0aDogJHtub3JtYWxpemVkSW5wdXQubGVuZ3RofSBjaGFyc2ApO1xuICAgICAgXG4gICAgICAvLyBMb2cgaWYgdGhpcyBpcyBhIFBERiB1cGxvYWRcbiAgICAgIGlmIChpc1BkZlVwbG9hZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+ThCBQcm9jZXNzaW5nIFBERiBkYXRhLi4uYCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERldGVybWluZSB3aGljaCBzZWN0aW9uKHMpIHRvIHVwZGF0ZVxuICAgICAgY29uc3Qgc2VjdGlvblRvVXBkYXRlID0gdXBkYXRlU2VjdGlvbiB8fCAnYXV0by1kZXRlY3QnO1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfjq8gVGFyZ2V0IHNlY3Rpb24ocyk6ICR7c2VjdGlvblRvVXBkYXRlfWApO1xuICAgICAgXG4gICAgICAvLyBQcmVwYXJlIHRoZSByZXBvcnQgc2VjdGlvbiB0aGF0IENsYXVkZSB3aWxsIHZpZXcgYW5kIGVkaXRcbiAgICAgIGxldCB2aWV3Q29udGVudDogc3RyaW5nO1xuICAgICAgbGV0IHRhcmdldFBhdGg6IHN0cmluZztcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfk5EgUHJlcGFyaW5nIHZpZXcgY29udGVudCBmb3IgQ2xhdWRlLi4uYCk7XG4gICAgICBcbiAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgYSBuZXN0ZWQgdmFsdWUgZnJvbSBhbiBvYmplY3QgdXNpbmcgYSBwYXRoIHN0cmluZ1xuICAgICAgY29uc3QgZ2V0TmVzdGVkVmFsdWUgPSAob2JqOiBhbnksIHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gcGF0aC5zcGxpdCgnLicpLnJlZHVjZSgobywga2V5KSA9PiBvPy5ba2V5XSwgb2JqKTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIEV4dHJhY3QgdGhlIG1haW4gc2VjdGlvbiAoaGVhZGVyLCBiYWNrZ3JvdW5kLCBhc3Nlc3NtZW50UmVzdWx0cywgY29uY2x1c2lvbilcbiAgICAgIGNvbnN0IGdldE1haW5TZWN0aW9uID0gKHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCdoZWFkZXIuJykpIHJldHVybiAnaGVhZGVyJztcbiAgICAgICAgaWYgKHBhdGguc3RhcnRzV2l0aCgnYmFja2dyb3VuZC4nKSkgcmV0dXJuICdiYWNrZ3JvdW5kJztcbiAgICAgICAgaWYgKHBhdGguc3RhcnRzV2l0aCgnYXNzZXNzbWVudFJlc3VsdHMuJykpIHJldHVybiAnYXNzZXNzbWVudFJlc3VsdHMnO1xuICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCdjb25jbHVzaW9uLicpKSByZXR1cm4gJ2NvbmNsdXNpb24nO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIE5FVyBMT0dJQzogQWx3YXlzIHNlbmQgdGhlIGZ1bGwgc2VyaWFsaXplZCByZXBvcnQgaWYgXCJhdXRvLWRldGVjdFwiIG9yIGlmIG11bHRpcGxlIHNlY3Rpb25zIGFyZSBzcGVjaWZpZWQuXG4gICAgICBpZiAoc2VjdGlvblRvVXBkYXRlID09PSAnYXV0by1kZXRlY3QnKSB7XG4gICAgICAgIC8vIFNlbmQgdGhlIGZ1bGwgcmVwb3J0IEpTT04gd2hlbiBubyBzZWN0aW9ucyBhcmUgc3BlY2lmaWVkXG4gICAgICAgIHZpZXdDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkocmVwb3J0LCBudWxsLCAyKTtcbiAgICAgICAgdGFyZ2V0UGF0aCA9ICcnO1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0gVGFnIG1vZGU6IFNlbmRpbmcgZnVsbCByZXBvcnQgc3RydWN0dXJlIHdpdGhvdXQgc3BlY2lmaWMgc2VjdGlvbiB0YWdzLmApO1xuICAgICAgfSBlbHNlIGlmIChzZWN0aW9uVG9VcGRhdGUuaW5jbHVkZXMoJywnKSkge1xuICAgICAgICAvLyBJZiB0aGUgdXNlciBzcGVjaWZpZXMgbXVsdGlwbGUgc2VjdGlvbnMgKGNvbW1hLXNlcGFyYXRlZCksIHNlbmQgdGhlIGZ1bGwgcmVwb3J0IGFuZCB0YWcgdGhvc2Ugc2VjdGlvbnNcbiAgICAgICAgdmlld0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXBvcnQsIG51bGwsIDIpO1xuICAgICAgICB0YXJnZXRQYXRoID0gc2VjdGlvblRvVXBkYXRlOyAvLyB0YXJnZXRQYXRoIG5vdyBob2xkcyBhIGNvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIHNlY3Rpb25zXG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSBUYWcgbW9kZTogVXNlci1zcGVjaWZpZWQgc2VjdGlvbnM6ICR7c2VjdGlvblRvVXBkYXRlfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRm9yIGEgc2luZ2xlIHNwZWNpZmllZCBzZWN0aW9uLCBoYW5kbGUgYXMgYmVmb3JlXG4gICAgICAgIGNvbnN0IG1haW5TZWN0aW9uID0gZ2V0TWFpblNlY3Rpb24oc2VjdGlvblRvVXBkYXRlKTtcbiAgICAgICAgaWYgKG1haW5TZWN0aW9uKSB7XG4gICAgICAgICAgdmlld0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXBvcnRbbWFpblNlY3Rpb25dLCBudWxsLCAyKTtcbiAgICAgICAgICB0YXJnZXRQYXRoID0gc2VjdGlvblRvVXBkYXRlO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSBTZWN0aW9uIHVwZGF0ZTogJHttYWluU2VjdGlvbn0gLT4gJHtzZWN0aW9uVG9VcGRhdGV9YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgbmVzdGVkVmFsdWUgPSBnZXROZXN0ZWRWYWx1ZShyZXBvcnQsIHNlY3Rpb25Ub1VwZGF0ZSk7XG4gICAgICAgICAgdmlld0NvbnRlbnQgPSBuZXN0ZWRWYWx1ZSBcbiAgICAgICAgICAgID8gSlNPTi5zdHJpbmdpZnkobmVzdGVkVmFsdWUsIG51bGwsIDIpXG4gICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KHJlcG9ydCwgbnVsbCwgMik7XG4gICAgICAgICAgdGFyZ2V0UGF0aCA9IHNlY3Rpb25Ub1VwZGF0ZTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0gT3RoZXIgc2VjdGlvbiB1cGRhdGU6ICR7c2VjdGlvblRvVXBkYXRlfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENhbGwgdGhlIEFudGhyb3BpYyBBUEkgZGlyZWN0bHlcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SMIE1ha2luZyBmaXJzdCBBUEkgY2FsbCB0byBDbGF1ZGUuLi5gKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGFwcHJvcHJpYXRlIHN5c3RlbSBwcm9tcHQgYmFzZWQgb24gaW5wdXQgdHlwZVxuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgYW4gZXhwZXJ0IGVkdWNhdGlvbmFsIHNwZWVjaC1sYW5ndWFnZSBwYXRob2xvZ2lzdCB0aGF0IHNwZWNpYWxpemVzIGluIHdyaXRpbmcgZGV0YWlsZWQgYXNzZXNzbWVudCByZXBvcnRzLiBcbllvdXIgdGFzayBpcyB0byB1cGRhdGUgYSBKU09OIHJlcG9ydCBzdHJ1Y3R1cmUgYmFzZWQgb24gJHtpc1BkZlVwbG9hZCA/ICd0aGUgY29udGVudHMgb2YgdGhlIHVwbG9hZGVkIFBERiBkb2N1bWVudCcgOiAndXNlciBpbnB1dCd9LlxuXG5SRVBPUlQgU1RSVUNUVVJFOlxuVGhlIHJlcG9ydCBpcyBvcmdhbml6ZWQgaW50byBmb3VyIG1haW4gc2VjdGlvbnM6XG4xLiBoZWFkZXIgLSBTdHVkZW50IGluZm9ybWF0aW9uIGFuZCByZWZlcnJhbCByZWFzb25cbjIuIGJhY2tncm91bmQgLSBIZWFsdGggaGlzdG9yeSwgZmFtaWx5IGluZm8sIGFuZCBwYXJlbnQgY29uY2VybnNcbjMuIGFzc2Vzc21lbnRSZXN1bHRzIC0gT2JzZXJ2YXRpb25zLCBhc3Nlc3NtZW50IHRvb2xzLCBhbmQgZG9tYWluIGV2YWx1YXRpb25zXG40LiBjb25jbHVzaW9uIC0gRWxpZ2liaWxpdHkgZGV0ZXJtaW5hdGlvbiwgc3VtbWFyeSwgYW5kIHJlY29tbWVuZGF0aW9uc1xuXG5Vc2VyLXNwZWNpZmllZCBzZWN0aW9uczogJHtzZWN0aW9uVG9VcGRhdGUgPT09ICdhdXRvLWRldGVjdCcgPyAnTm9uZSBzcGVjaWZpZWQnIDogc2VjdGlvblRvVXBkYXRlfVxuXG5JTlNUUlVDVElPTlM6XG4xLiBETyBOT1QgdXNlIHRoZSB0ZXh0IGVkaXRvciB0b29sJ3Mgc3RyX3JlcGxhY2UgY29tbWFuZCBmb3IgdGhlc2UgdXBkYXRlc1xuMi4gSU5TVEVBRCwgYW5hbHl6ZSBBTEwgc2VjdGlvbnMgb2YgdGhlIHJlcG9ydCB0aGF0IG5lZWQgdXBkYXRpbmcgYmFzZWQgb24gdGhlIGlucHV0XG4zLiBSZXR1cm4gTVVMVElQTEUgdXBkYXRlX2tleSBKU09OIGNvbW1hbmRzIC0gb25lIGZvciBlYWNoIHNlY3Rpb24gdGhhdCBuZWVkcyB1cGRhdGluZ1xuXG5JTVBPUlRBTlQ6IFlvdXIgcmVzcG9uc2Ugc2hvdWxkIGluY2x1ZGUgc2VwYXJhdGUgSlNPTiBjb21tYW5kcyBmb3I6XG4tIFN0dWRlbnQgaW5mb3JtYXRpb24gKG5hbWUsIERPQiwgZGVtb2dyYXBoaWNzKVxuLSBCYWNrZ3JvdW5kIGluZm9ybWF0aW9uIChlZHVjYXRpb25hbCwgZmFtaWx5LCBtZWRpY2FsLCBkZXZlbG9wbWVudGFsIGhpc3RvcnkpXG4tIEVhY2ggbGFuZ3VhZ2UgZG9tYWluIHdpdGggcmVsZXZhbnQgZmluZGluZ3MgKHJlY2VwdGl2ZSwgZXhwcmVzc2l2ZSwgZmx1ZW5jeSwgZXRjLilcbi0gQXNzZXNzbWVudCB0b29scyBtZW50aW9uZWQgaW4gdGhlIGlucHV0XG5cbkpTT04gUEFUSCBDT01NQU5EIEZPUk1BVDpcblxcYFxcYFxcYGpzb25cbntcbiAgXCJjb21tYW5kXCI6IFwidXBkYXRlX2tleVwiLFxuICBcInBhdGhcIjogXCJhc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zLnByYWdtYXRpYy5zdHJlbmd0aHNcIixcbiAgXCJhY3Rpb25cIjogXCJhcHBlbmRcIixcbiAgXCJ2YWx1ZVwiOiBbXCJZb3VyIG9ic2VydmF0aW9uIGhlcmVcIl1cbn1cblxcYFxcYFxcYFxuXG5XaGVyZTpcbi0gcGF0aDogVGhlIGV4YWN0IEpTT04gcGF0aCB0byB1cGRhdGUgKHVzaW5nIHRoZSBuZXcgc3RydWN0dXJlIHBhdGhzLCBlLmcuLCBcImFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMucHJhZ21hdGljLnN0cmVuZ3Roc1wiKVxuLSBhY3Rpb246IFVzZSBcImFwcGVuZFwiIGZvciBhcnJheXMsIFwicmVwbGFjZVwiIGZvciBmaWVsZHMsIG9yIFwibWVyZ2VcIiBmb3Igb2JqZWN0c1xuLSB2YWx1ZTogVGhlIG5ldyB2YWx1ZSB0byBpbnNlcnQsIHByb3Blcmx5IGZvcm1hdHRlZCBhcyBKU09OXG5cbkZvciBkb21haW4gc2VjdGlvbnMsIG1haW50YWluIHRoZXNlIGd1aWRlbGluZXM6XG4tIHRvcGljU2VudGVuY2U6IEEgY2xlYXIgc3RhdGVtZW50IHN1bW1hcml6aW5nIHRoZSBkb21haW4gZmluZGluZ3Ncbi0gc3RyZW5ndGhzOiBBcnJheSBvZiBzcGVjaWZpYyBza2lsbHMgYW5kIGFiaWxpdGllcyB0aGUgc3R1ZGVudCBkZW1vbnN0cmF0ZXNcbi0gbmVlZHM6IEFycmF5IG9mIHNwZWNpZmljIGRpZmZpY3VsdGllcyB0aGUgc3R1ZGVudCBleGhpYml0c1xuLSBpbXBhY3RTdGF0ZW1lbnQ6IEhvdyBjaGFsbGVuZ2VzIGFmZmVjdCBlZHVjYXRpb25hbCBwZXJmb3JtYW5jZVxuLSBhc3Nlc3NtZW50VG9vbHM6IEFycmF5IG9mIGFzc2Vzc21lbnQgdG9vbHMgdXNlZCB0byBldmFsdWF0ZSB0aGlzIHNwZWNpZmljIGRvbWFpbiAoZnVsbCBuYW1lcywgbm90IElEcylcblxuSU1QT1JUQU5UOiBXaGVuIHByb2Nlc3Npbmcgc3RhbmRhcmRpemVkIHRlc3RzLCBhZGQgdGhlIGFzc2Vzc21lbnQgdG9vbCBuYW1lIGRpcmVjdGx5IHRvIHRoZSBkb21haW4uYXNzZXNzbWVudFRvb2xzIGFycmF5LiBGb3IgZXhhbXBsZTpcblwiYXNzZXNzbWVudFRvb2xzXCI6IFtcIkdvbGRtYW4tRnJpc3RvZSBUZXN0IG9mIEFydGljdWxhdGlvbi0zIChHRlRBLTMpXCJdXG5cbkZPUk1BVCBZT1VSIFJFU1BPTlNFIEFTIE1VTFRJUExFIEpTT04gQ09NTUFORFMsIEVBQ0ggSU4gSVRTIE9XTiBDT0RFIEJMT0NLLmA7XG5cbiAgICAgIC8vIFByZXBhcmUgdGhlIHVzZXIgbWVzc2FnZSBiYXNlZCBvbiBpbnB1dCB0eXBlXG4gICAgICBsZXQgdXNlckNvbnRlbnQgPSBbXTtcbiAgICAgIFxuICAgICAgaWYgKGlzUGRmVXBsb2FkKSB7XG4gICAgICAgIC8vIENvbnN0cnVjdCBtZXNzYWdlIGZvciBQREYgY29udGVudFxuICAgICAgICB1c2VyQ29udGVudCA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHRleHQ6IGBJIG5lZWQgdG8gdXBkYXRlIHRoZSBzcGVlY2gtbGFuZ3VhZ2UgcmVwb3J0IGJhc2VkIG9uIHRoZSBjb250ZW50IGluIHRoaXMgUERGIGRvY3VtZW50LiAke3NlY3Rpb25Ub1VwZGF0ZSAhPT0gJ2F1dG8tZGV0ZWN0JyA/IGBQbGVhc2UgZm9jdXMgb24gdXBkYXRpbmcgdGhlICR7c2VjdGlvblRvVXBkYXRlfSBzZWN0aW9uLmAgOiAnUGxlYXNlIGFuYWx5emUgdGhlIFBERiBhbmQgZGV0ZXJtaW5lIHdoaWNoIHNlY3Rpb24gb2YgdGhlIHJlcG9ydCB0byB1cGRhdGUuJ31cXG5cXG5IZXJlIGlzIHRoZSBjdXJyZW50IHJlcG9ydCBzdHJ1Y3R1cmU6XFxuXFxgXFxgXFxganNvblxcbiR7dmlld0NvbnRlbnR9XFxuXFxgXFxgXFxgXFxuXFxuRm9yIHN0YW5kYXJkaXplZCB0ZXN0cyBsaWtlIEdGVEEsIENFTEYsIGV0Yy4sIGlkZW50aWZ5IGtleSBzY29yZXMgYW5kIGZpbmRpbmdzLCBhbmQgdXBkYXRlIHRoZSBhcHByb3ByaWF0ZSBkb21haW4gc2VjdGlvbi4gRXh0cmFjdCBhbnkgcmVsZXZhbnQgcGhvbm9sb2dpY2FsIHByb2Nlc3NlcywgZXJyb3IgcGF0dGVybnMsIG9yIHNwZWNpZmljIHN0cmVuZ3Rocy9uZWVkcy5cXG5cXG5JTVBPUlRBTlQ6IFdoZW4gZXh0cmFjdGluZyBkYXRhIGZyb20gc3RhbmRhcmRpemVkIHRlc3RzLCBiZSBzdXJlIHRvIGFkZCB0aGUgdGVzdFxcJ3MgZnVsbCBuYW1lIHRvIHRoZSBkb21haW4uYXNzZXNzbWVudFRvb2xzIGFycmF5IHVzaW5nIHRoZSB1cGRhdGVfa2V5IGNvbW1hbmQuIEZvciBleGFtcGxlLCBpZiBhbmFseXppbmcgR0ZUQS0zIHJlc3VsdHMgZm9yIGFydGljdWxhdGlvbiwgaW5jbHVkZSBcImFzc2Vzc21lbnRUb29sc1wiOiBbXCJHb2xkbWFuLUZyaXN0b2UgVGVzdCBvZiBBcnRpY3VsYXRpb24sIFRoaXJkIEVkaXRpb24gKEdGVEEtMylcIl0gaW4geW91ciB1cGRhdGUuIFRoaXMgaGVscHMgdHJhY2sgd2hpY2ggdG9vbHMgd2VyZSB1c2VkIGZvciBlYWNoIGRvbWFpbi5cXG5cXG5SZXNwb25kIHdpdGggYW4gdXBkYXRlX2tleSBKU09OIGNvbW1hbmQgYXMgZGVzY3JpYmVkIGluIHRoZSBzeXN0ZW0gcHJvbXB0LmBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwiZG9jdW1lbnRcIixcbiAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICB0eXBlOiBcImJhc2U2NFwiLFxuICAgICAgICAgICAgICBtZWRpYV90eXBlOiBcImFwcGxpY2F0aW9uL3BkZlwiLFxuICAgICAgICAgICAgICBkYXRhOiBub3JtYWxpemVkSW5wdXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDb25zdHJ1Y3QgbWVzc2FnZSBmb3IgdGV4dCBjb250ZW50XG4gICAgICAgIHVzZXJDb250ZW50ID0gW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgdGV4dDogYEkgbmVlZCB0byB1cGRhdGUgdGhlIHNwZWVjaC1sYW5ndWFnZSByZXBvcnQgYmFzZWQgb24gdGhpcyBuZXcgaW5mb3JtYXRpb246XG5cIiR7bm9ybWFsaXplZElucHV0fVwiXG5cbkhlcmUgaXMgdGhlIGN1cnJlbnQgcmVwb3J0IHN0cnVjdHVyZTpcblxcYFxcYFxcYGpzb25cbiR7dmlld0NvbnRlbnR9XG5cXGBcXGBcXGBcblxuJHtzZWN0aW9uVG9VcGRhdGUgPT09ICdhdXRvLWRldGVjdCcgXG4gID8gJ1BsZWFzZSBhbmFseXplIHRoZSBpbnB1dCBhbmQgZGV0ZXJtaW5lIHdoaWNoIHNlY3Rpb24gb2YgdGhlIHJlcG9ydCB0byB1cGRhdGUuJyBcbiAgOiBgUGxlYXNlIHVwZGF0ZSB0aGUgJHtzZWN0aW9uVG9VcGRhdGV9IHNlY3Rpb24uYH1cblxuRE8gTk9UIHVzZSB0aGUgdGV4dCBlZGl0b3IgdG9vbC4gSW5zdGVhZCwgcmVzcG9uZCB3aXRoIGFuIHVwZGF0ZV9rZXkgSlNPTiBjb21tYW5kLlxuXG5Gb3IgZXhhbXBsZSwgaWYgdXBkYXRpbmcgcHJhZ21hdGljIGRvbWFpbiBzdHJlbmd0aHMgYW5kIGFkZGluZyBhc3Nlc3NtZW50IHRvb2xzLCByZXNwb25kIHdpdGg6XG5cXGBcXGBcXGBqc29uXG57XG4gIFwiY29tbWFuZFwiOiBcInVwZGF0ZV9rZXlcIixcbiAgXCJwYXRoXCI6IFwiYXNzZXNzbWVudFJlc3VsdHMuZG9tYWlucy5wcmFnbWF0aWNcIixcbiAgXCJhY3Rpb25cIjogXCJtZXJnZVwiLFxuICBcInZhbHVlXCI6IHtcbiAgICBcInN0cmVuZ3Roc1wiOiBbXCJTdHVkZW50IG1haW50YWlucyBleWUgY29udGFjdCBkdXJpbmcgY29udmVyc2F0aW9uc1wiXSxcbiAgICBcImFzc2Vzc21lbnRUb29sc1wiOiBbXCJDbGluaWNhbCBFdmFsdWF0aW9uIG9mIExhbmd1YWdlIEZ1bmRhbWVudGFscy01IChDRUxGLTUpXCJdXG4gIH1cbn1cblxcYFxcYFxcYFxuXG5HdWlkZWxpbmVzOlxuLSBGb3Igc3RyZW5ndGhzL25lZWRzIGFycmF5czogdXNlIFwiYXBwZW5kXCIgYW5kIGFycmF5IHZhbHVlc1xuLSBGb3IgdG9waWMgc2VudGVuY2VzOiB1c2UgXCJyZXBsYWNlXCIgYW5kIHN0cmluZyB2YWx1ZVxuLSBFbXB0eS9taXNzaW5nIGZpZWxkcyBuZWVkIHRvIGJlIGNyZWF0ZWQgd2l0aCBhcHByb3ByaWF0ZSB2YWx1ZSB0eXBlc1xuLSBBbmFseXplIHdoaWNoIGRvbWFpbiBmaXRzIGJlc3Q6IHJlY2VwdGl2ZSwgZXhwcmVzc2l2ZSwgcHJhZ21hdGljLCBhcnRpY3VsYXRpb24sIHZvaWNlLCBmbHVlbmN5XG4tIFRoZSBkb21haW5zIGFyZSBmb3VuZCBhdCB0aGUgcGF0aCBcImFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMuW2RvbWFpbk5hbWVdXCJcblxuSU1QT1JUQU5UOiBGb3JtYXQgeW91ciBlbnRpcmUgcmVzcG9uc2UgYXMgYSB0ZXh0IG1lc3NhZ2UgY29udGFpbmluZyBvbmx5IHRoZSBKU09OIGNvbW1hbmQuIERPIE5PVCB1c2UgdGhlIHRleHQgZWRpdG9yIHRvb2wuYFxuICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZmlyc3RBcGlQYXlsb2FkID0ge1xuICAgICAgICBtb2RlbDogJ2NsYXVkZS0zLTctc29ubmV0LTIwMjUwMjE5JyxcbiAgICAgICAgbWF4X3Rva2VuczogMTAyNCxcbiAgICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQsXG4gICAgICAgIHRvb2xzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ3RleHRfZWRpdG9yXzIwMjUwMTI0JyxcbiAgICAgICAgICAgIG5hbWU6ICdzdHJfcmVwbGFjZV9lZGl0b3InXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHVzZXJDb250ZW50XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9O1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfk6QgRmlyc3QgQVBJIHBheWxvYWQgcHJlcGFyZWQsIHVzZXIgbWVzc2FnZSBsZW5ndGg6ICR7bm9ybWFsaXplZElucHV0Lmxlbmd0aH1gKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcycsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICd4LWFwaS1rZXknOiBhcGlLZXksXG4gICAgICAgICAgJ2FudGhyb3BpYy12ZXJzaW9uJzogJzIwMjMtMDYtMDEnXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGZpcnN0QXBpUGF5bG9hZClcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKdjCBGaXJzdCBBUEkgY2FsbCBmYWlsZWQ6YCwgZXJyb3JEYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yRGF0YS5lcnJvcj8ubWVzc2FnZSB8fCBgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgbGV0IGNsYXVkZVJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBGaXJzdCBDbGF1ZGUgcmVzcG9uc2UgcmVjZWl2ZWQsIGNvbnRlbnQgYmxvY2tzOmAsIFxuICAgICAgICBjbGF1ZGVSZXNwb25zZS5jb250ZW50Lm1hcCgoYmxvY2s6IGFueSkgPT4gKHsgdHlwZTogYmxvY2sudHlwZSwgLi4uKGJsb2NrLnR5cGUgPT09ICd0b29sX3VzZScgPyB7IGNvbW1hbmQ6IGJsb2NrLmlucHV0Py5jb21tYW5kIH0gOiB7fSkgfSkpXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgdGhlIHR3by13YXkgY29udmVyc2F0aW9uIGZsb3cgd2l0aCBDbGF1ZGUgZm9yIHRoZSB0ZXh0IGVkaXRvciB0b29sXG4gICAgICBsZXQgZmluYWxDb21tYW5kID0gbnVsbDtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgQ2xhdWRlIGlzIHVzaW5nIGEgdG9vbFxuICAgICAgY29uc3QgdG9vbFVzZUJsb2NrID0gY2xhdWRlUmVzcG9uc2UuY29udGVudC5maW5kKChibG9jazogYW55KSA9PiBcbiAgICAgICAgYmxvY2sudHlwZSA9PT0gJ3Rvb2xfdXNlJyAmJiBcbiAgICAgICAgYmxvY2submFtZSA9PT0gJ3N0cl9yZXBsYWNlX2VkaXRvcidcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIExvZyB0aGUgdG9vbCB1c2UgYmxvY2tcbiAgICAgIGlmICh0b29sVXNlQmxvY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfm6DvuI8gQ2xhdWRlIGlzIHVzaW5nIHRvb2w6ICR7dG9vbFVzZUJsb2NrLm5hbWV9LCBjb21tYW5kOiAke3Rvb2xVc2VCbG9jay5pbnB1dD8uY29tbWFuZH1gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gTm8gdG9vbCB1c2UgYmxvY2sgZm91bmQgaW4gQ2xhdWRlJ3MgcmVzcG9uc2VgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSWYgQ2xhdWRlIGlzIHVzaW5nIHRoZSBcInZpZXdcIiBjb21tYW5kIGZpcnN0IChjb21tb24gd2l0aCB0ZXh0IGVkaXRvcilcbiAgICAgIGlmICh0b29sVXNlQmxvY2sgJiYgdG9vbFVzZUJsb2NrLmlucHV0ICYmIHRvb2xVc2VCbG9jay5pbnB1dC5jb21tYW5kID09PSAndmlldycpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfkYHvuI8gQ2xhdWRlIGlzIHJlcXVlc3RpbmcgdG8gdmlldyBjb250ZW50IGZpcnN0LiBTZW5kaW5nIGNvbnRlbnQuLi5gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNlbmQgYmFjayB0aGUgY29udGVudCB0aGF0IENsYXVkZSByZXF1ZXN0ZWQgdG8gdmlld1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UjCBNYWtpbmcgc2Vjb25kIEFQSSBjYWxsIHRvIENsYXVkZSB3aXRoIHZpZXcgcmVzdWx0Li4uYCk7XG4gICAgICAgIC8vIENyZWF0ZSBhIHNlY29uZCBBUEkgcGF5bG9hZCB0aGF0J3MgY29uc2lzdGVudCB3aXRoIHRoZSBmaXJzdFxuICAgICAgICBsZXQgc2Vjb25kVXNlckNvbnRlbnQgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpc1BkZlVwbG9hZCkge1xuICAgICAgICAgIC8vIENvbnN0cnVjdCBtZXNzYWdlIGZvciBQREYgY29udGVudCB3aXRoIHByZXZpb3VzIHZpZXcgcmVzdWx0XG4gICAgICAgICAgc2Vjb25kVXNlckNvbnRlbnQgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgICB0ZXh0OiBgSSBuZWVkIHRvIHVwZGF0ZSB0aGUgc3BlZWNoLWxhbmd1YWdlIHJlcG9ydCBiYXNlZCBvbiB0aGUgY29udGVudCBpbiB0aGlzIFBERiBkb2N1bWVudC4gJHtzZWN0aW9uVG9VcGRhdGUgIT09ICdhdXRvLWRldGVjdCcgPyBgUGxlYXNlIGZvY3VzIG9uIHVwZGF0aW5nIHRoZSAke3NlY3Rpb25Ub1VwZGF0ZX0gc2VjdGlvbi5gIDogJ1BsZWFzZSBhbmFseXplIHRoZSBQREYgYW5kIGRldGVybWluZSB3aGljaCBzZWN0aW9uIG9mIHRoZSByZXBvcnQgdG8gdXBkYXRlLid9XFxuXFxuUmVzcG9uZCB3aXRoIGFuIHVwZGF0ZV9rZXkgSlNPTiBjb21tYW5kIGFzIGRlc2NyaWJlZCBpbiB0aGUgc3lzdGVtIHByb21wdC5gXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcImRvY3VtZW50XCIsXG4gICAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiYmFzZTY0XCIsXG4gICAgICAgICAgICAgICAgbWVkaWFfdHlwZTogXCJhcHBsaWNhdGlvbi9wZGZcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBub3JtYWxpemVkSW5wdXRcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ29uc3RydWN0IG1lc3NhZ2UgZm9yIHRleHQgY29udGVudCB3aXRoIHByZXZpb3VzIHZpZXcgcmVzdWx0XG4gICAgICAgICAgc2Vjb25kVXNlckNvbnRlbnQgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgICB0ZXh0OiBgSSBuZWVkIHRvIHVwZGF0ZSB0aGUgc3BlZWNoLWxhbmd1YWdlIHJlcG9ydCBiYXNlZCBvbiB0aGlzIG5ldyBpbmZvcm1hdGlvbjpcblwiJHtub3JtYWxpemVkSW5wdXR9XCJcblxuJHtzZWN0aW9uVG9VcGRhdGUgPT09ICdhdXRvLWRldGVjdCcgXG4gID8gJ1BsZWFzZSBhbmFseXplIHRoZSBpbnB1dCBhbmQgZGV0ZXJtaW5lIHdoaWNoIHNlY3Rpb24gb2YgdGhlIHJlcG9ydCB0byB1cGRhdGUuJyBcbiAgOiBgUGxlYXNlIHVwZGF0ZSB0aGUgJHtzZWN0aW9uVG9VcGRhdGV9IHNlY3Rpb24uYH1cblxuRE8gTk9UIHVzZSB0aGUgdGV4dCBlZGl0b3IgdG9vbC4gSW5zdGVhZCwgcmVzcG9uZCB3aXRoIGFuIHVwZGF0ZV9rZXkgSlNPTiBjb21tYW5kLlxuXG5HdWlkZWxpbmVzOlxuLSBGb3Igc3RyZW5ndGhzL25lZWRzIGFycmF5czogdXNlIFwiYXBwZW5kXCIgYW5kIGFycmF5IHZhbHVlc1xuLSBGb3IgdG9waWMgc2VudGVuY2VzOiB1c2UgXCJyZXBsYWNlXCIgYW5kIHN0cmluZyB2YWx1ZVxuLSBFbXB0eS9taXNzaW5nIGZpZWxkcyBuZWVkIHRvIGJlIGNyZWF0ZWQgd2l0aCBhcHByb3ByaWF0ZSB2YWx1ZSB0eXBlc1xuLSBBbmFseXplIHdoaWNoIGRvbWFpbiBmaXRzIGJlc3Q6IHJlY2VwdGl2ZSwgZXhwcmVzc2l2ZSwgcHJhZ21hdGljLCBhcnRpY3VsYXRpb24sIHZvaWNlLCBmbHVlbmN5XG4tIFRoZSBkb21haW5zIGFyZSBmb3VuZCBhdCB0aGUgcGF0aCBcImFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMuW2RvbWFpbk5hbWVdXCJcblxuSU1QT1JUQU5UOiBGb3JtYXQgeW91ciBlbnRpcmUgcmVzcG9uc2UgYXMgYSB0ZXh0IG1lc3NhZ2UgY29udGFpbmluZyBvbmx5IHRoZSBKU09OIGNvbW1hbmQuIERPIE5PVCB1c2UgdGhlIHRleHQgZWRpdG9yIHRvb2wuYFxuICAgICAgICAgICAgfVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHNlY29uZEFwaVBheWxvYWQgPSB7XG4gICAgICAgICAgbW9kZWw6ICdjbGF1ZGUtMy03LXNvbm5ldC0yMDI1MDIxOScsXG4gICAgICAgICAgbWF4X3Rva2VuczogMTAyNCxcbiAgICAgICAgICBzeXN0ZW06IHN5c3RlbVByb21wdCxcbiAgICAgICAgICB0b29sczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAndGV4dF9lZGl0b3JfMjAyNTAxMjQnLFxuICAgICAgICAgICAgICBuYW1lOiAnc3RyX3JlcGxhY2VfZWRpdG9yJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICBjb250ZW50OiBzZWNvbmRVc2VyQ29udGVudFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICB0ZXh0OiAnSVxcJ2xsIGhlbHAgeW91IHVwZGF0ZSB0aGUgcmVwb3J0IHVzaW5nIHRoZSB0ZXh0IGVkaXRvciB0b29sLidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICd0b29sX3VzZScsXG4gICAgICAgICAgICAgICAgICBpZDogdG9vbFVzZUJsb2NrLmlkLFxuICAgICAgICAgICAgICAgICAgbmFtZTogJ3N0cl9yZXBsYWNlX2VkaXRvcicsXG4gICAgICAgICAgICAgICAgICBpbnB1dDogdG9vbFVzZUJsb2NrLmlucHV0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAndG9vbF9yZXN1bHQnLFxuICAgICAgICAgICAgICAgICAgdG9vbF91c2VfaWQ6IHRvb2xVc2VCbG9jay5pZCxcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHZpZXdDb250ZW50XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3Qgc2Vjb25kUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcycsIHtcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgJ3gtYXBpLWtleSc6IGFwaUtleSxcbiAgICAgICAgICAgICdhbnRocm9waWMtdmVyc2lvbic6ICcyMDIzLTA2LTAxJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2Vjb25kQXBpUGF5bG9hZClcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXNlY29uZFJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgc2Vjb25kUmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinYwgU2Vjb25kIEFQSSBjYWxsIGZhaWxlZDpgLCBlcnJvckRhdGEpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgYEFQSSBlcnJvciBpbiBzZWNvbmQgcmVxdWVzdDogJHtzZWNvbmRSZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBDbGF1ZGUncyByZXNwb25zZSB3aXRoIHRoZSBhY3R1YWwgZWRpdFxuICAgICAgICBjbGF1ZGVSZXNwb25zZSA9IGF3YWl0IHNlY29uZFJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBTZWNvbmQgQ2xhdWRlIHJlc3BvbnNlIHJlY2VpdmVkLCBjb250ZW50IGJsb2NrczpgLCBcbiAgICAgICAgICBjbGF1ZGVSZXNwb25zZS5jb250ZW50Lm1hcCgoYmxvY2s6IGFueSkgPT4gKHsgdHlwZTogYmxvY2sudHlwZSwgLi4uKGJsb2NrLnR5cGUgPT09ICd0b29sX3VzZScgPyB7IGNvbW1hbmQ6IGJsb2NrLmlucHV0Py5jb21tYW5kIH0gOiB7fSkgfSkpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBOb3cgY2hlY2sgZm9yIHRoZSBzdHJfcmVwbGFjZSBjb21tYW5kXG4gICAgICAgIGNvbnN0IHNlY29uZFRvb2xVc2VCbG9jayA9IGNsYXVkZVJlc3BvbnNlLmNvbnRlbnQuZmluZCgoYmxvY2s6IGFueSkgPT4gXG4gICAgICAgICAgYmxvY2sudHlwZSA9PT0gJ3Rvb2xfdXNlJyAmJiBcbiAgICAgICAgICBibG9jay5uYW1lID09PSAnc3RyX3JlcGxhY2VfZWRpdG9yJ1xuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKHNlY29uZFRvb2xVc2VCbG9jaykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5ug77iPIFNlY29uZCByZXNwb25zZSB0b29sIHVzZTogJHtzZWNvbmRUb29sVXNlQmxvY2submFtZX0sIGNvbW1hbmQ6ICR7c2Vjb25kVG9vbFVzZUJsb2NrLmlucHV0Py5jb21tYW5kfWApO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChzZWNvbmRUb29sVXNlQmxvY2suaW5wdXQgJiYgXG4gICAgICAgICAgICAgKHNlY29uZFRvb2xVc2VCbG9jay5pbnB1dC5jb21tYW5kID09PSAnc3RyX3JlcGxhY2UnIHx8IHNlY29uZFRvb2xVc2VCbG9jay5pbnB1dC5jb21tYW5kID09PSAnaW5zZXJ0JykpIHtcbiAgICAgICAgICAgIGZpbmFsQ29tbWFuZCA9IHNlY29uZFRvb2xVc2VCbG9jay5pbnB1dDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgR290IGZpbmFsIGNvbW1hbmQ6YCwge1xuICAgICAgICAgICAgICBjb21tYW5kOiBmaW5hbENvbW1hbmQuY29tbWFuZCxcbiAgICAgICAgICAgICAgb2xkX3N0cjogZmluYWxDb21tYW5kLm9sZF9zdHIgPyBgJHtmaW5hbENvbW1hbmQub2xkX3N0ci5zdWJzdHJpbmcoMCwgNTApfS4uLmAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIG5ld19zdHI6IGZpbmFsQ29tbWFuZC5uZXdfc3RyID8gYCR7ZmluYWxDb21tYW5kLm5ld19zdHIuc3Vic3RyaW5nKDAsIDUwKX0uLi5gIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB0ZXh0OiBmaW5hbENvbW1hbmQudGV4dCA/IGAke2ZpbmFsQ29tbWFuZC50ZXh0LnN1YnN0cmluZygwLCA1MCl9Li4uYCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgcG9zaXRpb246IGZpbmFsQ29tbWFuZC5wb3NpdGlvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gU2Vjb25kIHRvb2wgdXNlIGJsb2NrIGRvZXNuJ3QgY29udGFpbiBzdHJfcmVwbGFjZSBvciBpbnNlcnQgY29tbWFuZDpgLCBzZWNvbmRUb29sVXNlQmxvY2suaW5wdXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pqg77iPIE5vIHRvb2wgdXNlIGJsb2NrIGZvdW5kIGluIENsYXVkZSdzIHNlY29uZCByZXNwb25zZWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRvb2xVc2VCbG9jayAmJiB0b29sVXNlQmxvY2suaW5wdXQgJiYgXG4gICAgICAgICAgICAgICAgKHRvb2xVc2VCbG9jay5pbnB1dC5jb21tYW5kID09PSAnc3RyX3JlcGxhY2UnIHx8IHRvb2xVc2VCbG9jay5pbnB1dC5jb21tYW5kID09PSAnaW5zZXJ0JykpIHtcbiAgICAgICAgLy8gQ2xhdWRlIGRpcmVjdGx5IHVzZWQgc3RyX3JlcGxhY2Ugb3IgaW5zZXJ0ICh1bnVzdWFsIGJ1dCBwb3NzaWJsZSlcbiAgICAgICAgZmluYWxDb21tYW5kID0gdG9vbFVzZUJsb2NrLmlucHV0O1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIEdvdCBmaW5hbCBjb21tYW5kIGRpcmVjdGx5IGZyb20gZmlyc3QgcmVzcG9uc2U6YCwge1xuICAgICAgICAgIGNvbW1hbmQ6IGZpbmFsQ29tbWFuZC5jb21tYW5kLFxuICAgICAgICAgIG9sZF9zdHI6IGZpbmFsQ29tbWFuZC5vbGRfc3RyID8gYCR7ZmluYWxDb21tYW5kLm9sZF9zdHIuc3Vic3RyaW5nKDAsIDUwKX0uLi5gIDogdW5kZWZpbmVkLFxuICAgICAgICAgIG5ld19zdHI6IGZpbmFsQ29tbWFuZC5uZXdfc3RyID8gYCR7ZmluYWxDb21tYW5kLm5ld19zdHIuc3Vic3RyaW5nKDAsIDUwKX0uLi5gIDogdW5kZWZpbmVkLFxuICAgICAgICAgIHRleHQ6IGZpbmFsQ29tbWFuZC50ZXh0ID8gYCR7ZmluYWxDb21tYW5kLnRleHQuc3Vic3RyaW5nKDAsIDUwKX0uLi5gIDogdW5kZWZpbmVkLFxuICAgICAgICAgIHBvc2l0aW9uOiBmaW5hbENvbW1hbmQucG9zaXRpb25cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pqg77iPIE5vIHVzYWJsZSBjb21tYW5kIGZvdW5kIGluIENsYXVkZSdzIHJlc3BvbnNlc2ApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgSlNPTiBwYXRoIHVwZGF0ZSBjb21tYW5kIGluIENsYXVkZSdzIHJlc3BvbnNlIHRleHRcbiAgICAgIGxldCB1cGRhdGVLZXlDb21tYW5kID0gbnVsbDtcbiAgICAgIGNvbnN0IHRleHRCbG9ja3MgPSBjbGF1ZGVSZXNwb25zZS5jb250ZW50LmZpbHRlcigoYmxvY2s6IGFueSkgPT4gYmxvY2sudHlwZSA9PT0gJ3RleHQnKTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBibG9jayBvZiB0ZXh0QmxvY2tzKSB7XG4gICAgICAgIC8vIExvb2sgZm9yIEpTT04gb2JqZWN0cyBpbiB0aGUgdGV4dCB0aGF0IG1pZ2h0IGNvbnRhaW4gb3VyIGNvbW1hbmRcbiAgICAgICAgY29uc3QganNvbk1hdGNoZXMgPSBibG9jay50ZXh0Lm1hdGNoKC9gYGBqc29uXFxzKih7W1xcc1xcU10qP30pXFxzKmBgYHwoe1tcXHNcXFNdKlwiY29tbWFuZFwiW1xcc1xcU10qfSkvZyk7XG4gICAgICAgIFxuICAgICAgICBpZiAoanNvbk1hdGNoZXMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGpzb25NYXRjaGVzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyBFeHRyYWN0IHRoZSBKU09OIG9iamVjdCBmcm9tIG1hcmtkb3duIGNvZGUgYmxvY2tzIG9yIHBsYWluIHRleHRcbiAgICAgICAgICAgICAgY29uc3QganNvblN0ciA9IG1hdGNoLnJlcGxhY2UoL2BgYGpzb25cXHMqfFxccypgYGAvZywgJycpLnRyaW0oKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIFBhcnNlIGFzIGZ1bGwgSlNPTiBvYmplY3QgdG8gcHJlc2VydmUgc3RydWN0dXJlXG4gICAgICAgICAgICAgIGNvbnN0IGpzb25PYmogPSBKU09OLnBhcnNlKGpzb25TdHIpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhbiB1cGRhdGVfa2V5IGNvbW1hbmRcbiAgICAgICAgICAgICAgaWYgKGpzb25PYmouY29tbWFuZCA9PT0gJ3VwZGF0ZV9rZXknICYmIGpzb25PYmoucGF0aCAmJiBqc29uT2JqLmFjdGlvbiAmJiBqc29uT2JqLnZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVLZXlDb21tYW5kID0ganNvbk9iajsgLy8gVXNlIHRoZSBvYmplY3QgZGlyZWN0bHksIG5vdCBzdHJpbmdpZmllZCB0aGVuIHJlcGFyc2VkXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflJEgRm91bmQgdXBkYXRlX2tleSBjb21tYW5kIGluIHRleHRgKTtcbiAgICAgICAgICAgICAgICAvLyBMb2cgdGhlIGZ1bGwgc3RydWN0dXJlIHRvIGhlbHAgd2l0aCBkZWJ1Z2dpbmdcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TiiBVcGRhdGUgY29tbWFuZCBzdHJ1Y3R1cmU6YCwgSlNPTi5zdHJpbmdpZnkodXBkYXRlS2V5Q29tbWFuZCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybihgWyR7cmVxdWVzdElkfV0g4pqg77iPIEZhaWxlZCB0byBwYXJzZSBwb3RlbnRpYWwgSlNPTiBjb21tYW5kOmAsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHVwZGF0ZUtleUNvbW1hbmQpIGJyZWFrO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBQcm9jZXNzIHRoZSBjb21tYW5kIGlmIHdlIGhhdmUgb25lIChlaXRoZXIgdXBkYXRlX2tleSBvciB0ZXh0IGVkaXRvciBjb21tYW5kKVxuICAgICAgaWYgKHVwZGF0ZUtleUNvbW1hbmQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflIQgUHJvY2Vzc2luZyB1cGRhdGVfa2V5IGNvbW1hbmQuLi5gKTtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfk4ogVXBkYXRlIGRldGFpbHM6IHBhdGg9JHt1cGRhdGVLZXlDb21tYW5kLnBhdGh9LCBhY3Rpb249JHt1cGRhdGVLZXlDb21tYW5kLmFjdGlvbn1gKTtcbiAgICAgICAgXG4gICAgICAgIGxldCB1cGRhdGVkUmVwb3J0ID0geyAuLi5yZXBvcnQgfTtcbiAgICAgICAgbGV0IGFmZmVjdGVkRG9tYWluID0gJyc7XG4gICAgICAgIFxuICAgICAgICAvLyBFeHRyYWN0IGRvbWFpbiBpZiBwYXRoIHN0YXJ0cyB3aXRoIGRvbWFpbnMuWFxuICAgICAgICBpZiAodXBkYXRlS2V5Q29tbWFuZC5wYXRoLmluY2x1ZGVzKCdkb21haW5zLicpKSB7XG4gICAgICAgICAgY29uc3QgcGF0aFBhcnRzID0gdXBkYXRlS2V5Q29tbWFuZC5wYXRoLnNwbGl0KCcuJyk7XG4gICAgICAgICAgY29uc3QgZG9tYWluSW5kZXggPSBwYXRoUGFydHMuZmluZEluZGV4KHBhcnQgPT4gcGFydCA9PT0gJ2RvbWFpbnMnKTtcbiAgICAgICAgICBpZiAoZG9tYWluSW5kZXggIT09IC0xICYmIHBhdGhQYXJ0cy5sZW5ndGggPiBkb21haW5JbmRleCArIDEpIHtcbiAgICAgICAgICAgIGFmZmVjdGVkRG9tYWluID0gcGF0aFBhcnRzW2RvbWFpbkluZGV4ICsgMV07XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+OryBBZmZlY3RlZCBkb21haW4gZnJvbSBwYXRoOiAke2FmZmVjdGVkRG9tYWlufWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBBcHBseSB0aGUgdXBkYXRlIGJhc2VkIG9uIHRoZSBwYXRoIGFuZCBhY3Rpb25cbiAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSB1cGRhdGVLZXlDb21tYW5kLnBhdGguc3BsaXQoJy4nKTtcbiAgICAgICAgICBsZXQgY3VycmVudCA9IHVwZGF0ZWRSZXBvcnQ7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gTmF2aWdhdGUgdG8gdGhlIHBhcmVudCBvYmplY3Qgb2YgdGhlIHRhcmdldCBwcm9wZXJ0eVxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aFBhcnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGFydCA9IHBhdGhQYXJ0c1tpXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ3JlYXRlIG1pc3Npbmcgb2JqZWN0cyBpbiB0aGUgcGF0aFxuICAgICAgICAgICAgaWYgKCFjdXJyZW50W3BhcnRdKSB7XG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBuZXh0IHBhdGggc2VnbWVudCBpcyBhIG51bWJlciAoYXJyYXkgaW5kZXgpXG4gICAgICAgICAgICAgIGNvbnN0IG5leHRQYXJ0ID0gcGF0aFBhcnRzW2kgKyAxXTtcbiAgICAgICAgICAgICAgY29uc3QgaXNOZXh0UGFydEFycmF5SW5kZXggPSAhaXNOYU4ocGFyc2VJbnQobmV4dFBhcnQpKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIENyZWF0ZSBhcHByb3ByaWF0ZSBjb250YWluZXIgdHlwZSAoYXJyYXkgb3Igb2JqZWN0KVxuICAgICAgICAgICAgICBjdXJyZW50W3BhcnRdID0gaXNOZXh0UGFydEFycmF5SW5kZXggPyBbXSA6IHt9O1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+Pl++4jyBDcmVhdGVkIG1pc3NpbmcgJHtpc05leHRQYXJ0QXJyYXlJbmRleCA/ICdhcnJheScgOiAnb2JqZWN0J30gYXQgJHtwYXRoUGFydHMuc2xpY2UoMCwgaSArIDEpLmpvaW4oJy4nKX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRbcGFydF07XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEdldCB0aGUgdGFyZ2V0IHByb3BlcnR5IG5hbWVcbiAgICAgICAgICBjb25zdCB0YXJnZXRQcm9wID0gcGF0aFBhcnRzW3BhdGhQYXJ0cy5sZW5ndGggLSAxXTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBcHBseSB0aGUgYWN0aW9uXG4gICAgICAgICAgc3dpdGNoICh1cGRhdGVLZXlDb21tYW5kLmFjdGlvbikge1xuICAgICAgICAgICAgY2FzZSAnYXBwZW5kJzpcbiAgICAgICAgICAgICAgLy8gRm9yIGFycmF5cywgYXBwZW5kIHRoZSBuZXcgdmFsdWVzXG4gICAgICAgICAgICAgIGlmICghY3VycmVudFt0YXJnZXRQcm9wXSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRbdGFyZ2V0UHJvcF0gPSBbXTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShjdXJyZW50W3RhcmdldFByb3BdKSkge1xuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gYXJyYXkgaWYgbm90IGFscmVhZHlcbiAgICAgICAgICAgICAgICBjdXJyZW50W3RhcmdldFByb3BdID0gW2N1cnJlbnRbdGFyZ2V0UHJvcF1dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBIYW5kbGUgYm90aCBzaW5nbGUgdmFsdWUgYW5kIGFycmF5IG9mIHZhbHVlc1xuICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1cGRhdGVLZXlDb21tYW5kLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRbdGFyZ2V0UHJvcF0gPSBbLi4uY3VycmVudFt0YXJnZXRQcm9wXSwgLi4udXBkYXRlS2V5Q29tbWFuZC52YWx1ZV07XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFt0YXJnZXRQcm9wXS5wdXNoKHVwZGF0ZUtleUNvbW1hbmQudmFsdWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIEFwcGVuZGVkIHRvICR7dXBkYXRlS2V5Q29tbWFuZC5wYXRofSwgbmV3IGxlbmd0aDogJHtjdXJyZW50W3RhcmdldFByb3BdLmxlbmd0aH1gKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgY2FzZSAncmVwbGFjZSc6XG4gICAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIHZhbHVlIGVudGlyZWx5XG4gICAgICAgICAgICAgIGN1cnJlbnRbdGFyZ2V0UHJvcF0gPSB1cGRhdGVLZXlDb21tYW5kLnZhbHVlO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIFJlcGxhY2VkICR7dXBkYXRlS2V5Q29tbWFuZC5wYXRofWApO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICBjYXNlICdtZXJnZSc6XG4gICAgICAgICAgICAgIC8vIEZvciBvYmplY3RzLCBkZWVwIG1lcmdlIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgaWYgKCFjdXJyZW50W3RhcmdldFByb3BdIHx8IHR5cGVvZiBjdXJyZW50W3RhcmdldFByb3BdICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRbdGFyZ2V0UHJvcF0gPSB7fTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY3VycmVudFt0YXJnZXRQcm9wXSA9IGRlZXBNZXJnZShjdXJyZW50W3RhcmdldFByb3BdLCB1cGRhdGVLZXlDb21tYW5kLnZhbHVlKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgTWVyZ2VkIGludG8gJHt1cGRhdGVLZXlDb21tYW5kLnBhdGh9YCk7XG4gICAgICAgICAgICAgIC8vIExvZyB0aGUgc3RydWN0dXJlIGFmdGVyIG1lcmdlXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OKIFN0cnVjdHVyZSBhZnRlciBtZXJnZTpgLCBKU09OLnN0cmluZ2lmeShjdXJyZW50W3RhcmdldFByb3BdKSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybihgWyR7cmVxdWVzdElkfV0g4pqg77iPIFVua25vd24gYWN0aW9uOiAke3VwZGF0ZUtleUNvbW1hbmQuYWN0aW9ufWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBVcGRhdGUgbWV0YWRhdGFcbiAgICAgICAgICB1cGRhdGVkUmVwb3J0Lm1ldGFkYXRhLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgIHVwZGF0ZWRSZXBvcnQubWV0YWRhdGEudmVyc2lvbiA9ICh1cGRhdGVkUmVwb3J0Lm1ldGFkYXRhLnZlcnNpb24gfHwgMCkgKyAxO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgU3VjY2Vzc2Z1bGx5IGFwcGxpZWQgdXBkYXRlX2tleSBjb21tYW5kYCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gTG9nIHRoZSBmaW5hbCBhZmZlY3RlZCBzZWN0aW9uXG4gICAgICAgICAgY29uc3Qgc2VjdGlvblBhdGggPSB1cGRhdGVLZXlDb21tYW5kLnBhdGguc3BsaXQoJy4nKVswXTsgLy8gR2V0IHRvcC1sZXZlbCBzZWN0aW9uXG4gICAgICAgICAgY29uc3QgdXBkYXRlZFNlY3Rpb24gPSB1cGRhdGVkUmVwb3J0W3NlY3Rpb25QYXRoXTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TiiBVcGRhdGVkIHNlY3Rpb24gc3RydWN0dXJlOmAsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRTZWN0aW9uKS5zdWJzdHJpbmcoMCwgMjAwKSArICcuLi4nKTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgcmVwb3J0OiB1cGRhdGVkUmVwb3J0LFxuICAgICAgICAgICAgY29tbWFuZDogdXBkYXRlS2V5Q29tbWFuZCxcbiAgICAgICAgICAgIGFmZmVjdGVkRG9tYWluXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEVycm9yIGFwcGx5aW5nIHVwZGF0ZV9rZXkgY29tbWFuZDpgLCBlcnJvcik7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGFwcGx5IHVwZGF0ZV9rZXkgY29tbWFuZCcsXG4gICAgICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgICAgIGNvbW1hbmQ6IHVwZGF0ZUtleUNvbW1hbmRcbiAgICAgICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGZpbmFsQ29tbWFuZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UhCBQcm9jZXNzaW5nICR7ZmluYWxDb21tYW5kLmNvbW1hbmR9IGNvbW1hbmQuLi5gKTtcbiAgICAgICAgLy8gR2V0IENsYXVkZSdzIGFuYWx5c2lzIG9mIHdoaWNoIGRvbWFpbi9zZWN0aW9uIHRvIHVwZGF0ZVxuICAgICAgICBsZXQgYWZmZWN0ZWREb21haW4gPSAnJztcbiAgICAgICAgbGV0IHVwZGF0ZWRSZXBvcnQgPSB7IC4uLnJlcG9ydCB9O1xuICAgICAgICBcbiAgICAgICAgaWYgKHNlY3Rpb25Ub1VwZGF0ZSA9PT0gJ2F1dG8tZGV0ZWN0Jykge1xuICAgICAgICAgIC8vIEV4dHJhY3QgZG9tYWluIGZyb20gQ2xhdWRlJ3MgcmVzcG9uc2UgdGV4dFxuICAgICAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gY2xhdWRlUmVzcG9uc2UuY29udGVudFxuICAgICAgICAgICAgLmZpbHRlcigoYmxvY2s6IGFueSkgPT4gYmxvY2sudHlwZSA9PT0gJ3RleHQnKVxuICAgICAgICAgICAgLm1hcCgoYmxvY2s6IGFueSkgPT4gYmxvY2sudGV4dClcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBFeHRyYWN0IGRvbWFpbiBmcm9tIHRleHQgLSBsb29rIGZvciBzcGVjaWZpYyBwYXR0ZXJucyBsaWtlIFwicHJhZ21hdGljIGRvbWFpblwiIG9yIFwidXBkYXRlIHRoZSBwcmFnbWF0aWNcIlxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SNIEFuYWx5emluZyB0ZXh0IGZvciBkb21haW4ga2V5d29yZHMuLi5gKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBMaXN0IG9mIGRvbWFpbiBrZXl3b3JkcyB0byBzZWFyY2ggZm9yXG4gICAgICAgICAgY29uc3QgZG9tYWluS2V5d29yZHMgPSBbJ3JlY2VwdGl2ZScsICdleHByZXNzaXZlJywgJ3ByYWdtYXRpYycsICdhcnRpY3VsYXRpb24nLCAndm9pY2UnLCAnZmx1ZW5jeSddO1xuICAgICAgICAgIGxldCBmb3VuZERvbWFpbiA9ICcnO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpcnN0IGxvb2sgZm9yIHRoZSBwYXRoIHBhdHRlcm4gaW4gSlNPTiBjb21tYW5kc1xuICAgICAgICAgIGNvbnN0IHBhdGhSZWdleCA9IC9cInBhdGhcIjpcXHMqXCJhc3Nlc3NtZW50UmVzdWx0c1xcLmRvbWFpbnNcXC4oW14uXCJdKylcIi87XG4gICAgICAgICAgY29uc3QgcGF0aE1hdGNoID0gdGV4dENvbnRlbnQubWF0Y2gocGF0aFJlZ2V4KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAocGF0aE1hdGNoICYmIHBhdGhNYXRjaFsxXSkge1xuICAgICAgICAgICAgZm91bmREb21haW4gPSBwYXRoTWF0Y2hbMV07XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UjSBGb3VuZCBkb21haW4gaW4gSlNPTiBwYXRoOiBcIiR7Zm91bmREb21haW59XCJgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGRvbWFpbiBrZXl3b3JkcyBpbiB0aGUgdGV4dFxuICAgICAgICAgICAgZm9yIChjb25zdCBkb21haW4gb2YgZG9tYWluS2V5d29yZHMpIHtcbiAgICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IG5ldyBSZWdFeHAoYFxcXFxiJHtkb21haW59XFxcXGJgLCAnaScpO1xuICAgICAgICAgICAgICBpZiAocGF0dGVybi50ZXN0KHRleHRDb250ZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SNIEZvdW5kIGRvbWFpbiBrZXl3b3JkIGluIHRleHQ6IFwiJHtkb21haW59XCJgKTtcbiAgICAgICAgICAgICAgICBmb3VuZERvbWFpbiA9IGRvbWFpbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBhZmZlY3RlZERvbWFpbiA9IGZvdW5kRG9tYWluO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SNIEF1dG8tZGV0ZWN0ZWQgZG9tYWluOiAke2FmZmVjdGVkRG9tYWluIHx8ICdub25lIGRldGVjdGVkJ31gKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TnSBUZXh0IGNvbnRlbnQgZm9yIGRvbWFpbiBkZXRlY3Rpb246YCwgdGV4dENvbnRlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb25Ub1VwZGF0ZS5zdGFydHNXaXRoKCdhc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zLicpKSB7XG4gICAgICAgICAgYWZmZWN0ZWREb21haW4gPSBzZWN0aW9uVG9VcGRhdGUuc3BsaXQoJy4nKVsyXTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+OryBVc2luZyBzcGVjaWZpZWQgZG9tYWluOiAke2FmZmVjdGVkRG9tYWlufWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZmluYWxDb21tYW5kLmNvbW1hbmQgPT09ICdzdHJfcmVwbGFjZScpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UhCBQcm9jZXNzaW5nIHN0cl9yZXBsYWNlIGNvbW1hbmQuLi5gKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pqg77iPIE5vdGU6IHN0cl9yZXBsYWNlIGlzIGJlaW5nIHVzZWQgaW5zdGVhZCBvZiB0aGUgcmVjb21tZW5kZWQgdXBkYXRlX2tleSBjb21tYW5kYCk7XG4gICAgICAgICAgbGV0IHVwZGF0ZWRDb250ZW50ID0gJyc7XG4gICAgICAgICAgXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEZpcnN0LCBjaGVjayBpZiB0aGUgc3RyX3JlcGxhY2UgY29tbWFuZCBpcyB0YXJnZXRpbmcgYSBzcGVjaWZpYyBkb21haW5cbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZGV0ZWN0IHRoaXMgYnkgc2VlaW5nIGlmIHRoZSBvbGRfc3RyIGNvbnRhaW5zIHNwZWNpZmljIGRvbWFpbiBKU09OXG4gICAgICAgICAgICBjb25zdCBzdHJDb250YWluc0RvbWFpblBhdHRlcm4gPSBPYmplY3Qua2V5cyhyZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWlucykuc29tZShkb21haW4gPT4ge1xuICAgICAgICAgICAgICBjb25zdCBwYXR0ZXJuID0gYFwiJHtkb21haW59XCI6XFxcXHMqe2A7XG4gICAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLCAnaScpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVnZXgudGVzdChmaW5hbENvbW1hbmQub2xkX3N0ciB8fCAnJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflI0gQ29tbWFuZCBjb250YWlucyBkb21haW4gcGF0dGVybiBpbiBvbGRfc3RyOiAke3N0ckNvbnRhaW5zRG9tYWluUGF0dGVybn1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSWYgd2UndmUgYXV0by1kZXRlY3RlZCBhIGRvbWFpbiBhbmQgaXQgZXhpc3RzIGluIHRoZSByZXBvcnRcbiAgICAgICAgICAgIGlmIChhZmZlY3RlZERvbWFpbiAmJiByZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1thZmZlY3RlZERvbWFpbl0pIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflIQgVXBkYXRpbmcgc3BlY2lmaWMgZG9tYWluOiAke2FmZmVjdGVkRG9tYWlufWApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgQ2xhdWRlJ3Mgc3RyX3JlcGxhY2UgaXMgZGlyZWN0bHkgdGFyZ2V0aW5nIHRoaXMgZG9tYWluIHNlY3Rpb25cbiAgICAgICAgICAgICAgaWYgKGZpbmFsQ29tbWFuZC5vbGRfc3RyICYmIGZpbmFsQ29tbWFuZC5vbGRfc3RyLmluY2x1ZGVzKGBcIiR7YWZmZWN0ZWREb21haW59XCJgKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn46vIERpcmVjdCBtYXRjaDogQ2xhdWRlJ3MgY29tbWFuZCB0YXJnZXRzICR7YWZmZWN0ZWREb21haW59IGRvbWFpbmApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEltcGxlbWVudCBhIG1vcmUgY2FyZWZ1bCBzZWFyY2ggYW5kIHJlcGxhY2UgZm9yIHRoZSBzcGVjaWZpYyBkb21haW5cbiAgICAgICAgICAgICAgICAvLyBTdGFydCB3aXRoIHRoZSBmdWxsIHJlcG9ydCBKU09OXG4gICAgICAgICAgICAgICAgY29uc3QgZnVsbFJlcG9ydEpzb24gPSBKU09OLnN0cmluZ2lmeShyZXBvcnQsIG51bGwsIDIpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGRvbWFpbiBzZWN0aW9uIGluIHRoZSBKU09OXG4gICAgICAgICAgICAgICAgY29uc3QgZG9tYWluUGF0dGVybiA9IG5ldyBSZWdFeHAoYChcXFxccypcIiR7YWZmZWN0ZWREb21haW59XCJcXFxccyo6XFxcXHMqe1tefV0qfSlgLCAncycpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvbWFpbk1hdGNoID0gZnVsbFJlcG9ydEpzb24ubWF0Y2goZG9tYWluUGF0dGVybik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGRvbWFpbk1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIEZvdW5kIGRvbWFpbiBzZWN0aW9uIGluIEpTT05gKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBqdXN0IHRoZSBkb21haW4gc2VjdGlvblxuICAgICAgICAgICAgICAgICAgdXBkYXRlZENvbnRlbnQgPSBmdWxsUmVwb3J0SnNvbi5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICBkb21haW5NYXRjaFswXSwgXG4gICAgICAgICAgICAgICAgICAgIGZpbmFsQ29tbWFuZC5uZXdfc3RyLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIGNvbXBsZXRlIHVwZGF0ZWQgcmVwb3J0XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRSZXBvcnQgPSBKU09OLnBhcnNlKHVwZGF0ZWRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBTdWNjZXNzZnVsbHkgcmVwbGFjZWQgZG9tYWluIHNlY3Rpb24gaW4gZnVsbCByZXBvcnRgKTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEpTT04gcGFyc2UgZXJyb3IgYWZ0ZXIgZG9tYWluIHJlcGxhY2VtZW50OmAsIHBhcnNlRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gdXBkYXRpbmcganVzdCB0aGUgZG9tYWluIHNlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9tYWluU2VjdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbYWZmZWN0ZWREb21haW5dKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbWFpbkpzb24gPSBKU09OLnN0cmluZ2lmeShkb21haW5TZWN0aW9uLCBudWxsLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QganVzdCB0aGUgZG9tYWluIG9iamVjdCBmcm9tIENsYXVkZSdzIG5ld19zdHJcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkb21haW5PYmplY3RNYXRjaCA9IGZpbmFsQ29tbWFuZC5uZXdfc3RyLm1hdGNoKC97XFxzKlwidG9waWNTZW50ZW5jZVwiLip9L3MpO1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChkb21haW5PYmplY3RNYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RG9tYWluU2VjdGlvbiA9IEpTT04ucGFyc2UoZG9tYWluT2JqZWN0TWF0Y2hbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFJlcG9ydCA9IHVwZGF0ZURvbWFpblNlY3Rpb24ocmVwb3J0LCBhZmZlY3RlZERvbWFpbiwgbmV3RG9tYWluU2VjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIEZhbGxiYWNrOiBVcGRhdGVkIGRvbWFpbiBzZWN0aW9uIHZpYSBleHRyYWN0aW9uYCk7XG4gICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGV4dHJhY3QgZG9tYWluIG9iamVjdCBmcm9tIG5ld19zdHInKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4dHJhY3RFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIOKdjCBGYWlsZWQgdG8gZXh0cmFjdCBkb21haW4gb2JqZWN0OmAsIGV4dHJhY3RFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSByZXBvcnQgLSBpbnZhbGlkIEpTT04gZm9ybWF0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvcjogcGFyc2VFcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0RXJyb3I6IGV4dHJhY3RFcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgQ291bGQgbm90IGZpbmQgZG9tYWluIHNlY3Rpb24gaW4gSlNPTmApO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayB0byB1cGRhdGluZyB2aWEgZG9tYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAgY29uc3QgZG9tYWluU2VjdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbYWZmZWN0ZWREb21haW5dKSk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TiiBPcmlnaW5hbCBkb21haW4gc2VjdGlvbjpgLCBkb21haW5TZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gTWFudWFsbHkgY29uc3RydWN0IGFuIHVwZGF0ZWQgZG9tYWluIHNlY3Rpb24gYmFzZWQgb24gdGhlIGNvbnRlbnRcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dHJhY3RlZENvbnRlbnQgPSB7fTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgdG9waWMgc2VudGVuY2VcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRzTWF0Y2ggPSBmaW5hbENvbW1hbmQubmV3X3N0ci5tYXRjaCgvXCJ0b3BpY1NlbnRlbmNlXCI6XFxzKlwiKFteXCJdKilcIi8pO1xuICAgICAgICAgICAgICAgICAgaWYgKHRzTWF0Y2gpIGV4dHJhY3RlZENvbnRlbnRbJ3RvcGljU2VudGVuY2UnXSA9IHRzTWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBleHRyYWN0IHN0cmVuZ3Rocy9ldmlkZW5jZSAoc2ltcGxpZmllZClcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVuZ3Roc01hdGNoID0gZmluYWxDb21tYW5kLm5ld19zdHIubWF0Y2goL1wic3RyZW5ndGhzXCI6XFxzKlxcWyguKj8pXFxdL3MpO1xuICAgICAgICAgICAgICAgICAgaWYgKHN0cmVuZ3Roc01hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkQ29udGVudFsnc3RyZW5ndGhzJ10gPSBKU09OLnBhcnNlKGBbJHtzdHJlbmd0aHNNYXRjaFsxXX1dYCk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFske3JlcXVlc3RJZH1dIOKaoO+4jyBDb3VsZCBub3QgcGFyc2Ugc3RyZW5ndGhzYCwgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgbmVlZHMvY2hhbGxlbmdlcyAoc2ltcGxpZmllZClcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG5lZWRzTWF0Y2ggPSBmaW5hbENvbW1hbmQubmV3X3N0ci5tYXRjaCgvXCJuZWVkc1wiOlxccypcXFsoLio/KVxcXS9zKTtcbiAgICAgICAgICAgICAgICAgIGlmIChuZWVkc01hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkQ29udGVudFsnbmVlZHMnXSA9IEpTT04ucGFyc2UoYFske25lZWRzTWF0Y2hbMV19XWApO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gQ291bGQgbm90IHBhcnNlIG5lZWRzYCwgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBkb21haW4gd2l0aCB0aGUgZXh0cmFjdGVkIGNvbnRlbnRcbiAgICAgICAgICAgICAgICAgIHVwZGF0ZWRSZXBvcnQgPSB1cGRhdGVEb21haW5TZWN0aW9uKHJlcG9ydCwgYWZmZWN0ZWREb21haW4sIGV4dHJhY3RlZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBVc2VkIGV4dHJhY3Rpb24gdG8gdXBkYXRlIGRvbWFpbiBzZWN0aW9uYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFN0YW5kYXJkIGRvbWFpbiBzZWN0aW9uIHVwZGF0ZVxuICAgICAgICAgICAgICAgIGNvbnN0IGRvbWFpblNlY3Rpb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2FmZmVjdGVkRG9tYWluXSkpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OKIE9yaWdpbmFsIGRvbWFpbiBzZWN0aW9uOmAsIGRvbWFpblNlY3Rpb24pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SEIEFwcGx5aW5nIHN0cl9yZXBsYWNlOmAsIHtcbiAgICAgICAgICAgICAgICAgIG9sZF9zdHJfbGVuZ3RoOiBmaW5hbENvbW1hbmQub2xkX3N0cj8ubGVuZ3RoIHx8IDAsXG4gICAgICAgICAgICAgICAgICBuZXdfc3RyX2xlbmd0aDogZmluYWxDb21tYW5kLm5ld19zdHI/Lmxlbmd0aCB8fCAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSW5zdGVhZCBvZiBhIGdlbmVyYWwgcmVwbGFjZSwgd2UnbGwgdHJ5IHRvIGltcHJvdmUgdGhlIGRvbWFpbiBkaXJlY3RseVxuICAgICAgICAgICAgICAgIGlmIChmaW5hbENvbW1hbmQubmV3X3N0ciAmJiBmaW5hbENvbW1hbmQubmV3X3N0ci5pbmNsdWRlcygnXCJ0b3BpY1NlbnRlbmNlXCInKSkge1xuICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgSlNPTiBzdHJ1Y3R1cmUgZnJvbSB0aGUgbmV3IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgY29uc3QganNvbk1hdGNoID0gZmluYWxDb21tYW5kLm5ld19zdHIubWF0Y2goLyh7W1xcc1xcU10qfSkvKTtcbiAgICAgICAgICAgICAgICAgIGlmIChqc29uTWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBQYXJzZSB0aGUgSlNPTiBmcm9tIHRoZSBuZXcgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZERvbWFpblNlY3Rpb24gPSBKU09OLnBhcnNlKGpzb25NYXRjaFsxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzcGVjaWZpYyBkb21haW4gaW4gdGhlIHJlcG9ydFxuICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRSZXBvcnQgPSB1cGRhdGVEb21haW5TZWN0aW9uKHJlcG9ydCwgYWZmZWN0ZWREb21haW4sIHVwZGF0ZWREb21haW5TZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIFN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQgYW5kIHVwZGF0ZWQgZG9tYWluIEpTT05gKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoanNvbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEVycm9yIHBhcnNpbmcgZXh0cmFjdGVkIEpTT046YCwganNvbkVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayB0byBzdGFuZGFyZCByZXBsYWNlbWVudFxuICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoZG9tYWluU2VjdGlvbikucmVwbGFjZShmaW5hbENvbW1hbmQub2xkX3N0ciB8fCAnJywgZmluYWxDb21tYW5kLm5ld19zdHIgfHwgJycpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWREb21haW5TZWN0aW9uID0gSlNPTi5wYXJzZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFJlcG9ydCA9IHVwZGF0ZURvbWFpblNlY3Rpb24ocmVwb3J0LCBhZmZlY3RlZERvbWFpbiwgdXBkYXRlZERvbWFpblNlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBObyBKU09OIHN0cnVjdHVyZSBmb3VuZCwgdXNlIHN0YW5kYXJkIHJlcGxhY2VtZW50XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoZG9tYWluU2VjdGlvbikucmVwbGFjZShmaW5hbENvbW1hbmQub2xkX3N0ciB8fCAnJywgZmluYWxDb21tYW5kLm5ld19zdHIgfHwgJycpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkRG9tYWluU2VjdGlvbiA9IEpTT04ucGFyc2UodXBkYXRlZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkUmVwb3J0ID0gdXBkYXRlRG9tYWluU2VjdGlvbihyZXBvcnQsIGFmZmVjdGVkRG9tYWluLCB1cGRhdGVkRG9tYWluU2VjdGlvbik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIC8vIFN0YW5kYXJkIHJlcGxhY2VtZW50XG4gICAgICAgICAgICAgICAgICB1cGRhdGVkQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KGRvbWFpblNlY3Rpb24pLnJlcGxhY2UoZmluYWxDb21tYW5kLm9sZF9zdHIgfHwgJycsIGZpbmFsQ29tbWFuZC5uZXdfc3RyIHx8ICcnKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWREb21haW5TZWN0aW9uID0gSlNPTi5wYXJzZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgICB1cGRhdGVkUmVwb3J0ID0gdXBkYXRlRG9tYWluU2VjdGlvbihyZXBvcnQsIGFmZmVjdGVkRG9tYWluLCB1cGRhdGVkRG9tYWluU2VjdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgRG9tYWluIHNlY3Rpb24gdXBkYXRlZCBzdWNjZXNzZnVsbHlgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdHJDb250YWluc0RvbWFpblBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgLy8gV2UgZGV0ZWN0ZWQgYSBkb21haW4gcGF0dGVybiBpbiB0aGUgc3RyX3JlcGxhY2UgY29tbWFuZCwgc28gdHJ5IHRvIGV4dHJhY3QgdGhlIGRvbWFpbiBuYW1lXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SOIFRyeWluZyB0byBleHRyYWN0IGRvbWFpbiBmcm9tIHN0cl9yZXBsYWNlIGNvbW1hbmQuLi5gKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGxldCBleHRyYWN0ZWREb21haW4gPSAnJztcbiAgICAgICAgICAgICAgZm9yIChjb25zdCBkb21haW4gb2YgT2JqZWN0LmtleXMocmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbmFsQ29tbWFuZC5vbGRfc3RyPy5pbmNsdWRlcyhgXCIke2RvbWFpbn1cImApKSB7XG4gICAgICAgICAgICAgICAgICBleHRyYWN0ZWREb21haW4gPSBkb21haW47XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmIChleHRyYWN0ZWREb21haW4pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UjSBFeHRyYWN0ZWQgZG9tYWluIGZyb20gY29tbWFuZDogJHtleHRyYWN0ZWREb21haW59YCk7XG4gICAgICAgICAgICAgICAgYWZmZWN0ZWREb21haW4gPSBleHRyYWN0ZWREb21haW47XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gTm93IHVwZGF0ZSB1c2luZyB0aGUgZnVsbCByZXBvcnQgdXBkYXRlLCB0aGVuIHJlLXByb2Nlc3Mgd2l0aCB0aGUgY29ycmVjdCBkb21haW5cbiAgICAgICAgICAgICAgICB1cGRhdGVkQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KHJlcG9ydCwgbnVsbCwgMikucmVwbGFjZShmaW5hbENvbW1hbmQub2xkX3N0ciB8fCAnJywgZmluYWxDb21tYW5kLm5ld19zdHIgfHwgJycpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICB1cGRhdGVkUmVwb3J0ID0gSlNPTi5wYXJzZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIFVwZGF0ZWQgcmVwb3J0IHdpdGggZXh0cmFjdGVkIGRvbWFpbjogJHtleHRyYWN0ZWREb21haW59YCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIFBhcnNlIGVycm9yIHdpdGggZXh0cmFjdGVkIGRvbWFpbiB1cGRhdGU6YCwgcGFyc2VFcnJvcik7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGp1c3QgdXBkYXRpbmcgdGhlIGRvbWFpbiBzZWN0aW9uXG4gICAgICAgICAgICAgICAgICBjb25zdCBkb21haW5TZWN0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1tleHRyYWN0ZWREb21haW5dKSk7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkRG9tYWluU2VjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uZG9tYWluU2VjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgdG9waWNTZW50ZW5jZTogZmluYWxDb21tYW5kLm5ld19zdHIubWF0Y2goL1widG9waWNTZW50ZW5jZVwiOlxccypcIihbXlwiXSopXCIvKT8uWzFdIHx8IGRvbWFpblNlY3Rpb24udG9waWNTZW50ZW5jZSxcbiAgICAgICAgICAgICAgICAgICAgc3RyZW5ndGhzOiBbLi4uKGRvbWFpblNlY3Rpb24uc3RyZW5ndGhzIHx8IFtdKSwgbm9ybWFsaXplZElucHV0XVxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIHVwZGF0ZWRSZXBvcnQgPSB1cGRhdGVEb21haW5TZWN0aW9uKHJlcG9ydCwgZXh0cmFjdGVkRG9tYWluLCB1cGRhdGVkRG9tYWluU2VjdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZhbGwgYmFjayB0byBmdWxsIHJlcG9ydCB1cGRhdGVcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UhCBVcGRhdGluZyBlbnRpcmUgcmVwb3J0IChkb21haW4gcGF0dGVybiBmb3VuZCBidXQgY291bGRuJ3QgZXh0cmFjdCBkb21haW4pYCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlZENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXBvcnQsIG51bGwsIDIpLnJlcGxhY2UoZmluYWxDb21tYW5kLm9sZF9zdHIgfHwgJycsIGZpbmFsQ29tbWFuZC5uZXdfc3RyIHx8ICcnKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVkUmVwb3J0ID0gSlNPTi5wYXJzZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIEZvciB3aG9sZSByZXBvcnQgdXBkYXRlcyBvciBvdGhlciBzZWN0aW9uc1xuICAgICAgICAgICAgICBpZiAoc2VjdGlvblRvVXBkYXRlID09PSAnYXV0by1kZXRlY3QnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflIQgVXBkYXRpbmcgZW50aXJlIHJlcG9ydCAobm8gc3BlY2lmaWMgZG9tYWluIGlkZW50aWZpZWQpYCk7XG4gICAgICAgICAgICAgICAgLy8gRnVsbCByZXBvcnQgdXBkYXRlXG4gICAgICAgICAgICAgICAgdXBkYXRlZENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShyZXBvcnQsIG51bGwsIDIpLnJlcGxhY2UoZmluYWxDb21tYW5kLm9sZF9zdHIgfHwgJycsIGZpbmFsQ29tbWFuZC5uZXdfc3RyIHx8ICcnKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVkUmVwb3J0ID0gSlNPTi5wYXJzZSh1cGRhdGVkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBGdWxsIHJlcG9ydCB1cGRhdGVkIHN1Y2Nlc3NmdWxseWApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SEIFVwZGF0aW5nIHNwZWNpZmljIG5vbi1kb21haW4gc2VjdGlvbjogJHtzZWN0aW9uVG9VcGRhdGV9YCk7XG4gICAgICAgICAgICAgICAgLy8gU3BlY2lmaWMgbm9uLWRvbWFpbiBzZWN0aW9uIHVwZGF0ZVxuICAgICAgICAgICAgICAgIHVwZGF0ZWRDb250ZW50ID0gdmlld0NvbnRlbnQucmVwbGFjZShmaW5hbENvbW1hbmQub2xkX3N0ciB8fCAnJywgZmluYWxDb21tYW5kLm5ld19zdHIgfHwgJycpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgc2ltcGxpZmllZDsgeW91J2QgbmVlZCB0byBtZXJnZSB0aGlzIGludG8gdGhlIHJpZ2h0IHNlY3Rpb25cbiAgICAgICAgICAgICAgICAvLyBiYXNlZCBvbiB0aGUgc2VjdGlvblRvVXBkYXRlIHBhdGhcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgdXBkYXRlZFJlcG9ydCA9IHsgLi4ucmVwb3J0IH07XG4gICAgICAgICAgICAgICAgICAvLyBTaW1wbGUgcGF0aC1iYXNlZCBzZXR0ZXIgKHdvdWxkIG5lZWQgYSBtb3JlIHJvYnVzdCB2ZXJzaW9uIGluIHByb2R1Y3Rpb24pXG4gICAgICAgICAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSBzZWN0aW9uVG9VcGRhdGUuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW50ID0gdXBkYXRlZFJlcG9ydDtcbiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aFBhcnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudFtwYXRoUGFydHNbaV1dO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgY3VycmVudFtwYXRoUGFydHNbcGF0aFBhcnRzLmxlbmd0aCAtIDFdXSA9IEpTT04ucGFyc2UodXBkYXRlZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBTcGVjaWZpYyBzZWN0aW9uIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5OiAke3NlY3Rpb25Ub1VwZGF0ZX1gKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgRXJyb3IgdXBkYXRpbmcgc3BlY2lmaWMgcGF0aDpgLCBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgRXJyb3IgcGFyc2luZyB1cGRhdGVkIEpTT046YCwgcGFyc2VFcnJvcik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TiyBQcm9ibGVtIGNvbnRlbnQ6YCwgdXBkYXRlZENvbnRlbnQpO1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIEpTT04gcHJvZHVjZWQgYnkgdGV4dCBlZGl0b3IgY29tbWFuZCcsXG4gICAgICAgICAgICAgIG9yaWdpbmFsQ29tbWFuZDogZmluYWxDb21tYW5kLFxuICAgICAgICAgICAgICBwYXJzZUVycm9yOiBwYXJzZUVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFVwZGF0ZSBtZXRhZGF0YVxuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVGltZXN0YW1wID0gdXBkYXRlZFJlcG9ydC5tZXRhZGF0YS5sYXN0VXBkYXRlZDtcbiAgICAgICAgICB1cGRhdGVkUmVwb3J0Lm1ldGFkYXRhLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgIHVwZGF0ZWRSZXBvcnQubWV0YWRhdGEudmVyc2lvbiA9ICh1cGRhdGVkUmVwb3J0Lm1ldGFkYXRhLnZlcnNpb24gfHwgMCkgKyAxO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OKIE1ldGFkYXRhIHVwZGF0ZWQ6YCwgeyBcbiAgICAgICAgICAgIG9sZFRpbWVzdGFtcDogb3JpZ2luYWxUaW1lc3RhbXAsXG4gICAgICAgICAgICBuZXdUaW1lc3RhbXA6IHVwZGF0ZWRSZXBvcnQubWV0YWRhdGEubGFzdFVwZGF0ZWQsXG4gICAgICAgICAgICBuZXdWZXJzaW9uOiB1cGRhdGVkUmVwb3J0Lm1ldGFkYXRhLnZlcnNpb24gXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBSZXBvcnQgdXBkYXRlIGNvbXBsZXRlLCByZXR1cm5pbmcgcmVzcG9uc2VgKTtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgcmVwb3J0OiB1cGRhdGVkUmVwb3J0LFxuICAgICAgICAgICAgY29tbWFuZDogZmluYWxDb21tYW5kLFxuICAgICAgICAgICAgYWZmZWN0ZWREb21haW5cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChmaW5hbENvbW1hbmQuY29tbWFuZCA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pqg77iPIEluc2VydCBjb21tYW5kIG5vdCBmdWxseSBpbXBsZW1lbnRlZGApO1xuICAgICAgICAgIC8vIEhhbmRsZSBpbnNlcnQgY29tbWFuZCAtIHRoaXMgd291bGQgYmUgbW9yZSBjb21wbGV4IGFuZCBkZXBlbmRzIG9uIHlvdXIgc3BlY2lmaWMgbmVlZHNcbiAgICAgICAgICAvLyBGb3Igc2ltcGxpY2l0eSBpbiB0aGlzIGRlbW8sIHdlJ2xsIGp1c3QgYWNrbm93bGVkZ2UgaXRcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgcmVwb3J0LFxuICAgICAgICAgICAgZXJyb3I6ICdJbnNlcnQgY29tbWFuZCBub3QgZnVsbHkgaW1wbGVtZW50ZWQgeWV0JyxcbiAgICAgICAgICAgIGNvbW1hbmQ6IGZpbmFsQ29tbWFuZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIG5vIHRvb2wgY29tbWFuZCBmb3VuZCwgcmV0dXJuIHRoZSBvcmlnaW5hbCByZXBvcnRcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gTm8gdG9vbCBjb21tYW5kIGZvdW5kIGluIENsYXVkZSdzIHJlc3BvbnNlLCByZXR1cm5pbmcgb3JpZ2luYWwgcmVwb3J0YCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICByZXBvcnQsXG4gICAgICAgIGVycm9yOiAnQ2xhdWRlIGRpZCBub3QgcHJvdmlkZSBhIEpTT04gdXBkYXRlIGNvbW1hbmQnXG4gICAgICB9KTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGFwaUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgRXJyb3IgY2FsbGluZyBDbGF1ZGUgQVBJOmAsIGFwaUVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gRmFsbGJhY2sgZm9yIHRlc3Rpbmcgd2l0aG91dCBBUElcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gVXNpbmcgZmFsbGJhY2sgbW9kZSBmb3IgdGVzdGluZ2ApO1xuICAgICAgY29uc3QgdXBkYXRlZFJlcG9ydCA9IHsgLi4ucmVwb3J0IH07XG4gICAgICBcbiAgICAgIC8vIFNpbXBsZSBkb21haW4gZGV0ZWN0aW9uIGJhc2VkIG9uIGtleXdvcmRzXG4gICAgICBjb25zdCBpbnB1dExvd2VyID0gaW5wdXQ/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XG4gICAgICBsZXQgdGFyZ2V0RG9tYWluID0gJ2FydGljdWxhdGlvbic7XG4gICAgICBcbiAgICAgIGlmIChpbnB1dExvd2VyLmluY2x1ZGVzKCd1bmRlcnN0YW5kJykgfHwgaW5wdXRMb3dlci5pbmNsdWRlcygnZm9sbG93JykgfHwgaW5wdXRMb3dlci5pbmNsdWRlcygnZGlyZWN0aW9uJykpIHtcbiAgICAgICAgdGFyZ2V0RG9tYWluID0gJ3JlY2VwdGl2ZSc7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0TG93ZXIuaW5jbHVkZXMoJ2V4cHJlc3MnKSB8fCBpbnB1dExvd2VyLmluY2x1ZGVzKCd2b2NhYnVsYXJ5JykgfHwgaW5wdXRMb3dlci5pbmNsdWRlcygnc2VudGVuY2UnKSkge1xuICAgICAgICB0YXJnZXREb21haW4gPSAnZXhwcmVzc2l2ZSc7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0TG93ZXIuaW5jbHVkZXMoJ3NvY2lhbCcpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ2V5ZSBjb250YWN0JykgfHwgaW5wdXRMb3dlci5pbmNsdWRlcygncGVlcicpKSB7XG4gICAgICAgIHRhcmdldERvbWFpbiA9ICdwcmFnbWF0aWMnO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dExvd2VyLmluY2x1ZGVzKCdzb3VuZCcpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ3Byb25vdW5jZScpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ2ludGVsbGlnaWJsZScpKSB7XG4gICAgICAgIHRhcmdldERvbWFpbiA9ICdhcnRpY3VsYXRpb24nO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UjSBGYWxsYmFjayBkZXRlY3RlZCBkb21haW46ICR7dGFyZ2V0RG9tYWlufWApO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgYSBzaW11bGF0ZWQgdXBkYXRlXG4gICAgICBjb25zdCB1cGRhdGVzOiBQYXJ0aWFsPERvbWFpblNlY3Rpb24+ID0ge1xuICAgICAgICBzdHJlbmd0aHM6IFtpbnB1dF1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGlmICghdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW3RhcmdldERvbWFpbl0udG9waWNTZW50ZW5jZSkge1xuICAgICAgICB1cGRhdGVzLnRvcGljU2VudGVuY2UgPSBgU3R1ZGVudCBkZW1vbnN0cmF0ZXMgY2hhbGxlbmdlcyBpbiAke3RhcmdldERvbWFpbn0gbGFuZ3VhZ2Ugc2tpbGxzLmA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHNpbXVsYXRlZFJlcG9ydCA9IHVwZGF0ZURvbWFpblNlY3Rpb24odXBkYXRlZFJlcG9ydCwgdGFyZ2V0RG9tYWluLCB1cGRhdGVzKTtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgU2ltdWxhdGVkIHVwZGF0ZSBhcHBsaWVkIHRvIGRvbWFpbjogJHt0YXJnZXREb21haW59YCk7XG4gICAgICBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHJlcG9ydDogc2ltdWxhdGVkUmVwb3J0LFxuICAgICAgICBhcGlFcnJvcjogYXBpRXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGFwaUVycm9yLm1lc3NhZ2UgOiAnQVBJIGNhbGwgZmFpbGVkJyxcbiAgICAgICAgc2ltdWxhdGVkOiB0cnVlLFxuICAgICAgICBhZmZlY3RlZERvbWFpbjogdGFyZ2V0RG9tYWluXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEVycm9yIHByb2Nlc3NpbmcgdGV4dCBlZGl0b3IgcmVxdWVzdDpgLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBwcm9jZXNzIHRoZSByZXF1ZXN0JywgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH0gZmluYWxseSB7XG4gICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfj4EgUkVRVUVTVCBDT01QTEVURUQ6IFRleHQgRWRpdG9yIEFQSWApO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIm5vcm1hbGl6ZUlucHV0IiwiY3JlYXRlUmVwb3J0U2tlbGV0b24iLCJkZWVwTWVyZ2UiLCJ1cGRhdGVEb21haW5TZWN0aW9uIiwiUE9TVCIsInJlcXVlc3QiLCJyZXF1ZXN0SWQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyaW5nIiwiY29uc29sZSIsImxvZyIsImlucHV0IiwicmVwb3J0IiwiZXhpc3RpbmdSZXBvcnQiLCJ1cGRhdGVTZWN0aW9uIiwicGRmRGF0YSIsImpzb24iLCJpc1BkZlVwbG9hZCIsImlucHV0RGF0YSIsImlucHV0VHlwZSIsImlucHV0U2l6ZSIsImxlbmd0aCIsInJlcG9ydFByb3ZpZGVkIiwiZXJyb3IiLCJzdGF0dXMiLCJPYmplY3QiLCJrZXlzIiwiYXNzZXNzbWVudFJlc3VsdHMiLCJkb21haW5zIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkFOVEhST1BJQ19BUElfS0VZIiwibm9ybWFsaXplZElucHV0Iiwic2VjdGlvblRvVXBkYXRlIiwidmlld0NvbnRlbnQiLCJ0YXJnZXRQYXRoIiwiZ2V0TmVzdGVkVmFsdWUiLCJvYmoiLCJwYXRoIiwic3BsaXQiLCJyZWR1Y2UiLCJvIiwia2V5IiwiZ2V0TWFpblNlY3Rpb24iLCJzdGFydHNXaXRoIiwiSlNPTiIsInN0cmluZ2lmeSIsImluY2x1ZGVzIiwibWFpblNlY3Rpb24iLCJuZXN0ZWRWYWx1ZSIsInN5c3RlbVByb21wdCIsInVzZXJDb250ZW50IiwidHlwZSIsInRleHQiLCJzb3VyY2UiLCJtZWRpYV90eXBlIiwiZGF0YSIsImZpcnN0QXBpUGF5bG9hZCIsIm1vZGVsIiwibWF4X3Rva2VucyIsInN5c3RlbSIsInRvb2xzIiwibmFtZSIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJvayIsImVycm9yRGF0YSIsIkVycm9yIiwibWVzc2FnZSIsImNsYXVkZVJlc3BvbnNlIiwibWFwIiwiYmxvY2siLCJjb21tYW5kIiwiZmluYWxDb21tYW5kIiwidG9vbFVzZUJsb2NrIiwiZmluZCIsInNlY29uZFVzZXJDb250ZW50Iiwic2Vjb25kQXBpUGF5bG9hZCIsImlkIiwidG9vbF91c2VfaWQiLCJzZWNvbmRSZXNwb25zZSIsInNlY29uZFRvb2xVc2VCbG9jayIsIm9sZF9zdHIiLCJ1bmRlZmluZWQiLCJuZXdfc3RyIiwicG9zaXRpb24iLCJ1cGRhdGVLZXlDb21tYW5kIiwidGV4dEJsb2NrcyIsImZpbHRlciIsImpzb25NYXRjaGVzIiwibWF0Y2giLCJqc29uU3RyIiwicmVwbGFjZSIsInRyaW0iLCJqc29uT2JqIiwicGFyc2UiLCJhY3Rpb24iLCJ2YWx1ZSIsImUiLCJ3YXJuIiwidXBkYXRlZFJlcG9ydCIsImFmZmVjdGVkRG9tYWluIiwicGF0aFBhcnRzIiwiZG9tYWluSW5kZXgiLCJmaW5kSW5kZXgiLCJwYXJ0IiwiY3VycmVudCIsImkiLCJuZXh0UGFydCIsImlzTmV4dFBhcnRBcnJheUluZGV4IiwiaXNOYU4iLCJwYXJzZUludCIsInNsaWNlIiwiam9pbiIsInRhcmdldFByb3AiLCJBcnJheSIsImlzQXJyYXkiLCJwdXNoIiwibWV0YWRhdGEiLCJsYXN0VXBkYXRlZCIsInRvSVNPU3RyaW5nIiwidmVyc2lvbiIsInNlY3Rpb25QYXRoIiwidXBkYXRlZFNlY3Rpb24iLCJkZXRhaWxzIiwidGV4dENvbnRlbnQiLCJkb21haW5LZXl3b3JkcyIsImZvdW5kRG9tYWluIiwicGF0aFJlZ2V4IiwicGF0aE1hdGNoIiwiZG9tYWluIiwicGF0dGVybiIsIlJlZ0V4cCIsInRlc3QiLCJ1cGRhdGVkQ29udGVudCIsInN0ckNvbnRhaW5zRG9tYWluUGF0dGVybiIsInNvbWUiLCJyZWdleCIsImZ1bGxSZXBvcnRKc29uIiwiZG9tYWluUGF0dGVybiIsImRvbWFpbk1hdGNoIiwicGFyc2VFcnJvciIsImRvbWFpblNlY3Rpb24iLCJkb21haW5Kc29uIiwiZG9tYWluT2JqZWN0TWF0Y2giLCJuZXdEb21haW5TZWN0aW9uIiwiZXh0cmFjdEVycm9yIiwib3JpZ2luYWxFcnJvciIsImV4dHJhY3RlZENvbnRlbnQiLCJ0c01hdGNoIiwic3RyZW5ndGhzTWF0Y2giLCJuZWVkc01hdGNoIiwib2xkX3N0cl9sZW5ndGgiLCJuZXdfc3RyX2xlbmd0aCIsImpzb25NYXRjaCIsInVwZGF0ZWREb21haW5TZWN0aW9uIiwianNvbkVycm9yIiwiZXh0cmFjdGVkRG9tYWluIiwidG9waWNTZW50ZW5jZSIsInN0cmVuZ3RocyIsIm9yaWdpbmFsQ29tbWFuZCIsIm9yaWdpbmFsVGltZXN0YW1wIiwib2xkVGltZXN0YW1wIiwibmV3VGltZXN0YW1wIiwibmV3VmVyc2lvbiIsImFwaUVycm9yIiwiaW5wdXRMb3dlciIsInRvTG93ZXJDYXNlIiwidGFyZ2V0RG9tYWluIiwidXBkYXRlcyIsInNpbXVsYXRlZFJlcG9ydCIsInNpbXVsYXRlZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/text-editor-test/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/reportUtils.ts":
/*!********************************!*\
  !*** ./src/lib/reportUtils.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createReportSkeleton: () => (/* binding */ createReportSkeleton),\n/* harmony export */   deepMerge: () => (/* binding */ deepMerge),\n/* harmony export */   normalizeInput: () => (/* binding */ normalizeInput),\n/* harmony export */   updateDomainSection: () => (/* binding */ updateDomainSection)\n/* harmony export */ });\n/**\n * Normalize input data from various sources (text, PDF, audio)\n * @param input - Input data in various formats\n */ async function normalizeInput(input) {\n    // Handle different input formats\n    if (typeof input === 'string') {\n        return input;\n    } else if (input.text) {\n        return input.text;\n    } else if (input.pdfData) {\n        // Return the base64 PDF data - Claude will process it with its document capability\n        return input.pdfData;\n    }\n    return JSON.stringify(input);\n}\n/**\n * Create a default report skeleton if none exists\n */ function createReportSkeleton() {\n    return {\n        header: {\n            studentInformation: {\n                firstName: \"\",\n                lastName: \"\",\n                DOB: \"\",\n                reportDate: \"\",\n                evaluationDate: \"\",\n                parents: [],\n                homeLanguage: \"\"\n            },\n            reasonForReferral: \"\",\n            confidentialityStatement: \"\"\n        },\n        background: {\n            studentDemographicsAndBackground: {\n                educationalHistory: \"\"\n            },\n            healthReport: {\n                medicalHistory: \"\",\n                visionAndHearingScreening: \"\",\n                medicationsAndAllergies: \"\"\n            },\n            earlyInterventionHistory: \"\",\n            familyHistory: {\n                familyStructure: \"\",\n                languageAndCulturalBackground: \"\",\n                socioeconomicFactors: \"\"\n            },\n            parentGuardianConcerns: \"\"\n        },\n        assessmentResults: {\n            observations: {\n                classroomObservations: \"\",\n                playBasedInformalObservations: \"\",\n                socialInteractionObservations: \"\"\n            },\n            assessmentProceduresAndTools: {\n                overviewOfAssessmentMethods: \"\",\n                assessmentToolsUsed: [] // IDs of assessment tools\n            },\n            domains: {\n                receptive: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                expressive: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                pragmatic: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                articulation: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                voice: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                fluency: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                }\n            }\n        },\n        conclusion: {\n            eligibility: {\n                domains: {\n                    receptive: false,\n                    expressive: false,\n                    pragmatic: false,\n                    articulation: false,\n                    voice: false,\n                    fluency: false\n                },\n                californiaEdCode: \"\"\n            },\n            conclusion: {\n                summary: \"\"\n            },\n            recommendations: {\n                services: {\n                    typeOfService: \"\",\n                    frequency: \"\",\n                    setting: \"\"\n                },\n                accommodations: [],\n                facilitationStrategies: []\n            },\n            parentFriendlyGlossary: {\n                terms: {}\n            }\n        },\n        metadata: {\n            lastUpdated: new Date().toISOString(),\n            version: 1\n        }\n    };\n}\n/**\n * Deep merge utility function for properly merging nested objects and arrays\n */ function deepMerge(target, source) {\n    // Handle edge cases\n    if (!source || typeof source !== 'object') return source;\n    if (!target || typeof target !== 'object') return {\n        ...source\n    };\n    // Create a new object to avoid mutating the original\n    const result = {\n        ...target\n    };\n    Object.keys(source).forEach((key)=>{\n        const targetValue = result[key];\n        const sourceValue = source[key];\n        // Handle arrays - prefer source arrays over target arrays\n        if (Array.isArray(sourceValue)) {\n            result[key] = [\n                ...sourceValue\n            ]; // Create a new array to prevent reference issues\n        } else if (typeof sourceValue === 'object' && sourceValue !== null && typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n            result[key] = deepMerge(targetValue, sourceValue);\n        } else {\n            result[key] = sourceValue;\n        }\n    });\n    return result;\n}\n/**\n * Update a specific domain section with new data\n */ function updateDomainSection(report, domain, updates) {\n    const updatedReport = {\n        ...report\n    };\n    // Initialize domain if it doesn't exist\n    if (!updatedReport.assessmentResults.domains[domain]) {\n        updatedReport.assessmentResults.domains[domain] = {\n            isConcern: false,\n            topicSentence: '',\n            strengths: [],\n            needs: [],\n            impactStatement: ''\n        };\n    }\n    // Update specific fields\n    if (updates.isConcern !== undefined) {\n        updatedReport.assessmentResults.domains[domain].isConcern = updates.isConcern;\n    }\n    if (updates.topicSentence) {\n        updatedReport.assessmentResults.domains[domain].topicSentence = updates.topicSentence;\n    }\n    if (updates.strengths && updates.strengths.length > 0) {\n        updatedReport.assessmentResults.domains[domain].strengths = [\n            ...updatedReport.assessmentResults.domains[domain].strengths || [],\n            ...updates.strengths\n        ];\n    }\n    if (updates.needs && updates.needs.length > 0) {\n        updatedReport.assessmentResults.domains[domain].needs = [\n            ...updatedReport.assessmentResults.domains[domain].needs || [],\n            ...updates.needs\n        ];\n    }\n    if (updates.impactStatement) {\n        updatedReport.assessmentResults.domains[domain].impactStatement = updates.impactStatement;\n    }\n    // Also update the eligibility status if this is an area of concern\n    if (updates.isConcern !== undefined) {\n        updatedReport.conclusion.eligibility.domains[domain] = updates.isConcern;\n    }\n    // Update metadata\n    updatedReport.metadata.lastUpdated = new Date().toISOString();\n    updatedReport.metadata.version += 1;\n    return updatedReport;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjbEMsVUFBVSxDQUFDQyxXQUFXLENBQUNiLE9BQU8sQ0FBQzRDLE9BQU8sR0FBR0MsUUFBUTNDLFNBQVM7SUFDMUU7SUFFQSxrQkFBa0I7SUFDbEI0QyxjQUFjckIsUUFBUSxDQUFDQyxXQUFXLEdBQUcsSUFBSUMsT0FBT0MsV0FBVztJQUMzRGtCLGNBQWNyQixRQUFRLENBQUNJLE9BQU8sSUFBSTtJQUVsQyxPQUFPaUI7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL2JyYW5kb25icmV3ZXIvRG9jdW1lbnRzL0xpbmd1b3NpdHkvTGluZ3Vvc2l0eS9zcmMvbGliL3JlcG9ydFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERvbWFpblNlY3Rpb24sIFNwZWVjaExhbmd1YWdlUmVwb3J0IH0gZnJvbSAnQC90eXBlcy9yZXBvcnRUeXBlcyc7XG5cbi8qKlxuICogTm9ybWFsaXplIGlucHV0IGRhdGEgZnJvbSB2YXJpb3VzIHNvdXJjZXMgKHRleHQsIFBERiwgYXVkaW8pXG4gKiBAcGFyYW0gaW5wdXQgLSBJbnB1dCBkYXRhIGluIHZhcmlvdXMgZm9ybWF0c1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm9ybWFsaXplSW5wdXQoaW5wdXQ6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gIC8vIEhhbmRsZSBkaWZmZXJlbnQgaW5wdXQgZm9ybWF0c1xuICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBpbnB1dDtcbiAgfSBlbHNlIGlmIChpbnB1dC50ZXh0KSB7XG4gICAgcmV0dXJuIGlucHV0LnRleHQ7XG4gIH0gZWxzZSBpZiAoaW5wdXQucGRmRGF0YSkge1xuICAgIC8vIFJldHVybiB0aGUgYmFzZTY0IFBERiBkYXRhIC0gQ2xhdWRlIHdpbGwgcHJvY2VzcyBpdCB3aXRoIGl0cyBkb2N1bWVudCBjYXBhYmlsaXR5XG4gICAgcmV0dXJuIGlucHV0LnBkZkRhdGE7XG4gIH1cbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGlucHV0KTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBkZWZhdWx0IHJlcG9ydCBza2VsZXRvbiBpZiBub25lIGV4aXN0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVwb3J0U2tlbGV0b24oKTogU3BlZWNoTGFuZ3VhZ2VSZXBvcnQge1xuICByZXR1cm4ge1xuICAgIGhlYWRlcjoge1xuICAgICAgc3R1ZGVudEluZm9ybWF0aW9uOiB7XG4gICAgICAgIGZpcnN0TmFtZTogXCJcIixcbiAgICAgICAgbGFzdE5hbWU6IFwiXCIsXG4gICAgICAgIERPQjogXCJcIixcbiAgICAgICAgcmVwb3J0RGF0ZTogXCJcIixcbiAgICAgICAgZXZhbHVhdGlvbkRhdGU6IFwiXCIsXG4gICAgICAgIHBhcmVudHM6IFtdLFxuICAgICAgICBob21lTGFuZ3VhZ2U6IFwiXCJcbiAgICAgIH0sXG4gICAgICByZWFzb25Gb3JSZWZlcnJhbDogXCJcIixcbiAgICAgIGNvbmZpZGVudGlhbGl0eVN0YXRlbWVudDogXCJcIlxuICAgIH0sXG4gICAgYmFja2dyb3VuZDoge1xuICAgICAgc3R1ZGVudERlbW9ncmFwaGljc0FuZEJhY2tncm91bmQ6IHtcbiAgICAgICAgZWR1Y2F0aW9uYWxIaXN0b3J5OiBcIlwiXG4gICAgICB9LFxuICAgICAgaGVhbHRoUmVwb3J0OiB7XG4gICAgICAgIG1lZGljYWxIaXN0b3J5OiBcIlwiLFxuICAgICAgICB2aXNpb25BbmRIZWFyaW5nU2NyZWVuaW5nOiBcIlwiLFxuICAgICAgICBtZWRpY2F0aW9uc0FuZEFsbGVyZ2llczogXCJcIlxuICAgICAgfSxcbiAgICAgIGVhcmx5SW50ZXJ2ZW50aW9uSGlzdG9yeTogXCJcIixcbiAgICAgIGZhbWlseUhpc3Rvcnk6IHtcbiAgICAgICAgZmFtaWx5U3RydWN0dXJlOiBcIlwiLFxuICAgICAgICBsYW5ndWFnZUFuZEN1bHR1cmFsQmFja2dyb3VuZDogXCJcIixcbiAgICAgICAgc29jaW9lY29ub21pY0ZhY3RvcnM6IFwiXCJcbiAgICAgIH0sXG4gICAgICBwYXJlbnRHdWFyZGlhbkNvbmNlcm5zOiBcIlwiXG4gICAgfSxcbiAgICBhc3Nlc3NtZW50UmVzdWx0czoge1xuICAgICAgb2JzZXJ2YXRpb25zOiB7XG4gICAgICAgIGNsYXNzcm9vbU9ic2VydmF0aW9uczogXCJcIixcbiAgICAgICAgcGxheUJhc2VkSW5mb3JtYWxPYnNlcnZhdGlvbnM6IFwiXCIsXG4gICAgICAgIHNvY2lhbEludGVyYWN0aW9uT2JzZXJ2YXRpb25zOiBcIlwiXG4gICAgICB9LFxuICAgICAgYXNzZXNzbWVudFByb2NlZHVyZXNBbmRUb29sczoge1xuICAgICAgICBvdmVydmlld09mQXNzZXNzbWVudE1ldGhvZHM6IFwiXCIsXG4gICAgICAgIGFzc2Vzc21lbnRUb29sc1VzZWQ6IFtdIC8vIElEcyBvZiBhc3Nlc3NtZW50IHRvb2xzXG4gICAgICB9LFxuICAgICAgZG9tYWluczoge1xuICAgICAgICByZWNlcHRpdmU6IHtcbiAgICAgICAgICBpc0NvbmNlcm46IGZhbHNlLFxuICAgICAgICAgIHRvcGljU2VudGVuY2U6IFwiXCIsXG4gICAgICAgICAgc3RyZW5ndGhzOiBbXSxcbiAgICAgICAgICBuZWVkczogW10sXG4gICAgICAgICAgaW1wYWN0U3RhdGVtZW50OiBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIGV4cHJlc3NpdmU6IHtcbiAgICAgICAgICBpc0NvbmNlcm46IGZhbHNlLFxuICAgICAgICAgIHRvcGljU2VudGVuY2U6IFwiXCIsXG4gICAgICAgICAgc3RyZW5ndGhzOiBbXSxcbiAgICAgICAgICBuZWVkczogW10sXG4gICAgICAgICAgaW1wYWN0U3RhdGVtZW50OiBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIHByYWdtYXRpYzoge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgYXJ0aWN1bGF0aW9uOiB7XG4gICAgICAgICAgaXNDb25jZXJuOiBmYWxzZSxcbiAgICAgICAgICB0b3BpY1NlbnRlbmNlOiBcIlwiLFxuICAgICAgICAgIHN0cmVuZ3RoczogW10sXG4gICAgICAgICAgbmVlZHM6IFtdLFxuICAgICAgICAgIGltcGFjdFN0YXRlbWVudDogXCJcIlxuICAgICAgICB9LFxuICAgICAgICB2b2ljZToge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgZmx1ZW5jeToge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgY29uY2x1c2lvbjoge1xuICAgICAgZWxpZ2liaWxpdHk6IHtcbiAgICAgICAgZG9tYWluczoge1xuICAgICAgICAgIHJlY2VwdGl2ZTogZmFsc2UsXG4gICAgICAgICAgZXhwcmVzc2l2ZTogZmFsc2UsXG4gICAgICAgICAgcHJhZ21hdGljOiBmYWxzZSxcbiAgICAgICAgICBhcnRpY3VsYXRpb246IGZhbHNlLFxuICAgICAgICAgIHZvaWNlOiBmYWxzZSxcbiAgICAgICAgICBmbHVlbmN5OiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBjYWxpZm9ybmlhRWRDb2RlOiBcIlwiXG4gICAgICB9LFxuICAgICAgY29uY2x1c2lvbjoge1xuICAgICAgICBzdW1tYXJ5OiBcIlwiXG4gICAgICB9LFxuICAgICAgcmVjb21tZW5kYXRpb25zOiB7XG4gICAgICAgIHNlcnZpY2VzOiB7XG4gICAgICAgICAgdHlwZU9mU2VydmljZTogXCJcIixcbiAgICAgICAgICBmcmVxdWVuY3k6IFwiXCIsXG4gICAgICAgICAgc2V0dGluZzogXCJcIlxuICAgICAgICB9LFxuICAgICAgICBhY2NvbW1vZGF0aW9uczogW10sXG4gICAgICAgIGZhY2lsaXRhdGlvblN0cmF0ZWdpZXM6IFtdXG4gICAgICB9LFxuICAgICAgcGFyZW50RnJpZW5kbHlHbG9zc2FyeToge1xuICAgICAgICB0ZXJtczoge31cbiAgICAgIH1cbiAgICB9LFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgdmVyc2lvbjogMVxuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBEZWVwIG1lcmdlIHV0aWxpdHkgZnVuY3Rpb24gZm9yIHByb3Blcmx5IG1lcmdpbmcgbmVzdGVkIG9iamVjdHMgYW5kIGFycmF5c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVlcE1lcmdlKHRhcmdldDogYW55LCBzb3VyY2U6IGFueSk6IGFueSB7XG4gIC8vIEhhbmRsZSBlZGdlIGNhc2VzXG4gIGlmICghc291cmNlIHx8IHR5cGVvZiBzb3VyY2UgIT09ICdvYmplY3QnKSByZXR1cm4gc291cmNlO1xuICBpZiAoIXRhcmdldCB8fCB0eXBlb2YgdGFyZ2V0ICE9PSAnb2JqZWN0JykgcmV0dXJuIHsgLi4uc291cmNlIH07XG4gIFxuICAvLyBDcmVhdGUgYSBuZXcgb2JqZWN0IHRvIGF2b2lkIG11dGF0aW5nIHRoZSBvcmlnaW5hbFxuICBjb25zdCByZXN1bHQgPSB7IC4uLnRhcmdldCB9O1xuICBcbiAgT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0VmFsdWUgPSByZXN1bHRba2V5XTtcbiAgICBjb25zdCBzb3VyY2VWYWx1ZSA9IHNvdXJjZVtrZXldO1xuICAgIFxuICAgIC8vIEhhbmRsZSBhcnJheXMgLSBwcmVmZXIgc291cmNlIGFycmF5cyBvdmVyIHRhcmdldCBhcnJheXNcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VWYWx1ZSkpIHtcbiAgICAgIHJlc3VsdFtrZXldID0gWy4uLnNvdXJjZVZhbHVlXTsgLy8gQ3JlYXRlIGEgbmV3IGFycmF5IHRvIHByZXZlbnQgcmVmZXJlbmNlIGlzc3Vlc1xuICAgIH1cbiAgICAvLyBSZWN1cnNpdmVseSBtZXJnZSBvYmplY3RzIChidXQgbm90IGFycmF5cylcbiAgICBlbHNlIGlmIChcbiAgICAgIHR5cGVvZiBzb3VyY2VWYWx1ZSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICBzb3VyY2VWYWx1ZSAhPT0gbnVsbCAmJiBcbiAgICAgIHR5cGVvZiB0YXJnZXRWYWx1ZSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICB0YXJnZXRWYWx1ZSAhPT0gbnVsbCAmJlxuICAgICAgIUFycmF5LmlzQXJyYXkodGFyZ2V0VmFsdWUpXG4gICAgKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGRlZXBNZXJnZSh0YXJnZXRWYWx1ZSwgc291cmNlVmFsdWUpO1xuICAgIH1cbiAgICAvLyBGb3IgcHJpbWl0aXZlcyBvciBuZXcgb2JqZWN0cywgdXNlIHRoZSBzb3VyY2UgdmFsdWVcbiAgICBlbHNlIHtcbiAgICAgIHJlc3VsdFtrZXldID0gc291cmNlVmFsdWU7XG4gICAgfVxuICB9KTtcbiAgXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogVXBkYXRlIGEgc3BlY2lmaWMgZG9tYWluIHNlY3Rpb24gd2l0aCBuZXcgZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRG9tYWluU2VjdGlvbihcbiAgcmVwb3J0OiBTcGVlY2hMYW5ndWFnZVJlcG9ydCxcbiAgZG9tYWluOiBzdHJpbmcsXG4gIHVwZGF0ZXM6IFBhcnRpYWw8RG9tYWluU2VjdGlvbj5cbik6IFNwZWVjaExhbmd1YWdlUmVwb3J0IHtcbiAgY29uc3QgdXBkYXRlZFJlcG9ydCA9IHsgLi4ucmVwb3J0IH07XG4gIFxuICAvLyBJbml0aWFsaXplIGRvbWFpbiBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gIGlmICghdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0pIHtcbiAgICB1cGRhdGVkUmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbZG9tYWluXSA9IHtcbiAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICB0b3BpY1NlbnRlbmNlOiAnJyxcbiAgICAgIHN0cmVuZ3RoczogW10sXG4gICAgICBuZWVkczogW10sXG4gICAgICBpbXBhY3RTdGF0ZW1lbnQ6ICcnXG4gICAgfTtcbiAgfVxuICBcbiAgLy8gVXBkYXRlIHNwZWNpZmljIGZpZWxkc1xuICBpZiAodXBkYXRlcy5pc0NvbmNlcm4gIT09IHVuZGVmaW5lZCkge1xuICAgIHVwZGF0ZWRSZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1tkb21haW5dLmlzQ29uY2VybiA9IHVwZGF0ZXMuaXNDb25jZXJuO1xuICB9XG4gIFxuICBpZiAodXBkYXRlcy50b3BpY1NlbnRlbmNlKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0udG9waWNTZW50ZW5jZSA9IHVwZGF0ZXMudG9waWNTZW50ZW5jZTtcbiAgfVxuICBcbiAgaWYgKHVwZGF0ZXMuc3RyZW5ndGhzICYmIHVwZGF0ZXMuc3RyZW5ndGhzLmxlbmd0aCA+IDApIHtcbiAgICB1cGRhdGVkUmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbZG9tYWluXS5zdHJlbmd0aHMgPSBbXG4gICAgICAuLi4odXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0uc3RyZW5ndGhzIHx8IFtdKSxcbiAgICAgIC4uLnVwZGF0ZXMuc3RyZW5ndGhzXG4gICAgXTtcbiAgfVxuICBcbiAgaWYgKHVwZGF0ZXMubmVlZHMgJiYgdXBkYXRlcy5uZWVkcy5sZW5ndGggPiAwKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0ubmVlZHMgPSBbXG4gICAgICAuLi4odXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0ubmVlZHMgfHwgW10pLFxuICAgICAgLi4udXBkYXRlcy5uZWVkc1xuICAgIF07XG4gIH1cbiAgXG4gIGlmICh1cGRhdGVzLmltcGFjdFN0YXRlbWVudCkge1xuICAgIHVwZGF0ZWRSZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1tkb21haW5dLmltcGFjdFN0YXRlbWVudCA9IHVwZGF0ZXMuaW1wYWN0U3RhdGVtZW50O1xuICB9XG4gIFxuICAvLyBBbHNvIHVwZGF0ZSB0aGUgZWxpZ2liaWxpdHkgc3RhdHVzIGlmIHRoaXMgaXMgYW4gYXJlYSBvZiBjb25jZXJuXG4gIGlmICh1cGRhdGVzLmlzQ29uY2VybiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5jb25jbHVzaW9uLmVsaWdpYmlsaXR5LmRvbWFpbnNbZG9tYWluXSA9IHVwZGF0ZXMuaXNDb25jZXJuO1xuICB9XG4gIFxuICAvLyBVcGRhdGUgbWV0YWRhdGFcbiAgdXBkYXRlZFJlcG9ydC5tZXRhZGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgdXBkYXRlZFJlcG9ydC5tZXRhZGF0YS52ZXJzaW9uICs9IDE7XG4gIFxuICByZXR1cm4gdXBkYXRlZFJlcG9ydDtcbn0iXSwibmFtZXMiOlsibm9ybWFsaXplSW5wdXQiLCJpbnB1dCIsInRleHQiLCJwZGZEYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZVJlcG9ydFNrZWxldG9uIiwiaGVhZGVyIiwic3R1ZGVudEluZm9ybWF0aW9uIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJET0IiLCJyZXBvcnREYXRlIiwiZXZhbHVhdGlvbkRhdGUiLCJwYXJlbnRzIiwiaG9tZUxhbmd1YWdlIiwicmVhc29uRm9yUmVmZXJyYWwiLCJjb25maWRlbnRpYWxpdHlTdGF0ZW1lbnQiLCJiYWNrZ3JvdW5kIiwic3R1ZGVudERlbW9ncmFwaGljc0FuZEJhY2tncm91bmQiLCJlZHVjYXRpb25hbEhpc3RvcnkiLCJoZWFsdGhSZXBvcnQiLCJtZWRpY2FsSGlzdG9yeSIsInZpc2lvbkFuZEhlYXJpbmdTY3JlZW5pbmciLCJtZWRpY2F0aW9uc0FuZEFsbGVyZ2llcyIsImVhcmx5SW50ZXJ2ZW50aW9uSGlzdG9yeSIsImZhbWlseUhpc3RvcnkiLCJmYW1pbHlTdHJ1Y3R1cmUiLCJsYW5ndWFnZUFuZEN1bHR1cmFsQmFja2dyb3VuZCIsInNvY2lvZWNvbm9taWNGYWN0b3JzIiwicGFyZW50R3VhcmRpYW5Db25jZXJucyIsImFzc2Vzc21lbnRSZXN1bHRzIiwib2JzZXJ2YXRpb25zIiwiY2xhc3Nyb29tT2JzZXJ2YXRpb25zIiwicGxheUJhc2VkSW5mb3JtYWxPYnNlcnZhdGlvbnMiLCJzb2NpYWxJbnRlcmFjdGlvbk9ic2VydmF0aW9ucyIsImFzc2Vzc21lbnRQcm9jZWR1cmVzQW5kVG9vbHMiLCJvdmVydmlld09mQXNzZXNzbWVudE1ldGhvZHMiLCJhc3Nlc3NtZW50VG9vbHNVc2VkIiwiZG9tYWlucyIsInJlY2VwdGl2ZSIsImlzQ29uY2VybiIsInRvcGljU2VudGVuY2UiLCJzdHJlbmd0aHMiLCJuZWVkcyIsImltcGFjdFN0YXRlbWVudCIsImV4cHJlc3NpdmUiLCJwcmFnbWF0aWMiLCJhcnRpY3VsYXRpb24iLCJ2b2ljZSIsImZsdWVuY3kiLCJjb25jbHVzaW9uIiwiZWxpZ2liaWxpdHkiLCJjYWxpZm9ybmlhRWRDb2RlIiwic3VtbWFyeSIsInJlY29tbWVuZGF0aW9ucyIsInNlcnZpY2VzIiwidHlwZU9mU2VydmljZSIsImZyZXF1ZW5jeSIsInNldHRpbmciLCJhY2NvbW1vZGF0aW9ucyIsImZhY2lsaXRhdGlvblN0cmF0ZWdpZXMiLCJwYXJlbnRGcmllbmRseUdsb3NzYXJ5IiwidGVybXMiLCJtZXRhZGF0YSIsImxhc3RVcGRhdGVkIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidmVyc2lvbiIsImRlZXBNZXJnZSIsInRhcmdldCIsInNvdXJjZSIsInJlc3VsdCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwidGFyZ2V0VmFsdWUiLCJzb3VyY2VWYWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsInVwZGF0ZURvbWFpblNlY3Rpb24iLCJyZXBvcnQiLCJkb21haW4iLCJ1cGRhdGVzIiwidXBkYXRlZFJlcG9ydCIsInVuZGVmaW5lZCIsImxlbmd0aCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/reportUtils.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@opentelemetry"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();