/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/text-editor-test/route";
exports.ids = ["app/api/text-editor-test/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_brandonbrewer_Documents_Linguosity_Linguosity_src_app_api_text_editor_test_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/text-editor-test/route.ts */ \"(rsc)/./src/app/api/text-editor-test/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/text-editor-test/route\",\n        pathname: \"/api/text-editor-test\",\n        filename: \"route\",\n        bundlePath: \"app/api/text-editor-test/route\"\n    },\n    resolvedPagePath: \"/Users/brandonbrewer/Documents/Linguosity/Linguosity/src/app/api/text-editor-test/route.ts\",\n    nextConfigOutput,\n    userland: _Users_brandonbrewer_Documents_Linguosity_Linguosity_src_app_api_text_editor_test_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZ0ZXh0LWVkaXRvci10ZXN0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZ0ZXh0LWVkaXRvci10ZXN0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdGV4dC1lZGl0b3ItdGVzdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmJyYW5kb25icmV3ZXIlMkZEb2N1bWVudHMlMkZMaW5ndW9zaXR5JTJGTGluZ3Vvc2l0eSUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZicmFuZG9uYnJld2VyJTJGRG9jdW1lbnRzJTJGTGluZ3Vvc2l0eSUyRkxpbmd1b3NpdHkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUMwQztBQUN2SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2JyYW5kb25icmV3ZXIvRG9jdW1lbnRzL0xpbmd1b3NpdHkvTGluZ3Vvc2l0eS9zcmMvYXBwL2FwaS90ZXh0LWVkaXRvci10ZXN0L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvdGV4dC1lZGl0b3ItdGVzdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RleHQtZWRpdG9yLXRlc3RcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3RleHQtZWRpdG9yLXRlc3Qvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYnJhbmRvbmJyZXdlci9Eb2N1bWVudHMvTGluZ3Vvc2l0eS9MaW5ndW9zaXR5L3NyYy9hcHAvYXBpL3RleHQtZWRpdG9yLXRlc3Qvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/text-editor-test/route.ts":
/*!***********************************************!*\
  !*** ./src/app/api/text-editor-test/route.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/reportUtils */ \"(rsc)/./src/lib/reportUtils.ts\");\n\n\n/**\n * API endpoint that implements batch processing with Claude's Message Batches API\n */ async function POST(request) {\n    const requestId = `req_${Date.now().toString(36)}_${Math.random().toString(36).substring(2, 7)}`;\n    console.log(`[${requestId}] 🚀 Batch API request started`);\n    try {\n        // Extract and validate input\n        const { input, report: existingReport, updateSection, pdfData } = await request.json();\n        const isPdfUpload = !!pdfData;\n        const inputData = isPdfUpload ? {\n            pdfData\n        } : input;\n        console.log(`[${requestId}] 📥 Received request payload:`, {\n            inputType: isPdfUpload ? 'PDF' : 'text',\n            inputSize: isPdfUpload ? `${pdfData.length} chars (base64)` : typeof input === 'string' ? `${input.substring(0, 50)}${input.length > 50 ? '...' : ''}` : input,\n            reportProvided: !!existingReport,\n            updateSection: updateSection || 'auto-detect'\n        });\n        // Validate request parameters\n        if (!inputData && !isPdfUpload) {\n            console.log(`[${requestId}] ❌ Validation failed: Missing input data`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Input data is required'\n            }, {\n                status: 400\n            });\n        }\n        // Use provided report or create default skeleton\n        const report = existingReport || (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.createReportSkeleton)();\n        console.log(`[${requestId}] 📋 Using ${existingReport ? 'provided' : 'default'} report structure with ${Object.keys(report.assessmentResults.domains).length} domains`);\n        // Get API key from environment variables\n        const apiKey = process.env.ANTHROPIC_API_KEY;\n        // Check if API key is available\n        if (!apiKey) {\n            console.log(`[${requestId}] ❌ Missing API key: ANTHROPIC_API_KEY not set`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'ANTHROPIC_API_KEY is not set in environment variables'\n            }, {\n                status: 500\n            });\n        }\n        try {\n            // Normalize input data (handles text, PDF, etc.)\n            console.log(`[${requestId}] 🔄 Normalizing input data...`);\n            const normalizedInput = await (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.normalizeInput)(inputData);\n            console.log(`[${requestId}] ✅ Input normalized, length: ${normalizedInput.length} chars`);\n            // Log if this is a PDF upload\n            if (isPdfUpload) {\n                console.log(`[${requestId}] 📄 Processing PDF data...`);\n            }\n            // === Token Counting ===\n            let tokenCount = 0;\n            try {\n                console.log(`[${requestId}] 🧮 Counting tokens...`);\n                const tokenCountPayload = {\n                    model: \"claude-3-7-sonnet-20250219\",\n                    system: \"You are an expert educational speech-language pathologist.\",\n                    messages: [\n                        {\n                            role: \"user\",\n                            content: normalizedInput\n                        }\n                    ]\n                };\n                const tokenCountResponse = await fetch(\"https://api.anthropic.com/v1/messages/count_tokens\", {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"x-api-key\": apiKey,\n                        \"anthropic-version\": \"2023-06-01\"\n                    },\n                    body: JSON.stringify(tokenCountPayload)\n                });\n                if (!tokenCountResponse.ok) {\n                    const errorData = await tokenCountResponse.json();\n                    console.error(`[${requestId}] ❌ Token counting failed:`, errorData);\n                    // Don't throw, just use an estimated token count instead\n                    tokenCount = Math.ceil(normalizedInput.length / 4); // Rough estimate: 4 chars per token\n                    console.log(`[${requestId}] ⚠️ Using estimated token count: ${tokenCount}`);\n                } else {\n                    const tokenCountResult = await tokenCountResponse.json();\n                    tokenCount = tokenCountResult.input_tokens;\n                    console.log(`[${requestId}] 🧮 Token count:`, tokenCount);\n                }\n            } catch (tokenError) {\n                // If token counting fails, estimate based on input length\n                console.error(`[${requestId}] ❌ Token counting error:`, tokenError);\n                tokenCount = Math.ceil(normalizedInput.length / 4); // Rough estimate: 4 chars per token\n                console.log(`[${requestId}] ⚠️ Using estimated token count: ${tokenCount}`);\n            }\n            // === Build Batch Payload ===\n            // If no specific section is provided, update all major sections.\n            const sections = updateSection ? updateSection.includes(',') ? updateSection.split(',').map((s)=>s.trim()) : [\n                updateSection\n            ] : [\n                \"header\",\n                \"background\",\n                \"assessmentResults\",\n                \"conclusion\"\n            ];\n            console.log(`[${requestId}] 🎯 Target sections: [${sections.join(', ')}]`);\n            // Create content block for user message based on input type\n            let userContentBlock;\n            if (isPdfUpload) {\n                // PDF document content\n                userContentBlock = [\n                    {\n                        type: \"text\",\n                        text: `I need to update the speech-language report based on the content in this PDF document.`\n                    },\n                    {\n                        type: \"document\",\n                        source: {\n                            type: \"base64\",\n                            media_type: \"application/pdf\",\n                            data: normalizedInput\n                        }\n                    }\n                ];\n            } else {\n                // Plain text content\n                userContentBlock = [\n                    {\n                        type: \"text\",\n                        text: `I need to update the speech-language report based on this new information: \"${normalizedInput}\"`\n                    }\n                ];\n            }\n            const requestsArray = sections.map((section)=>{\n                // If section is a path like \"assessmentResults.domains.receptive\", extract the main section\n                const mainSection = section.split('.')[0];\n                const sectionJson = JSON.stringify(// If section is a path, traverse to the specific subsection\n                section.includes('.') ? section.split('.').reduce((obj, key)=>obj?.[key], report) : report[section], null, 2);\n                // Create a contextual system prompt for this section\n                let sectionPrompt;\n                switch(mainSection){\n                    case 'header':\n                        sectionPrompt = `You are an expert speech-language pathologist updating the student information and referral reasons.\nFocus on extracting factual information like names, dates, and demographic details.\nDO NOT create fictional details if they're not in the input.`;\n                        break;\n                    case 'background':\n                        sectionPrompt = `You are an expert speech-language pathologist updating background information.\nFocus on educational history, health information, family details, and parent concerns.\nBe thorough and clinically accurate, but stay objective and factual.`;\n                        break;\n                    case 'assessmentResults':\n                        sectionPrompt = `You are an expert speech-language pathologist updating assessment results.\nWhen analyzing test results, note specific scores, strengths, and areas of need.\nFor language domains, extract the specific evidence and impact on educational performance.\nIf assessment tools are mentioned, add them to the appropriate domain sections.`;\n                        break;\n                    case 'conclusion':\n                        sectionPrompt = `You are an expert speech-language pathologist finalizing conclusions and recommendations.\nOnly identify domains as areas of concern when clear evidence supports it.\nBe specific with recommendations for therapy frequency, service type, and setting.\nInclude only evidence-based recommendations appropriate for educational settings.`;\n                        break;\n                    default:\n                        sectionPrompt = `You are an expert speech-language pathologist updating the report section: ${section}.\nBe specific, objective, and clinically accurate based only on the information provided.`;\n                }\n                // Use a consistent format for custom_id that matches what we expect in the status endpoint\n                const customId = `update-${section}`;\n                console.log(`[${requestId}] 📝 Creating batch request with custom_id: ${customId} for section: ${section}`);\n                return {\n                    custom_id: customId,\n                    params: {\n                        model: \"claude-3-7-sonnet-20250219\",\n                        max_tokens: 1024,\n                        system: `${sectionPrompt}\n\nINSTRUCTIONS:\n1. Analyze the input information and update the section JSON appropriately\n2. Return your response as an update_key JSON command in this format:\n\n\\`\\`\\`json\n{\n  \"command\": \"update_key\",\n  \"path\": \"${section}\",\n  \"action\": \"merge\",\n  \"value\": { updated content as JSON }\n}\n\\`\\`\\`\n\nWhere:\n- path: The exact JSON path to update\n- action: Use \"append\" for arrays, \"replace\" for text fields, or \"merge\" for objects\n- value: The new content, properly formatted as JSON\n\nDO NOT use the text editor tool. ONLY respond with a properly formatted update_key JSON command.`,\n                        messages: [\n                            {\n                                role: \"user\",\n                                content: [\n                                    ...userContentBlock,\n                                    {\n                                        type: \"text\",\n                                        text: `Here is the current ${section} section JSON:\n\\`\\`\\`json\n${sectionJson}\n\\`\\`\\`\n\nPlease update this section based on the information I provided.\nRespond ONLY with an update_key JSON command.`\n                                    }\n                                ]\n                            }\n                        ]\n                    }\n                };\n            });\n            // Log the mapping of custom_ids to sections for debugging\n            const customIdMapping = requestsArray.map((req)=>`${req.custom_id} → ${req.custom_id.replace('update-', '')}`);\n            console.log(`[${requestId}] 🔍 Custom ID mapping: ${customIdMapping.join(', ')}`);\n            const batchPayload = {\n                requests: requestsArray\n            };\n            console.log(`[${requestId}] 📦 Preparing batch with ${requestsArray.length} requests`);\n            // === Submit Batch Request ===\n            console.log(`[${requestId}] 🔌 Submitting batch request to Anthropic...`);\n            // Define batchResponse outside the try block so it's accessible later\n            let batchResponse;\n            let batchResult;\n            try {\n                batchResponse = await fetch(\"https://api.anthropic.com/v1/messages/batches\", {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"x-api-key\": apiKey,\n                        \"anthropic-version\": \"2023-06-01\"\n                    },\n                    body: JSON.stringify(batchPayload)\n                });\n                if (!batchResponse.ok) {\n                    // Try to get detailed error info if available\n                    try {\n                        const errorData = await batchResponse.json();\n                        console.error(`[${requestId}] ❌ Batch processing failed:`, errorData);\n                        // Check if there's an error with the API key or permissions\n                        if (batchResponse.status === 401 || batchResponse.status === 403) {\n                            throw new Error(`API authentication error: ${errorData.error || 'Invalid API key or permissions'}`);\n                        }\n                        throw new Error(JSON.stringify(errorData.error) || \"Batch processing failed\");\n                    } catch (parseError) {\n                        // If we can't parse the error response, return a generic error\n                        console.error(`[${requestId}] ❌ Failed to parse batch error response:`, parseError);\n                        throw new Error(`Batch API error: ${batchResponse.status} ${batchResponse.statusText}`);\n                    }\n                }\n                // Process successful response\n                try {\n                    batchResult = await batchResponse.json();\n                } catch (parseError) {\n                    console.error(`[${requestId}] ❌ Failed to parse batch response:`, parseError);\n                    throw new Error('Failed to parse batch response');\n                }\n            } catch (batchError) {\n                // Handle network errors or other exceptions\n                console.error(`[${requestId}] ❌ Batch request error:`, batchError);\n                // Fall back to simulated response\n                console.log(`[${requestId}] ⚠️ Falling back to simulated batch mode due to API error`);\n                // Create a simulated batch ID using the request ID\n                // Note: In a real API, the batch ID would start with msgbatch_ prefix\n                // but for our simulation, we use simulated_ to distinguish it\n                const simulatedBatchId = `simulated_${requestId}`;\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    batch: {\n                        id: simulatedBatchId,\n                        status: 'running',\n                        requestCount: sections.length,\n                        sections: sections,\n                        created: new Date().toISOString(),\n                        simulated: true\n                    },\n                    tokenCount: tokenCount,\n                    requestId: requestId,\n                    message: 'Using simulated batch due to API error'\n                });\n            }\n            // If we reach here, we have a valid batchResult\n            // Safely log and extract batch info, with fallbacks for unexpected response structure\n            const batchId = batchResult?.id || 'unknown';\n            const requestCount = batchResult?.requests?.length || 0;\n            const batchStatus = batchResult?.status || 'unknown';\n            const batchCreated = batchResult?.created || new Date().toISOString();\n            console.log(`[${requestId}] ✅ Batch created, ID: ${batchId}, ${requestCount} requests`);\n            // We successfully got a response from Anthropic's API!\n            // Ensure the batch ID is a valid Anthropic batch ID (should start with msgbatch_)\n            if (!batchId.startsWith('msgbatch_')) {\n                console.warn(`[${requestId}] ⚠️ Unexpected batch ID format from Anthropic: ${batchId}`);\n                console.warn(`[${requestId}] ⚠️ Batch IDs should start with 'msgbatch_'. Using simulated batch instead.`);\n                // Fall back to simulated mode if Anthropic returned an unexpected batch ID format\n                const simulatedBatchId = `simulated_${requestId}`;\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    batch: {\n                        id: simulatedBatchId,\n                        status: 'running',\n                        requestCount: sections.length,\n                        sections: sections,\n                        created: new Date().toISOString(),\n                        simulated: true\n                    },\n                    tokenCount: tokenCount,\n                    requestId: requestId,\n                    message: 'Using simulated batch due to unexpected ID format'\n                });\n            }\n            // Return the details for a valid Anthropic batch\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                batch: {\n                    id: batchId,\n                    status: batchStatus,\n                    requestCount: requestCount,\n                    sections: sections,\n                    created: batchCreated\n                },\n                tokenCount: tokenCount,\n                requestId: requestId\n            });\n        } catch (apiError) {\n            console.error(`[${requestId}] ❌ Error calling Claude API:`, apiError);\n            // Fallback for testing without API\n            console.log(`[${requestId}] ⚠️ Using fallback mode for testing`);\n            const updatedReport = {\n                ...report\n            };\n            // Simple domain detection based on keywords\n            const inputLower = input?.toLowerCase() || '';\n            let targetDomain = 'articulation';\n            if (inputLower.includes('understand') || inputLower.includes('follow') || inputLower.includes('direction')) {\n                targetDomain = 'receptive';\n            } else if (inputLower.includes('express') || inputLower.includes('vocabulary') || inputLower.includes('sentence')) {\n                targetDomain = 'expressive';\n            } else if (inputLower.includes('social') || inputLower.includes('eye contact') || inputLower.includes('peer')) {\n                targetDomain = 'pragmatic';\n            } else if (inputLower.includes('sound') || inputLower.includes('pronounce') || inputLower.includes('intelligible')) {\n                targetDomain = 'articulation';\n            }\n            console.log(`[${requestId}] 🔍 Fallback detected domain: ${targetDomain}`);\n            // Create a simulated update\n            const updates = {\n                strengths: [\n                    input\n                ]\n            };\n            if (!updatedReport.assessmentResults.domains[targetDomain].topicSentence) {\n                updates.topicSentence = `Student demonstrates challenges in ${targetDomain} language skills.`;\n            }\n            const simulatedReport = (0,_lib_reportUtils__WEBPACK_IMPORTED_MODULE_1__.updateDomainSection)(updatedReport, targetDomain, updates);\n            console.log(`[${requestId}] ✅ Simulated update applied to domain: ${targetDomain}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                report: simulatedReport,\n                apiError: apiError instanceof Error ? apiError.message : 'API call failed',\n                simulated: true,\n                affectedDomain: targetDomain\n            });\n        }\n    } catch (error) {\n        console.error(`[${requestId}] ❌ Error processing batch request:`, error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to process the request',\n            details: error instanceof Error ? error.message : 'Unknown error'\n        }, {\n            status: 500\n        });\n    } finally{\n        console.log(`[${requestId}] 🏁 Batch API request completed`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS90ZXh0LWVkaXRvci10ZXN0L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3RDtBQUdpRDtBQUV6Rzs7Q0FFQyxHQUNNLGVBQWVJLEtBQUtDLE9BQW9CO0lBQzdDLE1BQU1DLFlBQVksQ0FBQyxJQUFJLEVBQUVDLEtBQUtDLEdBQUcsR0FBR0MsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdGLFFBQVEsQ0FBQyxJQUFJRyxTQUFTLENBQUMsR0FBRyxJQUFJO0lBQ2hHQyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUVSLFVBQVUsOEJBQThCLENBQUM7SUFFekQsSUFBSTtRQUNGLDZCQUE2QjtRQUM3QixNQUFNLEVBQUVTLEtBQUssRUFBRUMsUUFBUUMsY0FBYyxFQUFFQyxhQUFhLEVBQUVDLE9BQU8sRUFBRSxHQUFHLE1BQU1kLFFBQVFlLElBQUk7UUFDcEYsTUFBTUMsY0FBYyxDQUFDLENBQUNGO1FBQ3RCLE1BQU1HLFlBQVlELGNBQWM7WUFBRUY7UUFBUSxJQUFJSjtRQUU5Q0YsUUFBUUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFUixVQUFVLDhCQUE4QixDQUFDLEVBQUU7WUFDekRpQixXQUFXRixjQUFjLFFBQVE7WUFDakNHLFdBQVdILGNBQWMsR0FBR0YsUUFBUU0sTUFBTSxDQUFDLGVBQWUsQ0FBQyxHQUNoRCxPQUFPVixVQUFVLFdBQVcsR0FBR0EsTUFBTUgsU0FBUyxDQUFDLEdBQUcsTUFBTUcsTUFBTVUsTUFBTSxHQUFHLEtBQUssUUFBUSxJQUFJLEdBQUdWO1lBQ3RHVyxnQkFBZ0IsQ0FBQyxDQUFDVDtZQUNsQkMsZUFBZUEsaUJBQWlCO1FBQ2xDO1FBRUEsOEJBQThCO1FBQzlCLElBQUksQ0FBQ0ksYUFBYSxDQUFDRCxhQUFhO1lBQzlCUixRQUFRQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUVSLFVBQVUseUNBQXlDLENBQUM7WUFDcEUsT0FBT04scURBQVlBLENBQUNv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QUMsQ0FBQyxFQUFFUixVQUFVLHdDQUF3QyxFQUFFeUcsY0FBYztZQUVsRixPQUFPL0cscURBQVlBLENBQUNvQixJQUFJLENBQUM7Z0JBQ3ZCSixRQUFRbUc7Z0JBQ1JSLFVBQVVBLG9CQUFvQmpCLFFBQVFpQixTQUFTTixPQUFPLEdBQUc7Z0JBQ3pERCxXQUFXO2dCQUNYZ0IsZ0JBQWdCTDtZQUNsQjtRQUNGO0lBQ0YsRUFBRSxPQUFPcEYsT0FBTztRQUNkZCxRQUFRYyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUVyQixVQUFVLG1DQUFtQyxDQUFDLEVBQUVxQjtRQUNsRSxPQUFPM0IscURBQVlBLENBQUNvQixJQUFJLENBQ3RCO1lBQUVPLE9BQU87WUFBaUMwRixTQUFTMUYsaUJBQWlCK0QsUUFBUS9ELE1BQU0wRSxPQUFPLEdBQUc7UUFBZ0IsR0FDNUc7WUFBRXpFLFFBQVE7UUFBSTtJQUVsQixTQUFVO1FBQ1JmLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRVIsVUFBVSxnQ0FBZ0MsQ0FBQztJQUM3RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvYnJhbmRvbmJyZXdlci9Eb2N1bWVudHMvTGluZ3Vvc2l0eS9MaW5ndW9zaXR5L3NyYy9hcHAvYXBpL3RleHQtZWRpdG9yLXRlc3Qvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IEFzc2Vzc21lbnRUb29sLCBnZXRBc3Nlc3NtZW50VG9vbEJ5SWQgfSBmcm9tICdAL2xpYi9hc3Nlc3NtZW50LXRvb2xzJztcbmltcG9ydCB7IFNwZWVjaExhbmd1YWdlUmVwb3J0LCBEb21haW5TZWN0aW9uIH0gZnJvbSAnQC90eXBlcy9yZXBvcnRUeXBlcyc7XG5pbXBvcnQgeyBub3JtYWxpemVJbnB1dCwgY3JlYXRlUmVwb3J0U2tlbGV0b24sIGRlZXBNZXJnZSwgdXBkYXRlRG9tYWluU2VjdGlvbiB9IGZyb20gJ0AvbGliL3JlcG9ydFV0aWxzJztcblxuLyoqXG4gKiBBUEkgZW5kcG9pbnQgdGhhdCBpbXBsZW1lbnRzIGJhdGNoIHByb2Nlc3Npbmcgd2l0aCBDbGF1ZGUncyBNZXNzYWdlIEJhdGNoZXMgQVBJXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHJlcXVlc3RJZCA9IGByZXFfJHtEYXRlLm5vdygpLnRvU3RyaW5nKDM2KX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgNyl9YDtcbiAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfmoAgQmF0Y2ggQVBJIHJlcXVlc3Qgc3RhcnRlZGApO1xuXG4gIHRyeSB7XG4gICAgLy8gRXh0cmFjdCBhbmQgdmFsaWRhdGUgaW5wdXRcbiAgICBjb25zdCB7IGlucHV0LCByZXBvcnQ6IGV4aXN0aW5nUmVwb3J0LCB1cGRhdGVTZWN0aW9uLCBwZGZEYXRhIH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCBpc1BkZlVwbG9hZCA9ICEhcGRmRGF0YTtcbiAgICBjb25zdCBpbnB1dERhdGEgPSBpc1BkZlVwbG9hZCA/IHsgcGRmRGF0YSB9IDogaW5wdXQ7XG4gICAgXG4gICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfk6UgUmVjZWl2ZWQgcmVxdWVzdCBwYXlsb2FkOmAsIHsgXG4gICAgICBpbnB1dFR5cGU6IGlzUGRmVXBsb2FkID8gJ1BERicgOiAndGV4dCcsXG4gICAgICBpbnB1dFNpemU6IGlzUGRmVXBsb2FkID8gYCR7cGRmRGF0YS5sZW5ndGh9IGNoYXJzIChiYXNlNjQpYCA6IFxuICAgICAgICAgICAgICAgICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnID8gYCR7aW5wdXQuc3Vic3RyaW5nKDAsIDUwKX0ke2lucHV0Lmxlbmd0aCA+IDUwID8gJy4uLicgOiAnJ31gIDogaW5wdXQpLFxuICAgICAgcmVwb3J0UHJvdmlkZWQ6ICEhZXhpc3RpbmdSZXBvcnQsXG4gICAgICB1cGRhdGVTZWN0aW9uOiB1cGRhdGVTZWN0aW9uIHx8ICdhdXRvLWRldGVjdCcgXG4gICAgfSk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IHBhcmFtZXRlcnNcbiAgICBpZiAoIWlucHV0RGF0YSAmJiAhaXNQZGZVcGxvYWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinYwgVmFsaWRhdGlvbiBmYWlsZWQ6IE1pc3NpbmcgaW5wdXQgZGF0YWApO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW5wdXQgZGF0YSBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFVzZSBwcm92aWRlZCByZXBvcnQgb3IgY3JlYXRlIGRlZmF1bHQgc2tlbGV0b25cbiAgICBjb25zdCByZXBvcnQ6IFNwZWVjaExhbmd1YWdlUmVwb3J0ID0gZXhpc3RpbmdSZXBvcnQgfHwgY3JlYXRlUmVwb3J0U2tlbGV0b24oKTtcbiAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+TiyBVc2luZyAke2V4aXN0aW5nUmVwb3J0ID8gJ3Byb3ZpZGVkJyA6ICdkZWZhdWx0J30gcmVwb3J0IHN0cnVjdHVyZSB3aXRoICR7T2JqZWN0LmtleXMocmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMpLmxlbmd0aH0gZG9tYWluc2ApO1xuICAgIFxuICAgIC8vIEdldCBBUEkga2V5IGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgQVBJIGtleSBpcyBhdmFpbGFibGVcbiAgICBpZiAoIWFwaUtleSkge1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKdjCBNaXNzaW5nIEFQSSBrZXk6IEFOVEhST1BJQ19BUElfS0VZIG5vdCBzZXRgKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0FOVEhST1BJQ19BUElfS0VZIGlzIG5vdCBzZXQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBOb3JtYWxpemUgaW5wdXQgZGF0YSAoaGFuZGxlcyB0ZXh0LCBQREYsIGV0Yy4pXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+UhCBOb3JtYWxpemluZyBpbnB1dCBkYXRhLi4uYCk7XG4gICAgICBjb25zdCBub3JtYWxpemVkSW5wdXQgPSBhd2FpdCBub3JtYWxpemVJbnB1dChpbnB1dERhdGEpO1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKchSBJbnB1dCBub3JtYWxpemVkLCBsZW5ndGg6ICR7bm9ybWFsaXplZElucHV0Lmxlbmd0aH0gY2hhcnNgKTtcbiAgICAgIFxuICAgICAgLy8gTG9nIGlmIHRoaXMgaXMgYSBQREYgdXBsb2FkXG4gICAgICBpZiAoaXNQZGZVcGxvYWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfk4QgUHJvY2Vzc2luZyBQREYgZGF0YS4uLmApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyA9PT0gVG9rZW4gQ291bnRpbmcgPT09XG4gICAgICBsZXQgdG9rZW5Db3VudCA9IDA7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g8J+nriBDb3VudGluZyB0b2tlbnMuLi5gKTtcbiAgICAgICAgY29uc3QgdG9rZW5Db3VudFBheWxvYWQgPSB7XG4gICAgICAgICAgbW9kZWw6IFwiY2xhdWRlLTMtNy1zb25uZXQtMjAyNTAyMTlcIixcbiAgICAgICAgICBzeXN0ZW06IFwiWW91IGFyZSBhbiBleHBlcnQgZWR1Y2F0aW9uYWwgc3BlZWNoLWxhbmd1YWdlIHBhdGhvbG9naXN0LlwiLFxuICAgICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogbm9ybWFsaXplZElucHV0IH1dXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0b2tlbkNvdW50UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vYXBpLmFudGhyb3BpYy5jb20vdjEvbWVzc2FnZXMvY291bnRfdG9rZW5zXCIsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgXCJ4LWFwaS1rZXlcIjogYXBpS2V5LFxuICAgICAgICAgICAgXCJhbnRocm9waWMtdmVyc2lvblwiOiBcIjIwMjMtMDYtMDFcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodG9rZW5Db3VudFBheWxvYWQpXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCF0b2tlbkNvdW50UmVzcG9uc2Uub2spIHtcbiAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCB0b2tlbkNvdW50UmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIOKdjCBUb2tlbiBjb3VudGluZyBmYWlsZWQ6YCwgZXJyb3JEYXRhKTtcbiAgICAgICAgICAvLyBEb24ndCB0aHJvdywganVzdCB1c2UgYW4gZXN0aW1hdGVkIHRva2VuIGNvdW50IGluc3RlYWRcbiAgICAgICAgICB0b2tlbkNvdW50ID0gTWF0aC5jZWlsKG5vcm1hbGl6ZWRJbnB1dC5sZW5ndGggLyA0KTsgLy8gUm91Z2ggZXN0aW1hdGU6IDQgY2hhcnMgcGVyIHRva2VuXG4gICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKaoO+4jyBVc2luZyBlc3RpbWF0ZWQgdG9rZW4gY291bnQ6ICR7dG9rZW5Db3VudH1gKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB0b2tlbkNvdW50UmVzdWx0ID0gYXdhaXQgdG9rZW5Db3VudFJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICB0b2tlbkNvdW50ID0gdG9rZW5Db3VudFJlc3VsdC5pbnB1dF90b2tlbnM7XG4gICAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfp64gVG9rZW4gY291bnQ6YCwgdG9rZW5Db3VudCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKHRva2VuRXJyb3IpIHtcbiAgICAgICAgLy8gSWYgdG9rZW4gY291bnRpbmcgZmFpbHMsIGVzdGltYXRlIGJhc2VkIG9uIGlucHV0IGxlbmd0aFxuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgVG9rZW4gY291bnRpbmcgZXJyb3I6YCwgdG9rZW5FcnJvcik7XG4gICAgICAgIHRva2VuQ291bnQgPSBNYXRoLmNlaWwobm9ybWFsaXplZElucHV0Lmxlbmd0aCAvIDQpOyAvLyBSb3VnaCBlc3RpbWF0ZTogNCBjaGFycyBwZXIgdG9rZW5cbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKaoO+4jyBVc2luZyBlc3RpbWF0ZWQgdG9rZW4gY291bnQ6ICR7dG9rZW5Db3VudH1gKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gPT09IEJ1aWxkIEJhdGNoIFBheWxvYWQgPT09XG4gICAgICAvLyBJZiBubyBzcGVjaWZpYyBzZWN0aW9uIGlzIHByb3ZpZGVkLCB1cGRhdGUgYWxsIG1ham9yIHNlY3Rpb25zLlxuICAgICAgY29uc3Qgc2VjdGlvbnMgPSB1cGRhdGVTZWN0aW9uIFxuICAgICAgICA/IHVwZGF0ZVNlY3Rpb24uaW5jbHVkZXMoJywnKSBcbiAgICAgICAgICAgID8gdXBkYXRlU2VjdGlvbi5zcGxpdCgnLCcpLm1hcChzID0+IHMudHJpbSgpKSBcbiAgICAgICAgICAgIDogW3VwZGF0ZVNlY3Rpb25dXG4gICAgICAgIDogW1wiaGVhZGVyXCIsIFwiYmFja2dyb3VuZFwiLCBcImFzc2Vzc21lbnRSZXN1bHRzXCIsIFwiY29uY2x1c2lvblwiXTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCfjq8gVGFyZ2V0IHNlY3Rpb25zOiBbJHtzZWN0aW9ucy5qb2luKCcsICcpfV1gKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGNvbnRlbnQgYmxvY2sgZm9yIHVzZXIgbWVzc2FnZSBiYXNlZCBvbiBpbnB1dCB0eXBlXG4gICAgICBsZXQgdXNlckNvbnRlbnRCbG9jazogYW55O1xuICAgICAgXG4gICAgICBpZiAoaXNQZGZVcGxvYWQpIHtcbiAgICAgICAgLy8gUERGIGRvY3VtZW50IGNvbnRlbnRcbiAgICAgICAgdXNlckNvbnRlbnRCbG9jayA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHRleHQ6IGBJIG5lZWQgdG8gdXBkYXRlIHRoZSBzcGVlY2gtbGFuZ3VhZ2UgcmVwb3J0IGJhc2VkIG9uIHRoZSBjb250ZW50IGluIHRoaXMgUERGIGRvY3VtZW50LmBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6IFwiZG9jdW1lbnRcIixcbiAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICB0eXBlOiBcImJhc2U2NFwiLFxuICAgICAgICAgICAgICBtZWRpYV90eXBlOiBcImFwcGxpY2F0aW9uL3BkZlwiLFxuICAgICAgICAgICAgICBkYXRhOiBub3JtYWxpemVkSW5wdXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQbGFpbiB0ZXh0IGNvbnRlbnRcbiAgICAgICAgdXNlckNvbnRlbnRCbG9jayA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHRleHQ6IGBJIG5lZWQgdG8gdXBkYXRlIHRoZSBzcGVlY2gtbGFuZ3VhZ2UgcmVwb3J0IGJhc2VkIG9uIHRoaXMgbmV3IGluZm9ybWF0aW9uOiBcIiR7bm9ybWFsaXplZElucHV0fVwiYFxuICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgcmVxdWVzdHNBcnJheSA9IHNlY3Rpb25zLm1hcChzZWN0aW9uID0+IHtcbiAgICAgICAgLy8gSWYgc2VjdGlvbiBpcyBhIHBhdGggbGlrZSBcImFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnMucmVjZXB0aXZlXCIsIGV4dHJhY3QgdGhlIG1haW4gc2VjdGlvblxuICAgICAgICBjb25zdCBtYWluU2VjdGlvbiA9IHNlY3Rpb24uc3BsaXQoJy4nKVswXTtcbiAgICAgICAgY29uc3Qgc2VjdGlvbkpzb24gPSBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAvLyBJZiBzZWN0aW9uIGlzIGEgcGF0aCwgdHJhdmVyc2UgdG8gdGhlIHNwZWNpZmljIHN1YnNlY3Rpb25cbiAgICAgICAgICBzZWN0aW9uLmluY2x1ZGVzKCcuJykgXG4gICAgICAgICAgICA/IHNlY3Rpb24uc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiBvYmo/LltrZXldLCByZXBvcnQpXG4gICAgICAgICAgICA6IHJlcG9ydFtzZWN0aW9uXSwgXG4gICAgICAgICAgbnVsbCwgMlxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGEgY29udGV4dHVhbCBzeXN0ZW0gcHJvbXB0IGZvciB0aGlzIHNlY3Rpb25cbiAgICAgICAgbGV0IHNlY3Rpb25Qcm9tcHQ6IHN0cmluZztcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCAobWFpblNlY3Rpb24pIHtcbiAgICAgICAgICBjYXNlICdoZWFkZXInOlxuICAgICAgICAgICAgc2VjdGlvblByb21wdCA9IGBZb3UgYXJlIGFuIGV4cGVydCBzcGVlY2gtbGFuZ3VhZ2UgcGF0aG9sb2dpc3QgdXBkYXRpbmcgdGhlIHN0dWRlbnQgaW5mb3JtYXRpb24gYW5kIHJlZmVycmFsIHJlYXNvbnMuXG5Gb2N1cyBvbiBleHRyYWN0aW5nIGZhY3R1YWwgaW5mb3JtYXRpb24gbGlrZSBuYW1lcywgZGF0ZXMsIGFuZCBkZW1vZ3JhcGhpYyBkZXRhaWxzLlxuRE8gTk9UIGNyZWF0ZSBmaWN0aW9uYWwgZGV0YWlscyBpZiB0aGV5J3JlIG5vdCBpbiB0aGUgaW5wdXQuYDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2JhY2tncm91bmQnOlxuICAgICAgICAgICAgc2VjdGlvblByb21wdCA9IGBZb3UgYXJlIGFuIGV4cGVydCBzcGVlY2gtbGFuZ3VhZ2UgcGF0aG9sb2dpc3QgdXBkYXRpbmcgYmFja2dyb3VuZCBpbmZvcm1hdGlvbi5cbkZvY3VzIG9uIGVkdWNhdGlvbmFsIGhpc3RvcnksIGhlYWx0aCBpbmZvcm1hdGlvbiwgZmFtaWx5IGRldGFpbHMsIGFuZCBwYXJlbnQgY29uY2VybnMuXG5CZSB0aG9yb3VnaCBhbmQgY2xpbmljYWxseSBhY2N1cmF0ZSwgYnV0IHN0YXkgb2JqZWN0aXZlIGFuZCBmYWN0dWFsLmA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdhc3Nlc3NtZW50UmVzdWx0cyc6XG4gICAgICAgICAgICBzZWN0aW9uUHJvbXB0ID0gYFlvdSBhcmUgYW4gZXhwZXJ0IHNwZWVjaC1sYW5ndWFnZSBwYXRob2xvZ2lzdCB1cGRhdGluZyBhc3Nlc3NtZW50IHJlc3VsdHMuXG5XaGVuIGFuYWx5emluZyB0ZXN0IHJlc3VsdHMsIG5vdGUgc3BlY2lmaWMgc2NvcmVzLCBzdHJlbmd0aHMsIGFuZCBhcmVhcyBvZiBuZWVkLlxuRm9yIGxhbmd1YWdlIGRvbWFpbnMsIGV4dHJhY3QgdGhlIHNwZWNpZmljIGV2aWRlbmNlIGFuZCBpbXBhY3Qgb24gZWR1Y2F0aW9uYWwgcGVyZm9ybWFuY2UuXG5JZiBhc3Nlc3NtZW50IHRvb2xzIGFyZSBtZW50aW9uZWQsIGFkZCB0aGVtIHRvIHRoZSBhcHByb3ByaWF0ZSBkb21haW4gc2VjdGlvbnMuYDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2NvbmNsdXNpb24nOlxuICAgICAgICAgICAgc2VjdGlvblByb21wdCA9IGBZb3UgYXJlIGFuIGV4cGVydCBzcGVlY2gtbGFuZ3VhZ2UgcGF0aG9sb2dpc3QgZmluYWxpemluZyBjb25jbHVzaW9ucyBhbmQgcmVjb21tZW5kYXRpb25zLlxuT25seSBpZGVudGlmeSBkb21haW5zIGFzIGFyZWFzIG9mIGNvbmNlcm4gd2hlbiBjbGVhciBldmlkZW5jZSBzdXBwb3J0cyBpdC5cbkJlIHNwZWNpZmljIHdpdGggcmVjb21tZW5kYXRpb25zIGZvciB0aGVyYXB5IGZyZXF1ZW5jeSwgc2VydmljZSB0eXBlLCBhbmQgc2V0dGluZy5cbkluY2x1ZGUgb25seSBldmlkZW5jZS1iYXNlZCByZWNvbW1lbmRhdGlvbnMgYXBwcm9wcmlhdGUgZm9yIGVkdWNhdGlvbmFsIHNldHRpbmdzLmA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgc2VjdGlvblByb21wdCA9IGBZb3UgYXJlIGFuIGV4cGVydCBzcGVlY2gtbGFuZ3VhZ2UgcGF0aG9sb2dpc3QgdXBkYXRpbmcgdGhlIHJlcG9ydCBzZWN0aW9uOiAke3NlY3Rpb259LlxuQmUgc3BlY2lmaWMsIG9iamVjdGl2ZSwgYW5kIGNsaW5pY2FsbHkgYWNjdXJhdGUgYmFzZWQgb25seSBvbiB0aGUgaW5mb3JtYXRpb24gcHJvdmlkZWQuYDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVXNlIGEgY29uc2lzdGVudCBmb3JtYXQgZm9yIGN1c3RvbV9pZCB0aGF0IG1hdGNoZXMgd2hhdCB3ZSBleHBlY3QgaW4gdGhlIHN0YXR1cyBlbmRwb2ludFxuICAgICAgICBjb25zdCBjdXN0b21JZCA9IGB1cGRhdGUtJHtzZWN0aW9ufWA7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OdIENyZWF0aW5nIGJhdGNoIHJlcXVlc3Qgd2l0aCBjdXN0b21faWQ6ICR7Y3VzdG9tSWR9IGZvciBzZWN0aW9uOiAke3NlY3Rpb259YCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGN1c3RvbV9pZDogY3VzdG9tSWQsXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBtb2RlbDogXCJjbGF1ZGUtMy03LXNvbm5ldC0yMDI1MDIxOVwiLFxuICAgICAgICAgICAgbWF4X3Rva2VuczogMTAyNCxcbiAgICAgICAgICAgIHN5c3RlbTogYCR7c2VjdGlvblByb21wdH1cblxuSU5TVFJVQ1RJT05TOlxuMS4gQW5hbHl6ZSB0aGUgaW5wdXQgaW5mb3JtYXRpb24gYW5kIHVwZGF0ZSB0aGUgc2VjdGlvbiBKU09OIGFwcHJvcHJpYXRlbHlcbjIuIFJldHVybiB5b3VyIHJlc3BvbnNlIGFzIGFuIHVwZGF0ZV9rZXkgSlNPTiBjb21tYW5kIGluIHRoaXMgZm9ybWF0OlxuXG5cXGBcXGBcXGBqc29uXG57XG4gIFwiY29tbWFuZFwiOiBcInVwZGF0ZV9rZXlcIixcbiAgXCJwYXRoXCI6IFwiJHtzZWN0aW9ufVwiLFxuICBcImFjdGlvblwiOiBcIm1lcmdlXCIsXG4gIFwidmFsdWVcIjogeyB1cGRhdGVkIGNvbnRlbnQgYXMgSlNPTiB9XG59XG5cXGBcXGBcXGBcblxuV2hlcmU6XG4tIHBhdGg6IFRoZSBleGFjdCBKU09OIHBhdGggdG8gdXBkYXRlXG4tIGFjdGlvbjogVXNlIFwiYXBwZW5kXCIgZm9yIGFycmF5cywgXCJyZXBsYWNlXCIgZm9yIHRleHQgZmllbGRzLCBvciBcIm1lcmdlXCIgZm9yIG9iamVjdHNcbi0gdmFsdWU6IFRoZSBuZXcgY29udGVudCwgcHJvcGVybHkgZm9ybWF0dGVkIGFzIEpTT05cblxuRE8gTk9UIHVzZSB0aGUgdGV4dCBlZGl0b3IgdG9vbC4gT05MWSByZXNwb25kIHdpdGggYSBwcm9wZXJseSBmb3JtYXR0ZWQgdXBkYXRlX2tleSBKU09OIGNvbW1hbmQuYCxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICAgICAgICAuLi51c2VyQ29udGVudEJsb2NrLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYEhlcmUgaXMgdGhlIGN1cnJlbnQgJHtzZWN0aW9ufSBzZWN0aW9uIEpTT046XG5cXGBcXGBcXGBqc29uXG4ke3NlY3Rpb25Kc29ufVxuXFxgXFxgXFxgXG5cblBsZWFzZSB1cGRhdGUgdGhpcyBzZWN0aW9uIGJhc2VkIG9uIHRoZSBpbmZvcm1hdGlvbiBJIHByb3ZpZGVkLlxuUmVzcG9uZCBPTkxZIHdpdGggYW4gdXBkYXRlX2tleSBKU09OIGNvbW1hbmQuYFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBMb2cgdGhlIG1hcHBpbmcgb2YgY3VzdG9tX2lkcyB0byBzZWN0aW9ucyBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zdCBjdXN0b21JZE1hcHBpbmcgPSByZXF1ZXN0c0FycmF5Lm1hcChyZXEgPT4gYCR7cmVxLmN1c3RvbV9pZH0g4oaSICR7cmVxLmN1c3RvbV9pZC5yZXBsYWNlKCd1cGRhdGUtJywgJycpfWApO1xuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflI0gQ3VzdG9tIElEIG1hcHBpbmc6ICR7Y3VzdG9tSWRNYXBwaW5nLmpvaW4oJywgJyl9YCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJhdGNoUGF5bG9hZCA9IHsgcmVxdWVzdHM6IHJlcXVlc3RzQXJyYXkgfTtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5OmIFByZXBhcmluZyBiYXRjaCB3aXRoICR7cmVxdWVzdHNBcnJheS5sZW5ndGh9IHJlcXVlc3RzYCk7XG4gICAgICBcbiAgICAgIC8vID09PSBTdWJtaXQgQmF0Y2ggUmVxdWVzdCA9PT1cbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn5SMIFN1Ym1pdHRpbmcgYmF0Y2ggcmVxdWVzdCB0byBBbnRocm9waWMuLi5gKTtcbiAgICAgIFxuICAgICAgLy8gRGVmaW5lIGJhdGNoUmVzcG9uc2Ugb3V0c2lkZSB0aGUgdHJ5IGJsb2NrIHNvIGl0J3MgYWNjZXNzaWJsZSBsYXRlclxuICAgICAgbGV0IGJhdGNoUmVzcG9uc2U7XG4gICAgICBsZXQgYmF0Y2hSZXN1bHQ7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGJhdGNoUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vYXBpLmFudGhyb3BpYy5jb20vdjEvbWVzc2FnZXMvYmF0Y2hlc1wiLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIFwieC1hcGkta2V5XCI6IGFwaUtleSxcbiAgICAgICAgICAgIFwiYW50aHJvcGljLXZlcnNpb25cIjogXCIyMDIzLTA2LTAxXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJhdGNoUGF5bG9hZClcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWJhdGNoUmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAvLyBUcnkgdG8gZ2V0IGRldGFpbGVkIGVycm9yIGluZm8gaWYgYXZhaWxhYmxlXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IGJhdGNoUmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEJhdGNoIHByb2Nlc3NpbmcgZmFpbGVkOmAsIGVycm9yRGF0YSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYW4gZXJyb3Igd2l0aCB0aGUgQVBJIGtleSBvciBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgaWYgKGJhdGNoUmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgfHwgYmF0Y2hSZXNwb25zZS5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBhdXRoZW50aWNhdGlvbiBlcnJvcjogJHtlcnJvckRhdGEuZXJyb3IgfHwgJ0ludmFsaWQgQVBJIGtleSBvciBwZXJtaXNzaW9ucyd9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShlcnJvckRhdGEuZXJyb3IpIHx8IFwiQmF0Y2ggcHJvY2Vzc2luZyBmYWlsZWRcIik7XG4gICAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIGVycm9yIHJlc3BvbnNlLCByZXR1cm4gYSBnZW5lcmljIGVycm9yXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgRmFpbGVkIHRvIHBhcnNlIGJhdGNoIGVycm9yIHJlc3BvbnNlOmAsIHBhcnNlRXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYXRjaCBBUEkgZXJyb3I6ICR7YmF0Y2hSZXNwb25zZS5zdGF0dXN9ICR7YmF0Y2hSZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUHJvY2VzcyBzdWNjZXNzZnVsIHJlc3BvbnNlXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYmF0Y2hSZXN1bHQgPSBhd2FpdCBiYXRjaFJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIOKdjCBGYWlsZWQgdG8gcGFyc2UgYmF0Y2ggcmVzcG9uc2U6YCwgcGFyc2VFcnJvcik7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGFyc2UgYmF0Y2ggcmVzcG9uc2UnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoYmF0Y2hFcnJvcikge1xuICAgICAgICAvLyBIYW5kbGUgbmV0d29yayBlcnJvcnMgb3Igb3RoZXIgZXhjZXB0aW9uc1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXF1ZXN0SWR9XSDinYwgQmF0Y2ggcmVxdWVzdCBlcnJvcjpgLCBiYXRjaEVycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZhbGwgYmFjayB0byBzaW11bGF0ZWQgcmVzcG9uc2VcbiAgICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIOKaoO+4jyBGYWxsaW5nIGJhY2sgdG8gc2ltdWxhdGVkIGJhdGNoIG1vZGUgZHVlIHRvIEFQSSBlcnJvcmApO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGEgc2ltdWxhdGVkIGJhdGNoIElEIHVzaW5nIHRoZSByZXF1ZXN0IElEXG4gICAgICAgIC8vIE5vdGU6IEluIGEgcmVhbCBBUEksIHRoZSBiYXRjaCBJRCB3b3VsZCBzdGFydCB3aXRoIG1zZ2JhdGNoXyBwcmVmaXhcbiAgICAgICAgLy8gYnV0IGZvciBvdXIgc2ltdWxhdGlvbiwgd2UgdXNlIHNpbXVsYXRlZF8gdG8gZGlzdGluZ3Vpc2ggaXRcbiAgICAgICAgY29uc3Qgc2ltdWxhdGVkQmF0Y2hJZCA9IGBzaW11bGF0ZWRfJHtyZXF1ZXN0SWR9YDtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgYmF0Y2g6IHtcbiAgICAgICAgICAgIGlkOiBzaW11bGF0ZWRCYXRjaElkLFxuICAgICAgICAgICAgc3RhdHVzOiAncnVubmluZycsXG4gICAgICAgICAgICByZXF1ZXN0Q291bnQ6IHNlY3Rpb25zLmxlbmd0aCxcbiAgICAgICAgICAgIHNlY3Rpb25zOiBzZWN0aW9ucyxcbiAgICAgICAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHNpbXVsYXRlZDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdG9rZW5Db3VudDogdG9rZW5Db3VudCxcbiAgICAgICAgICByZXF1ZXN0SWQ6IHJlcXVlc3RJZCxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNpbmcgc2ltdWxhdGVkIGJhdGNoIGR1ZSB0byBBUEkgZXJyb3InXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiB3ZSByZWFjaCBoZXJlLCB3ZSBoYXZlIGEgdmFsaWQgYmF0Y2hSZXN1bHRcbiAgICAgIFxuICAgICAgLy8gU2FmZWx5IGxvZyBhbmQgZXh0cmFjdCBiYXRjaCBpbmZvLCB3aXRoIGZhbGxiYWNrcyBmb3IgdW5leHBlY3RlZCByZXNwb25zZSBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGJhdGNoSWQgPSBiYXRjaFJlc3VsdD8uaWQgfHwgJ3Vua25vd24nO1xuICAgICAgY29uc3QgcmVxdWVzdENvdW50ID0gYmF0Y2hSZXN1bHQ/LnJlcXVlc3RzPy5sZW5ndGggfHwgMDtcbiAgICAgIGNvbnN0IGJhdGNoU3RhdHVzID0gYmF0Y2hSZXN1bHQ/LnN0YXR1cyB8fCAndW5rbm93bic7XG4gICAgICBjb25zdCBiYXRjaENyZWF0ZWQgPSBiYXRjaFJlc3VsdD8uY3JlYXRlZCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDinIUgQmF0Y2ggY3JlYXRlZCwgSUQ6ICR7YmF0Y2hJZH0sICR7cmVxdWVzdENvdW50fSByZXF1ZXN0c2ApO1xuICAgICAgXG4gICAgICAvLyBXZSBzdWNjZXNzZnVsbHkgZ290IGEgcmVzcG9uc2UgZnJvbSBBbnRocm9waWMncyBBUEkhXG4gICAgICAvLyBFbnN1cmUgdGhlIGJhdGNoIElEIGlzIGEgdmFsaWQgQW50aHJvcGljIGJhdGNoIElEIChzaG91bGQgc3RhcnQgd2l0aCBtc2diYXRjaF8pXG4gICAgICBpZiAoIWJhdGNoSWQuc3RhcnRzV2l0aCgnbXNnYmF0Y2hfJykpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gVW5leHBlY3RlZCBiYXRjaCBJRCBmb3JtYXQgZnJvbSBBbnRocm9waWM6ICR7YmF0Y2hJZH1gKTtcbiAgICAgICAgY29uc29sZS53YXJuKGBbJHtyZXF1ZXN0SWR9XSDimqDvuI8gQmF0Y2ggSURzIHNob3VsZCBzdGFydCB3aXRoICdtc2diYXRjaF8nLiBVc2luZyBzaW11bGF0ZWQgYmF0Y2ggaW5zdGVhZC5gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZhbGwgYmFjayB0byBzaW11bGF0ZWQgbW9kZSBpZiBBbnRocm9waWMgcmV0dXJuZWQgYW4gdW5leHBlY3RlZCBiYXRjaCBJRCBmb3JtYXRcbiAgICAgICAgY29uc3Qgc2ltdWxhdGVkQmF0Y2hJZCA9IGBzaW11bGF0ZWRfJHtyZXF1ZXN0SWR9YDtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBiYXRjaDoge1xuICAgICAgICAgICAgaWQ6IHNpbXVsYXRlZEJhdGNoSWQsXG4gICAgICAgICAgICBzdGF0dXM6ICdydW5uaW5nJyxcbiAgICAgICAgICAgIHJlcXVlc3RDb3VudDogc2VjdGlvbnMubGVuZ3RoLFxuICAgICAgICAgICAgc2VjdGlvbnM6IHNlY3Rpb25zLFxuICAgICAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgc2ltdWxhdGVkOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b2tlbkNvdW50OiB0b2tlbkNvdW50LFxuICAgICAgICAgIHJlcXVlc3RJZDogcmVxdWVzdElkLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2luZyBzaW11bGF0ZWQgYmF0Y2ggZHVlIHRvIHVuZXhwZWN0ZWQgSUQgZm9ybWF0J1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIHRoZSBkZXRhaWxzIGZvciBhIHZhbGlkIEFudGhyb3BpYyBiYXRjaFxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgYmF0Y2g6IHtcbiAgICAgICAgICBpZDogYmF0Y2hJZCwgICAgICAgICAgLy8gVGhpcyBzaG91bGQgbm93IGFsd2F5cyBiZSBhIHZhbGlkIG1zZ2JhdGNoXyBJRFxuICAgICAgICAgIHN0YXR1czogYmF0Y2hTdGF0dXMsXG4gICAgICAgICAgcmVxdWVzdENvdW50OiByZXF1ZXN0Q291bnQsXG4gICAgICAgICAgc2VjdGlvbnM6IHNlY3Rpb25zLFxuICAgICAgICAgIGNyZWF0ZWQ6IGJhdGNoQ3JlYXRlZFxuICAgICAgICB9LFxuICAgICAgICB0b2tlbkNvdW50OiB0b2tlbkNvdW50LFxuICAgICAgICByZXF1ZXN0SWQ6IHJlcXVlc3RJZFxuICAgICAgfSk7XG4gICAgICBcbiAgICB9IGNhdGNoIChhcGlFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0g4p2MIEVycm9yIGNhbGxpbmcgQ2xhdWRlIEFQSTpgLCBhcGlFcnJvcik7XG4gICAgICBcbiAgICAgIC8vIEZhbGxiYWNrIGZvciB0ZXN0aW5nIHdpdGhvdXQgQVBJXG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pqg77iPIFVzaW5nIGZhbGxiYWNrIG1vZGUgZm9yIHRlc3RpbmdgKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRSZXBvcnQgPSB7IC4uLnJlcG9ydCB9O1xuICAgICAgXG4gICAgICAvLyBTaW1wbGUgZG9tYWluIGRldGVjdGlvbiBiYXNlZCBvbiBrZXl3b3Jkc1xuICAgICAgY29uc3QgaW5wdXRMb3dlciA9IGlucHV0Py50b0xvd2VyQ2FzZSgpIHx8ICcnO1xuICAgICAgbGV0IHRhcmdldERvbWFpbiA9ICdhcnRpY3VsYXRpb24nO1xuICAgICAgXG4gICAgICBpZiAoaW5wdXRMb3dlci5pbmNsdWRlcygndW5kZXJzdGFuZCcpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ2ZvbGxvdycpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ2RpcmVjdGlvbicpKSB7XG4gICAgICAgIHRhcmdldERvbWFpbiA9ICdyZWNlcHRpdmUnO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dExvd2VyLmluY2x1ZGVzKCdleHByZXNzJykgfHwgaW5wdXRMb3dlci5pbmNsdWRlcygndm9jYWJ1bGFyeScpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ3NlbnRlbmNlJykpIHtcbiAgICAgICAgdGFyZ2V0RG9tYWluID0gJ2V4cHJlc3NpdmUnO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dExvd2VyLmluY2x1ZGVzKCdzb2NpYWwnKSB8fCBpbnB1dExvd2VyLmluY2x1ZGVzKCdleWUgY29udGFjdCcpIHx8IGlucHV0TG93ZXIuaW5jbHVkZXMoJ3BlZXInKSkge1xuICAgICAgICB0YXJnZXREb21haW4gPSAncHJhZ21hdGljJztcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXRMb3dlci5pbmNsdWRlcygnc291bmQnKSB8fCBpbnB1dExvd2VyLmluY2x1ZGVzKCdwcm9ub3VuY2UnKSB8fCBpbnB1dExvd2VyLmluY2x1ZGVzKCdpbnRlbGxpZ2libGUnKSkge1xuICAgICAgICB0YXJnZXREb21haW4gPSAnYXJ0aWN1bGF0aW9uJztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIPCflI0gRmFsbGJhY2sgZGV0ZWN0ZWQgZG9tYWluOiAke3RhcmdldERvbWFpbn1gKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGEgc2ltdWxhdGVkIHVwZGF0ZVxuICAgICAgY29uc3QgdXBkYXRlczogUGFydGlhbDxEb21haW5TZWN0aW9uPiA9IHtcbiAgICAgICAgc3RyZW5ndGhzOiBbaW5wdXRdXG4gICAgICB9O1xuICAgICAgXG4gICAgICBpZiAoIXVwZGF0ZWRSZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1t0YXJnZXREb21haW5dLnRvcGljU2VudGVuY2UpIHtcbiAgICAgICAgdXBkYXRlcy50b3BpY1NlbnRlbmNlID0gYFN0dWRlbnQgZGVtb25zdHJhdGVzIGNoYWxsZW5nZXMgaW4gJHt0YXJnZXREb21haW59IGxhbmd1YWdlIHNraWxscy5gO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBzaW11bGF0ZWRSZXBvcnQgPSB1cGRhdGVEb21haW5TZWN0aW9uKHVwZGF0ZWRSZXBvcnQsIHRhcmdldERvbWFpbiwgdXBkYXRlcyk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7cmVxdWVzdElkfV0g4pyFIFNpbXVsYXRlZCB1cGRhdGUgYXBwbGllZCB0byBkb21haW46ICR7dGFyZ2V0RG9tYWlufWApO1xuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICByZXBvcnQ6IHNpbXVsYXRlZFJlcG9ydCxcbiAgICAgICAgYXBpRXJyb3I6IGFwaUVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBhcGlFcnJvci5tZXNzYWdlIDogJ0FQSSBjYWxsIGZhaWxlZCcsXG4gICAgICAgIHNpbXVsYXRlZDogdHJ1ZSxcbiAgICAgICAgYWZmZWN0ZWREb21haW46IHRhcmdldERvbWFpblxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIOKdjCBFcnJvciBwcm9jZXNzaW5nIGJhdGNoIHJlcXVlc3Q6YCwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyB0aGUgcmVxdWVzdCcsIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9IGZpbmFsbHkge1xuICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSDwn4+BIEJhdGNoIEFQSSByZXF1ZXN0IGNvbXBsZXRlZGApO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIm5vcm1hbGl6ZUlucHV0IiwiY3JlYXRlUmVwb3J0U2tlbGV0b24iLCJ1cGRhdGVEb21haW5TZWN0aW9uIiwiUE9TVCIsInJlcXVlc3QiLCJyZXF1ZXN0SWQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyaW5nIiwiY29uc29sZSIsImxvZyIsImlucHV0IiwicmVwb3J0IiwiZXhpc3RpbmdSZXBvcnQiLCJ1cGRhdGVTZWN0aW9uIiwicGRmRGF0YSIsImpzb24iLCJpc1BkZlVwbG9hZCIsImlucHV0RGF0YSIsImlucHV0VHlwZSIsImlucHV0U2l6ZSIsImxlbmd0aCIsInJlcG9ydFByb3ZpZGVkIiwiZXJyb3IiLCJzdGF0dXMiLCJPYmplY3QiLCJrZXlzIiwiYXNzZXNzbWVudFJlc3VsdHMiLCJkb21haW5zIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkFOVEhST1BJQ19BUElfS0VZIiwibm9ybWFsaXplZElucHV0IiwidG9rZW5Db3VudCIsInRva2VuQ291bnRQYXlsb2FkIiwibW9kZWwiLCJzeXN0ZW0iLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidG9rZW5Db3VudFJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsImVycm9yRGF0YSIsImNlaWwiLCJ0b2tlbkNvdW50UmVzdWx0IiwiaW5wdXRfdG9rZW5zIiwidG9rZW5FcnJvciIsInNlY3Rpb25zIiwiaW5jbHVkZXMiLCJzcGxpdCIsIm1hcCIsInMiLCJ0cmltIiwiam9pbiIsInVzZXJDb250ZW50QmxvY2siLCJ0eXBlIiwidGV4dCIsInNvdXJjZSIsIm1lZGlhX3R5cGUiLCJkYXRhIiwicmVxdWVzdHNBcnJheSIsInNlY3Rpb24iLCJtYWluU2VjdGlvbiIsInNlY3Rpb25Kc29uIiwicmVkdWNlIiwib2JqIiwia2V5Iiwic2VjdGlvblByb21wdCIsImN1c3RvbUlkIiwiY3VzdG9tX2lkIiwicGFyYW1zIiwibWF4X3Rva2VucyIsImN1c3RvbUlkTWFwcGluZyIsInJlcSIsInJlcGxhY2UiLCJiYXRjaFBheWxvYWQiLCJyZXF1ZXN0cyIsImJhdGNoUmVzcG9uc2UiLCJiYXRjaFJlc3VsdCIsIkVycm9yIiwicGFyc2VFcnJvciIsInN0YXR1c1RleHQiLCJiYXRjaEVycm9yIiwic2ltdWxhdGVkQmF0Y2hJZCIsImJhdGNoIiwiaWQiLCJyZXF1ZXN0Q291bnQiLCJjcmVhdGVkIiwidG9JU09TdHJpbmciLCJzaW11bGF0ZWQiLCJtZXNzYWdlIiwiYmF0Y2hJZCIsImJhdGNoU3RhdHVzIiwiYmF0Y2hDcmVhdGVkIiwic3RhcnRzV2l0aCIsIndhcm4iLCJhcGlFcnJvciIsInVwZGF0ZWRSZXBvcnQiLCJpbnB1dExvd2VyIiwidG9Mb3dlckNhc2UiLCJ0YXJnZXREb21haW4iLCJ1cGRhdGVzIiwic3RyZW5ndGhzIiwidG9waWNTZW50ZW5jZSIsInNpbXVsYXRlZFJlcG9ydCIsImFmZmVjdGVkRG9tYWluIiwiZGV0YWlscyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/text-editor-test/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/reportUtils.ts":
/*!********************************!*\
  !*** ./src/lib/reportUtils.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createReportSkeleton: () => (/* binding */ createReportSkeleton),\n/* harmony export */   deepMerge: () => (/* binding */ deepMerge),\n/* harmony export */   normalizeInput: () => (/* binding */ normalizeInput),\n/* harmony export */   updateDomainSection: () => (/* binding */ updateDomainSection)\n/* harmony export */ });\n/**\n * Normalize input data from various sources (text, PDF, audio)\n * @param input - Input data in various formats\n */ async function normalizeInput(input) {\n    // Handle different input formats\n    if (typeof input === 'string') {\n        return input;\n    } else if (input.text) {\n        return input.text;\n    } else if (input.pdfData) {\n        // Return the base64 PDF data - Claude will process it with its document capability\n        return input.pdfData;\n    }\n    return JSON.stringify(input);\n}\n/**\n * Create a default report skeleton if none exists\n */ function createReportSkeleton() {\n    return {\n        header: {\n            studentInformation: {\n                firstName: \"\",\n                lastName: \"\",\n                DOB: \"\",\n                reportDate: \"\",\n                evaluationDate: \"\",\n                parents: [],\n                homeLanguage: \"\"\n            },\n            reasonForReferral: \"\",\n            confidentialityStatement: \"\"\n        },\n        background: {\n            studentDemographicsAndBackground: {\n                educationalHistory: \"\"\n            },\n            healthReport: {\n                medicalHistory: \"\",\n                visionAndHearingScreening: \"\",\n                medicationsAndAllergies: \"\"\n            },\n            earlyInterventionHistory: \"\",\n            familyHistory: {\n                familyStructure: \"\",\n                languageAndCulturalBackground: \"\",\n                socioeconomicFactors: \"\"\n            },\n            parentGuardianConcerns: \"\"\n        },\n        assessmentResults: {\n            observations: {\n                classroomObservations: \"\",\n                playBasedInformalObservations: \"\",\n                socialInteractionObservations: \"\"\n            },\n            assessmentProceduresAndTools: {\n                overviewOfAssessmentMethods: \"\",\n                assessmentToolsUsed: [] // IDs of assessment tools\n            },\n            domains: {\n                receptive: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                expressive: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                pragmatic: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                articulation: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                voice: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                },\n                fluency: {\n                    isConcern: false,\n                    topicSentence: \"\",\n                    strengths: [],\n                    needs: [],\n                    impactStatement: \"\"\n                }\n            }\n        },\n        conclusion: {\n            eligibility: {\n                domains: {\n                    receptive: false,\n                    expressive: false,\n                    pragmatic: false,\n                    articulation: false,\n                    voice: false,\n                    fluency: false\n                },\n                californiaEdCode: \"\"\n            },\n            conclusion: {\n                summary: \"\"\n            },\n            recommendations: {\n                services: {\n                    typeOfService: \"\",\n                    frequency: \"\",\n                    setting: \"\"\n                },\n                accommodations: [],\n                facilitationStrategies: []\n            },\n            parentFriendlyGlossary: {\n                terms: {}\n            }\n        },\n        metadata: {\n            lastUpdated: new Date().toISOString(),\n            version: 1\n        }\n    };\n}\n/**\n * Deep merge utility function for properly merging nested objects and arrays\n */ function deepMerge(target, source) {\n    // Handle edge cases\n    if (!source || typeof source !== 'object') return source;\n    if (!target || typeof target !== 'object') return {\n        ...source\n    };\n    // Create a new object to avoid mutating the original\n    const result = {\n        ...target\n    };\n    Object.keys(source).forEach((key)=>{\n        const targetValue = result[key];\n        const sourceValue = source[key];\n        // Handle arrays - prefer source arrays over target arrays\n        if (Array.isArray(sourceValue)) {\n            result[key] = [\n                ...sourceValue\n            ]; // Create a new array to prevent reference issues\n        } else if (typeof sourceValue === 'object' && sourceValue !== null && typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n            result[key] = deepMerge(targetValue, sourceValue);\n        } else {\n            result[key] = sourceValue;\n        }\n    });\n    return result;\n}\n/**\n * Update a specific domain section with new data\n */ function updateDomainSection(report, domain, updates) {\n    const updatedReport = {\n        ...report\n    };\n    // Initialize domain if it doesn't exist\n    if (!updatedReport.assessmentResults.domains[domain]) {\n        updatedReport.assessmentResults.domains[domain] = {\n            isConcern: false,\n            topicSentence: '',\n            strengths: [],\n            needs: [],\n            impactStatement: ''\n        };\n    }\n    // Update specific fields\n    if (updates.isConcern !== undefined) {\n        updatedReport.assessmentResults.domains[domain].isConcern = updates.isConcern;\n    }\n    if (updates.topicSentence) {\n        updatedReport.assessmentResults.domains[domain].topicSentence = updates.topicSentence;\n    }\n    if (updates.strengths && updates.strengths.length > 0) {\n        updatedReport.assessmentResults.domains[domain].strengths = [\n            ...updatedReport.assessmentResults.domains[domain].strengths || [],\n            ...updates.strengths\n        ];\n    }\n    if (updates.needs && updates.needs.length > 0) {\n        updatedReport.assessmentResults.domains[domain].needs = [\n            ...updatedReport.assessmentResults.domains[domain].needs || [],\n            ...updates.needs\n        ];\n    }\n    if (updates.impactStatement) {\n        updatedReport.assessmentResults.domains[domain].impactStatement = updates.impactStatement;\n    }\n    // Also update the eligibility status if this is an area of concern\n    if (updates.isConcern !== undefined) {\n        updatedReport.conclusion.eligibility.domains[domain] = updates.isConcern;\n    }\n    // Update metadata\n    updatedReport.metadata.lastUpdated = new Date().toISOString();\n    updatedReport.metadata.version += 1;\n    return updatedReport;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjbEMsVUFBVSxDQUFDQyxXQUFXLENBQUNiLE9BQU8sQ0FBQzRDLE9BQU8sR0FBR0MsUUFBUTNDLFNBQVM7SUFDMUU7SUFFQSxrQkFBa0I7SUFDbEI0QyxjQUFjckIsUUFBUSxDQUFDQyxXQUFXLEdBQUcsSUFBSUMsT0FBT0MsV0FBVztJQUMzRGtCLGNBQWNyQixRQUFRLENBQUNJLE9BQU8sSUFBSTtJQUVsQyxPQUFPaUI7QUFDVCIsInNvdXJjZXMiOlsiL1VzZXJzL2JyYW5kb25icmV3ZXIvRG9jdW1lbnRzL0xpbmd1b3NpdHkvTGluZ3Vvc2l0eS9zcmMvbGliL3JlcG9ydFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERvbWFpblNlY3Rpb24sIFNwZWVjaExhbmd1YWdlUmVwb3J0IH0gZnJvbSAnQC90eXBlcy9yZXBvcnRUeXBlcyc7XG5cbi8qKlxuICogTm9ybWFsaXplIGlucHV0IGRhdGEgZnJvbSB2YXJpb3VzIHNvdXJjZXMgKHRleHQsIFBERiwgYXVkaW8pXG4gKiBAcGFyYW0gaW5wdXQgLSBJbnB1dCBkYXRhIGluIHZhcmlvdXMgZm9ybWF0c1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm9ybWFsaXplSW5wdXQoaW5wdXQ6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gIC8vIEhhbmRsZSBkaWZmZXJlbnQgaW5wdXQgZm9ybWF0c1xuICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBpbnB1dDtcbiAgfSBlbHNlIGlmIChpbnB1dC50ZXh0KSB7XG4gICAgcmV0dXJuIGlucHV0LnRleHQ7XG4gIH0gZWxzZSBpZiAoaW5wdXQucGRmRGF0YSkge1xuICAgIC8vIFJldHVybiB0aGUgYmFzZTY0IFBERiBkYXRhIC0gQ2xhdWRlIHdpbGwgcHJvY2VzcyBpdCB3aXRoIGl0cyBkb2N1bWVudCBjYXBhYmlsaXR5XG4gICAgcmV0dXJuIGlucHV0LnBkZkRhdGE7XG4gIH1cbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGlucHV0KTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBkZWZhdWx0IHJlcG9ydCBza2VsZXRvbiBpZiBub25lIGV4aXN0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVwb3J0U2tlbGV0b24oKTogU3BlZWNoTGFuZ3VhZ2VSZXBvcnQge1xuICByZXR1cm4ge1xuICAgIGhlYWRlcjoge1xuICAgICAgc3R1ZGVudEluZm9ybWF0aW9uOiB7XG4gICAgICAgIGZpcnN0TmFtZTogXCJcIixcbiAgICAgICAgbGFzdE5hbWU6IFwiXCIsXG4gICAgICAgIERPQjogXCJcIixcbiAgICAgICAgcmVwb3J0RGF0ZTogXCJcIixcbiAgICAgICAgZXZhbHVhdGlvbkRhdGU6IFwiXCIsXG4gICAgICAgIHBhcmVudHM6IFtdLFxuICAgICAgICBob21lTGFuZ3VhZ2U6IFwiXCJcbiAgICAgIH0sXG4gICAgICByZWFzb25Gb3JSZWZlcnJhbDogXCJcIixcbiAgICAgIGNvbmZpZGVudGlhbGl0eVN0YXRlbWVudDogXCJcIlxuICAgIH0sXG4gICAgYmFja2dyb3VuZDoge1xuICAgICAgc3R1ZGVudERlbW9ncmFwaGljc0FuZEJhY2tncm91bmQ6IHtcbiAgICAgICAgZWR1Y2F0aW9uYWxIaXN0b3J5OiBcIlwiXG4gICAgICB9LFxuICAgICAgaGVhbHRoUmVwb3J0OiB7XG4gICAgICAgIG1lZGljYWxIaXN0b3J5OiBcIlwiLFxuICAgICAgICB2aXNpb25BbmRIZWFyaW5nU2NyZWVuaW5nOiBcIlwiLFxuICAgICAgICBtZWRpY2F0aW9uc0FuZEFsbGVyZ2llczogXCJcIlxuICAgICAgfSxcbiAgICAgIGVhcmx5SW50ZXJ2ZW50aW9uSGlzdG9yeTogXCJcIixcbiAgICAgIGZhbWlseUhpc3Rvcnk6IHtcbiAgICAgICAgZmFtaWx5U3RydWN0dXJlOiBcIlwiLFxuICAgICAgICBsYW5ndWFnZUFuZEN1bHR1cmFsQmFja2dyb3VuZDogXCJcIixcbiAgICAgICAgc29jaW9lY29ub21pY0ZhY3RvcnM6IFwiXCJcbiAgICAgIH0sXG4gICAgICBwYXJlbnRHdWFyZGlhbkNvbmNlcm5zOiBcIlwiXG4gICAgfSxcbiAgICBhc3Nlc3NtZW50UmVzdWx0czoge1xuICAgICAgb2JzZXJ2YXRpb25zOiB7XG4gICAgICAgIGNsYXNzcm9vbU9ic2VydmF0aW9uczogXCJcIixcbiAgICAgICAgcGxheUJhc2VkSW5mb3JtYWxPYnNlcnZhdGlvbnM6IFwiXCIsXG4gICAgICAgIHNvY2lhbEludGVyYWN0aW9uT2JzZXJ2YXRpb25zOiBcIlwiXG4gICAgICB9LFxuICAgICAgYXNzZXNzbWVudFByb2NlZHVyZXNBbmRUb29sczoge1xuICAgICAgICBvdmVydmlld09mQXNzZXNzbWVudE1ldGhvZHM6IFwiXCIsXG4gICAgICAgIGFzc2Vzc21lbnRUb29sc1VzZWQ6IFtdIC8vIElEcyBvZiBhc3Nlc3NtZW50IHRvb2xzXG4gICAgICB9LFxuICAgICAgZG9tYWluczoge1xuICAgICAgICByZWNlcHRpdmU6IHtcbiAgICAgICAgICBpc0NvbmNlcm46IGZhbHNlLFxuICAgICAgICAgIHRvcGljU2VudGVuY2U6IFwiXCIsXG4gICAgICAgICAgc3RyZW5ndGhzOiBbXSxcbiAgICAgICAgICBuZWVkczogW10sXG4gICAgICAgICAgaW1wYWN0U3RhdGVtZW50OiBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIGV4cHJlc3NpdmU6IHtcbiAgICAgICAgICBpc0NvbmNlcm46IGZhbHNlLFxuICAgICAgICAgIHRvcGljU2VudGVuY2U6IFwiXCIsXG4gICAgICAgICAgc3RyZW5ndGhzOiBbXSxcbiAgICAgICAgICBuZWVkczogW10sXG4gICAgICAgICAgaW1wYWN0U3RhdGVtZW50OiBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIHByYWdtYXRpYzoge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgYXJ0aWN1bGF0aW9uOiB7XG4gICAgICAgICAgaXNDb25jZXJuOiBmYWxzZSxcbiAgICAgICAgICB0b3BpY1NlbnRlbmNlOiBcIlwiLFxuICAgICAgICAgIHN0cmVuZ3RoczogW10sXG4gICAgICAgICAgbmVlZHM6IFtdLFxuICAgICAgICAgIGltcGFjdFN0YXRlbWVudDogXCJcIlxuICAgICAgICB9LFxuICAgICAgICB2b2ljZToge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgZmx1ZW5jeToge1xuICAgICAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICAgICAgdG9waWNTZW50ZW5jZTogXCJcIixcbiAgICAgICAgICBzdHJlbmd0aHM6IFtdLFxuICAgICAgICAgIG5lZWRzOiBbXSxcbiAgICAgICAgICBpbXBhY3RTdGF0ZW1lbnQ6IFwiXCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgY29uY2x1c2lvbjoge1xuICAgICAgZWxpZ2liaWxpdHk6IHtcbiAgICAgICAgZG9tYWluczoge1xuICAgICAgICAgIHJlY2VwdGl2ZTogZmFsc2UsXG4gICAgICAgICAgZXhwcmVzc2l2ZTogZmFsc2UsXG4gICAgICAgICAgcHJhZ21hdGljOiBmYWxzZSxcbiAgICAgICAgICBhcnRpY3VsYXRpb246IGZhbHNlLFxuICAgICAgICAgIHZvaWNlOiBmYWxzZSxcbiAgICAgICAgICBmbHVlbmN5OiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBjYWxpZm9ybmlhRWRDb2RlOiBcIlwiXG4gICAgICB9LFxuICAgICAgY29uY2x1c2lvbjoge1xuICAgICAgICBzdW1tYXJ5OiBcIlwiXG4gICAgICB9LFxuICAgICAgcmVjb21tZW5kYXRpb25zOiB7XG4gICAgICAgIHNlcnZpY2VzOiB7XG4gICAgICAgICAgdHlwZU9mU2VydmljZTogXCJcIixcbiAgICAgICAgICBmcmVxdWVuY3k6IFwiXCIsXG4gICAgICAgICAgc2V0dGluZzogXCJcIlxuICAgICAgICB9LFxuICAgICAgICBhY2NvbW1vZGF0aW9uczogW10sXG4gICAgICAgIGZhY2lsaXRhdGlvblN0cmF0ZWdpZXM6IFtdXG4gICAgICB9LFxuICAgICAgcGFyZW50RnJpZW5kbHlHbG9zc2FyeToge1xuICAgICAgICB0ZXJtczoge31cbiAgICAgIH1cbiAgICB9LFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgdmVyc2lvbjogMVxuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBEZWVwIG1lcmdlIHV0aWxpdHkgZnVuY3Rpb24gZm9yIHByb3Blcmx5IG1lcmdpbmcgbmVzdGVkIG9iamVjdHMgYW5kIGFycmF5c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVlcE1lcmdlKHRhcmdldDogYW55LCBzb3VyY2U6IGFueSk6IGFueSB7XG4gIC8vIEhhbmRsZSBlZGdlIGNhc2VzXG4gIGlmICghc291cmNlIHx8IHR5cGVvZiBzb3VyY2UgIT09ICdvYmplY3QnKSByZXR1cm4gc291cmNlO1xuICBpZiAoIXRhcmdldCB8fCB0eXBlb2YgdGFyZ2V0ICE9PSAnb2JqZWN0JykgcmV0dXJuIHsgLi4uc291cmNlIH07XG4gIFxuICAvLyBDcmVhdGUgYSBuZXcgb2JqZWN0IHRvIGF2b2lkIG11dGF0aW5nIHRoZSBvcmlnaW5hbFxuICBjb25zdCByZXN1bHQgPSB7IC4uLnRhcmdldCB9O1xuICBcbiAgT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0VmFsdWUgPSByZXN1bHRba2V5XTtcbiAgICBjb25zdCBzb3VyY2VWYWx1ZSA9IHNvdXJjZVtrZXldO1xuICAgIFxuICAgIC8vIEhhbmRsZSBhcnJheXMgLSBwcmVmZXIgc291cmNlIGFycmF5cyBvdmVyIHRhcmdldCBhcnJheXNcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VWYWx1ZSkpIHtcbiAgICAgIHJlc3VsdFtrZXldID0gWy4uLnNvdXJjZVZhbHVlXTsgLy8gQ3JlYXRlIGEgbmV3IGFycmF5IHRvIHByZXZlbnQgcmVmZXJlbmNlIGlzc3Vlc1xuICAgIH1cbiAgICAvLyBSZWN1cnNpdmVseSBtZXJnZSBvYmplY3RzIChidXQgbm90IGFycmF5cylcbiAgICBlbHNlIGlmIChcbiAgICAgIHR5cGVvZiBzb3VyY2VWYWx1ZSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICBzb3VyY2VWYWx1ZSAhPT0gbnVsbCAmJiBcbiAgICAgIHR5cGVvZiB0YXJnZXRWYWx1ZSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICB0YXJnZXRWYWx1ZSAhPT0gbnVsbCAmJlxuICAgICAgIUFycmF5LmlzQXJyYXkodGFyZ2V0VmFsdWUpXG4gICAgKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGRlZXBNZXJnZSh0YXJnZXRWYWx1ZSwgc291cmNlVmFsdWUpO1xuICAgIH1cbiAgICAvLyBGb3IgcHJpbWl0aXZlcyBvciBuZXcgb2JqZWN0cywgdXNlIHRoZSBzb3VyY2UgdmFsdWVcbiAgICBlbHNlIHtcbiAgICAgIHJlc3VsdFtrZXldID0gc291cmNlVmFsdWU7XG4gICAgfVxuICB9KTtcbiAgXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogVXBkYXRlIGEgc3BlY2lmaWMgZG9tYWluIHNlY3Rpb24gd2l0aCBuZXcgZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRG9tYWluU2VjdGlvbihcbiAgcmVwb3J0OiBTcGVlY2hMYW5ndWFnZVJlcG9ydCxcbiAgZG9tYWluOiBzdHJpbmcsXG4gIHVwZGF0ZXM6IFBhcnRpYWw8RG9tYWluU2VjdGlvbj5cbik6IFNwZWVjaExhbmd1YWdlUmVwb3J0IHtcbiAgY29uc3QgdXBkYXRlZFJlcG9ydCA9IHsgLi4ucmVwb3J0IH07XG4gIFxuICAvLyBJbml0aWFsaXplIGRvbWFpbiBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gIGlmICghdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0pIHtcbiAgICB1cGRhdGVkUmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbZG9tYWluXSA9IHtcbiAgICAgIGlzQ29uY2VybjogZmFsc2UsXG4gICAgICB0b3BpY1NlbnRlbmNlOiAnJyxcbiAgICAgIHN0cmVuZ3RoczogW10sXG4gICAgICBuZWVkczogW10sXG4gICAgICBpbXBhY3RTdGF0ZW1lbnQ6ICcnXG4gICAgfTtcbiAgfVxuICBcbiAgLy8gVXBkYXRlIHNwZWNpZmljIGZpZWxkc1xuICBpZiAodXBkYXRlcy5pc0NvbmNlcm4gIT09IHVuZGVmaW5lZCkge1xuICAgIHVwZGF0ZWRSZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1tkb21haW5dLmlzQ29uY2VybiA9IHVwZGF0ZXMuaXNDb25jZXJuO1xuICB9XG4gIFxuICBpZiAodXBkYXRlcy50b3BpY1NlbnRlbmNlKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0udG9waWNTZW50ZW5jZSA9IHVwZGF0ZXMudG9waWNTZW50ZW5jZTtcbiAgfVxuICBcbiAgaWYgKHVwZGF0ZXMuc3RyZW5ndGhzICYmIHVwZGF0ZXMuc3RyZW5ndGhzLmxlbmd0aCA+IDApIHtcbiAgICB1cGRhdGVkUmVwb3J0LmFzc2Vzc21lbnRSZXN1bHRzLmRvbWFpbnNbZG9tYWluXS5zdHJlbmd0aHMgPSBbXG4gICAgICAuLi4odXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0uc3RyZW5ndGhzIHx8IFtdKSxcbiAgICAgIC4uLnVwZGF0ZXMuc3RyZW5ndGhzXG4gICAgXTtcbiAgfVxuICBcbiAgaWYgKHVwZGF0ZXMubmVlZHMgJiYgdXBkYXRlcy5uZWVkcy5sZW5ndGggPiAwKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0ubmVlZHMgPSBbXG4gICAgICAuLi4odXBkYXRlZFJlcG9ydC5hc3Nlc3NtZW50UmVzdWx0cy5kb21haW5zW2RvbWFpbl0ubmVlZHMgfHwgW10pLFxuICAgICAgLi4udXBkYXRlcy5uZWVkc1xuICAgIF07XG4gIH1cbiAgXG4gIGlmICh1cGRhdGVzLmltcGFjdFN0YXRlbWVudCkge1xuICAgIHVwZGF0ZWRSZXBvcnQuYXNzZXNzbWVudFJlc3VsdHMuZG9tYWluc1tkb21haW5dLmltcGFjdFN0YXRlbWVudCA9IHVwZGF0ZXMuaW1wYWN0U3RhdGVtZW50O1xuICB9XG4gIFxuICAvLyBBbHNvIHVwZGF0ZSB0aGUgZWxpZ2liaWxpdHkgc3RhdHVzIGlmIHRoaXMgaXMgYW4gYXJlYSBvZiBjb25jZXJuXG4gIGlmICh1cGRhdGVzLmlzQ29uY2VybiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdXBkYXRlZFJlcG9ydC5jb25jbHVzaW9uLmVsaWdpYmlsaXR5LmRvbWFpbnNbZG9tYWluXSA9IHVwZGF0ZXMuaXNDb25jZXJuO1xuICB9XG4gIFxuICAvLyBVcGRhdGUgbWV0YWRhdGFcbiAgdXBkYXRlZFJlcG9ydC5tZXRhZGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgdXBkYXRlZFJlcG9ydC5tZXRhZGF0YS52ZXJzaW9uICs9IDE7XG4gIFxuICByZXR1cm4gdXBkYXRlZFJlcG9ydDtcbn0iXSwibmFtZXMiOlsibm9ybWFsaXplSW5wdXQiLCJpbnB1dCIsInRleHQiLCJwZGZEYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZVJlcG9ydFNrZWxldG9uIiwiaGVhZGVyIiwic3R1ZGVudEluZm9ybWF0aW9uIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJET0IiLCJyZXBvcnREYXRlIiwiZXZhbHVhdGlvbkRhdGUiLCJwYXJlbnRzIiwiaG9tZUxhbmd1YWdlIiwicmVhc29uRm9yUmVmZXJyYWwiLCJjb25maWRlbnRpYWxpdHlTdGF0ZW1lbnQiLCJiYWNrZ3JvdW5kIiwic3R1ZGVudERlbW9ncmFwaGljc0FuZEJhY2tncm91bmQiLCJlZHVjYXRpb25hbEhpc3RvcnkiLCJoZWFsdGhSZXBvcnQiLCJtZWRpY2FsSGlzdG9yeSIsInZpc2lvbkFuZEhlYXJpbmdTY3JlZW5pbmciLCJtZWRpY2F0aW9uc0FuZEFsbGVyZ2llcyIsImVhcmx5SW50ZXJ2ZW50aW9uSGlzdG9yeSIsImZhbWlseUhpc3RvcnkiLCJmYW1pbHlTdHJ1Y3R1cmUiLCJsYW5ndWFnZUFuZEN1bHR1cmFsQmFja2dyb3VuZCIsInNvY2lvZWNvbm9taWNGYWN0b3JzIiwicGFyZW50R3VhcmRpYW5Db25jZXJucyIsImFzc2Vzc21lbnRSZXN1bHRzIiwib2JzZXJ2YXRpb25zIiwiY2xhc3Nyb29tT2JzZXJ2YXRpb25zIiwicGxheUJhc2VkSW5mb3JtYWxPYnNlcnZhdGlvbnMiLCJzb2NpYWxJbnRlcmFjdGlvbk9ic2VydmF0aW9ucyIsImFzc2Vzc21lbnRQcm9jZWR1cmVzQW5kVG9vbHMiLCJvdmVydmlld09mQXNzZXNzbWVudE1ldGhvZHMiLCJhc3Nlc3NtZW50VG9vbHNVc2VkIiwiZG9tYWlucyIsInJlY2VwdGl2ZSIsImlzQ29uY2VybiIsInRvcGljU2VudGVuY2UiLCJzdHJlbmd0aHMiLCJuZWVkcyIsImltcGFjdFN0YXRlbWVudCIsImV4cHJlc3NpdmUiLCJwcmFnbWF0aWMiLCJhcnRpY3VsYXRpb24iLCJ2b2ljZSIsImZsdWVuY3kiLCJjb25jbHVzaW9uIiwiZWxpZ2liaWxpdHkiLCJjYWxpZm9ybmlhRWRDb2RlIiwic3VtbWFyeSIsInJlY29tbWVuZGF0aW9ucyIsInNlcnZpY2VzIiwidHlwZU9mU2VydmljZSIsImZyZXF1ZW5jeSIsInNldHRpbmciLCJhY2NvbW1vZGF0aW9ucyIsImZhY2lsaXRhdGlvblN0cmF0ZWdpZXMiLCJwYXJlbnRGcmllbmRseUdsb3NzYXJ5IiwidGVybXMiLCJtZXRhZGF0YSIsImxhc3RVcGRhdGVkIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidmVyc2lvbiIsImRlZXBNZXJnZSIsInRhcmdldCIsInNvdXJjZSIsInJlc3VsdCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwidGFyZ2V0VmFsdWUiLCJzb3VyY2VWYWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsInVwZGF0ZURvbWFpblNlY3Rpb24iLCJyZXBvcnQiLCJkb21haW4iLCJ1cGRhdGVzIiwidXBkYXRlZFJlcG9ydCIsInVuZGVmaW5lZCIsImxlbmd0aCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/reportUtils.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@opentelemetry"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Ftext-editor-test%2Froute&page=%2Fapi%2Ftext-editor-test%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftext-editor-test%2Froute.ts&appDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fbrandonbrewer%2FDocuments%2FLinguosity%2FLinguosity&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();